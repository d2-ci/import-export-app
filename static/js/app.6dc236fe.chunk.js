(this["webpackJsonp@dhis2/app-shell"]=this["webpackJsonp@dhis2/app-shell"]||[]).push([[133],{177:function(e,t,a){e.exports={container:"JobOverview_container__1_oyo",items:"JobOverview_items__2B1hs",Menu:"JobOverview_Menu__2bTUp",summary:"JobOverview_summary__13xs1"}},180:function(e,t,a){e.exports={container:"Schemas_container__3H0XX",group:"Schemas_group__QeGXq",schema:"Schemas_schema__36IFP",formLabel:"Schemas_formLabel__1geS0",formControl:"Schemas_formControl__2ycln"}},182:function(e,t,a){e.exports={container:"App_container__2zgzu",sidebar:"App_sidebar__10tAV",content:"App_content__3I8HS"}},183:function(e,t,a){e.exports={container:"FormAlerts_container__JPYH9"}},184:function(e,t,a){e.exports={container:"FormField_container__3nG83",label:"FormField_label__2Au43"}},185:function(e,t,a){e.exports={container:"ImportButtonStrip_container__12EQC",dryRun:"ImportButtonStrip_dryRun__112kw"}},186:function(e,t,a){e.exports={container:"MenuLabel_container__ZTyjb",status:"MenuLabel_status__1UTMj",date:"MenuLabel_date__1r_sY"}},193:function(e,t,a){e.exports={container:"JobSummary_container__2Zh6N",title:"JobSummary_title__sZ7p4",taskDetails:"JobSummary_taskDetails__3aEqI",tags:"JobSummary_tags__3qnhf"}},194:function(e,t,a){e.exports={rest:"Summary_rest__GeByI"}},195:function(e,t,a){e.exports={container:"MoreOptions_container__2zKqV",header:"MoreOptions_header__120Ww",label:"MoreOptions_label__1zKNe",children:"MoreOptions_children__1atPW",chevronHidden:"MoreOptions_chevronHidden__3r-Ts",chevronVisible:"MoreOptions_chevronVisible__2pP_E"}},196:function(e,t,a){e.exports={container:"Page_container__3NEqL",limitedWidth:"Page_limitedWidth__Y4JEb",content:"Page_content__39Ql1",preBody:"Page_preBody__3d4Jp",header:"Page_header__13-dA",title:"Page_title__rl9Ut",desc:"Page_desc__2uKSe"}},197:function(e,t,a){e.exports={container:"ProgramStages_container__2q8As"}},198:function(e,t,a){e.exports={horizontal:"RadioGroup_horizontal__2D7__",vertical:"RadioGroup_vertical__1Rhum"}},199:function(e,t,a){e.exports={container:"JobOverview_container__F-fbL"}},206:function(e,t,a){e.exports={select:"Select_select__3_2MB"}},207:function(e,t,a){e.exports={Menu:"Sidebar_Menu__3Gy0D",sidebarItem:"Sidebar_sidebarItem__3GXPY",sidebarItemActive:"Sidebar_sidebarItemActive__3d6JP",sectionTitle:"Sidebar_sectionTitle__lKKbo",jobOverview:"Sidebar_jobOverview__2MJ0c"}},208:function(e,t,a){e.exports={selectedLabel:"ResourcePicker_selectedLabel__2kKYb"}},209:function(e,t,a){e.exports={container:"BasicOptions_container__3a0Mm",label:"BasicOptions_label__3abuV",header:"BasicOptions_header__2gFRx"}},210:function(e,t,a){e.exports={container:"SchemeContainer_container__EmEkB"}},211:function(e,t,a){e.exports={container:"StyledField_container__2GRLx"}},212:function(e,t,a){"use strict";a.r(t);var n=a(1),l=a.n(n),r=a(172),s=a(6),o=a.n(s),c=a(170),i=a(4);const m=l.a.createContext(void 0),d=l.a.createContext(void 0),u=e=>Object.keys(e).map(t=>e[t]).sort((e,t)=>e.created<t.created?1:-1)[0];var p=a(7);const E=(e,t)=>({width:e||24,height:t||24,display:"inline-block",fill:"current-color",color:"current-color",userSelect:"none"}),h=({width:e,height:t})=>l.a.createElement("svg",{viewBox:"0 0 24 24",style:E(e,t),"data-test":"icon-metadataimport"},l.a.createElement("path",{d:"M14.039 8.968l-3.961-3.968h1.968s.991-3.178-2.985-5c6.191.222 6.972 5 6.972 5h1.967l-3.961 3.968zm6.461 5.575l-.342.195v1.717l.342-.195v-1.717zm-.844.481l-.35.199v1.717l.35-.199v-1.717zm.906-10.024l-1.306 1.55 1.62.919-6.859 3.698-8.86-5.138 4.436-2.685c-.234-.5-.626-.989-1.313-1.338l-5.124 2.978-3.156 5.487 2 1.106v5.445l12.25 6.978 9.75-5.551v-11.508l-3.438-1.941zm-16.624 2.688l7.897 4.54-1.192 2.091-7.872-4.605 1.167-2.026zm9.062 13.298l-9-5.126v-3.112l7.377 4.319 1.623-2.845v6.764zm9-3.7l-7 3.985v-8.361l7-3.773v8.149zm-4.907-.802l-.349.199v1.713l.349-.195v-1.717zm.584-.333l-.343.195v1.717l.343-.195v-1.717zm1.395-.794l-.343.195v1.717l.343-.195v-1.717zm-.574.327l-.344.196v1.717l.344-.196v-1.717z"})),b=({width:e,height:t})=>l.a.createElement("svg",{viewBox:"0 0 24 24",style:E(e,t),"data-test":"icon-metadataexport"},l.a.createElement("path",{d:"M13.904 9c-3.514-3.984-.1-7.598-.1-7.598l-1.393-1.389 5.589-.013v5.607l-1.372-1.391c0 .001-3.581.706-2.724 4.784zm5.752 6.024l-.35.199v1.717l.35-.199v-1.717zm.844-.481l-.342.195v1.717l.342-.195v-1.717zm-3.407 1.941l-.349.199v1.713l.349-.195v-1.717zm1.979-1.127l-.343.195v1.717l.343-.195v-1.717zm.949-10.673v2.295l.855.489-6.859 3.698-8.86-5.138 6.374-3.654-1.5-1.406-6.864 3.97-3.167 5.533 2 1.106v5.445l12.25 6.978 9.75-5.551v-11.508l-3.979-2.257zm-16.083 3.004l7.897 4.54-1.193 2.091-7.871-4.605 1.167-2.026zm9.062 13.298l-9-5.126v-3.112l5.632 3.297 1.746 1.022 1.002-1.757.62-1.088v6.764zm9-3.7l-7 3.985v-8.361l7-3.773v8.149zm-4.323-1.135l-.343.195v1.717l.343-.195v-1.717zm.821-.467l-.344.196v1.717l.344-.196v-1.717z"})),v=({width:e,height:t})=>l.a.createElement("svg",{viewBox:"0 0 24 24",style:E(e,t),"data-test":"icon-metadatadependencyexport"},l.a.createElement("path",{d:"M16.949 16.132h2.332c-1.092 1.728-3.605 3.638-6.281 3.852v-8.984h3v-2h-3v-1.103c0-2.39 2-2.619 2-4.897 0-1.654-1.346-3-3-3s-3 1.346-3 3c0 2.297 2 2.487 2 4.897v1.103h-3v2h3v9c-2.639-.18-5.133-2.053-6.281-3.868h2.332l-5.051-3.132v5.912l1.269-1.8c2.702 4.503 6.379 4.305 8.731 6.888 2.352-2.583 6.029-2.385 8.731-6.889l1.269 1.8v-5.911l-5.051 3.132zm-5.949-13.132c0-.551.449-1 1-1s1 .449 1 1-.448 1-1 1-1-.449-1-1z"})),g=({width:e,height:t})=>l.a.createElement("svg",{viewBox:"0 0 24 24",style:E(e,t),"data-test":"icon-data"},l.a.createElement("path",{d:"M6.083 4c1.38 1.612 2.578 3 4.917 3h11v13h-20v-16h4.083zm.917-2h-7v20h24v-17h-13c-1.629 0-2.305-1.058-4-3z"})),y=({width:e,height:t})=>l.a.createElement("svg",{viewBox:"0 0 24 24",style:E(e,t),"data-test":"icon-event"},l.a.createElement("path",{d:"M20 20h-4v-4h4v4zm-6-10h-4v4h4v-4zm6 0h-4v4h4v-4zm-12 6h-4v4h4v-4zm6 0h-4v4h4v-4zm-6-6h-4v4h4v-4zm16-8v22h-24v-22h3v1c0 1.103.897 2 2 2s2-.897 2-2v-1h10v1c0 1.103.897 2 2 2s2-.897 2-2v-1h3zm-2 6h-20v14h20v-14zm-2-7c0-.552-.447-1-1-1s-1 .448-1 1v2c0 .552.447 1 1 1s1-.448 1-1v-2zm-14 2c0 .552-.447 1-1 1s-1-.448-1-1v-2c0-.552.447-1 1-1s1 .448 1 1v2z"})),S=({width:e,height:t})=>l.a.createElement("svg",{viewBox:"0 0 24 24",style:E(e,t),"data-test":"icon-gml"},l.a.createElement("path",{d:"M13.144 8.171c-.035-.066.342-.102.409-.102.074.009-.196.452-.409.102zm-2.152-3.072l.108-.031c.064.055-.072.095-.051.136.086.155.021.248.008.332-.014.085-.104.048-.149.093-.053.066.258.075.262.085.011.033-.375.089-.304.171.096.136.824-.195.708-.176.225-.113.029-.125-.097-.19-.043-.215-.079-.547-.213-.68l.088-.102c-.206-.299-.36.362-.36.362zm13.008 6.901c0 6.627-5.373 12-12 12-6.628 0-12-5.373-12-12s5.372-12 12-12c6.627 0 12 5.373 12 12zm-8.31-5.371c-.006-.146-.19-.284-.382-.031-.135.174-.111.439-.184.557-.104.175.567.339.567.174.025-.277.732-.063.87-.025.248.069.643-.226.211-.381-.355-.13-.542-.269-.574-.523 0 0 .188-.176.106-.166-.218.027-.614.786-.614.395zm6.296 5.371c0-1.035-.177-2.08-.357-2.632-.058-.174-.189-.312-.359-.378-.256-.1-1.337.597-1.5.254-.107-.229-.324.146-.572.008-.12-.066-.454-.515-.605-.46-.309.111.474.964.688 1.076.201-.152.852-.465.992-.038.268.804-.737 1.685-1.251 2.149-.768.694-.624-.449-1.147-.852-.275-.211-.272-.66-.55-.815-.124-.07-.693-.725-.688-.813l-.017.166c-.094.071-.294-.268-.315-.321 0 .295.48.765.639 1.001.271.405.416.995.748 1.326.178.178.858.914 1.035.898.193-.017.803-.458.911-.433.644.152-1.516 3.205-1.721 3.583-.169.317.138 1.101.113 1.476-.029.433-.37.573-.693.809-.346.253-.265.745-.556.925-.517.318-.889 1.353-1.623 1.348-.216-.001-1.14.36-1.261.007-.094-.256-.22-.45-.353-.703-.13-.248-.015-.505-.173-.724-.109-.152-.475-.497-.508-.677-.002-.155.117-.626.28-.708.229-.117.044-.458.016-.656-.048-.354-.267-.646-.53-.851-.389-.299-.188-.537-.097-.964 0-.204-.124-.472-.398-.392-.564.164-.393-.44-.804-.413-.296.021-.538.209-.813.292-.346.104-.7-.082-1.042-.125-1.407-.178-1.866-1.786-1.499-2.946.037-.19-.114-.542-.048-.689.158-.352.48-.747.762-1.014.158-.15.361-.112.547-.229.287-.181.291-.553.572-.781.4-.325.946-.318 1.468-.388.278-.037 1.336-.266 1.503-.06 0 .038.191.604-.019.572.433.023 1.05.749 1.461.579.211-.088.134-.736.567-.423.262.188 1.436.272 1.68.069.15-.124.234-.93.052-1.021.116.115-.611.124-.679.098-.12-.044-.232.114-.425.025.116.055-.646-.354-.218-.667-.179.131-.346-.037-.539.107-.133.108.062.18-.128.274-.302.153-.53-.525-.644-.602-.116-.076-1.014-.706-.77-.295l.789.785c-.039.025-.207-.286-.207-.059.053-.135.02.579-.104.347-.055-.089.09-.139.006-.268 0-.085-.228-.168-.272-.226-.125-.155-.457-.497-.637-.579-.05-.023-.764.087-.824.11-.07.098-.13.201-.179.311-.148.055-.287.126-.419.214l-.157.353c-.068.061-.765.291-.769.3.029-.075-.487-.171-.453-.321.038-.165.213-.68.168-.868-.048-.197 1.074.284 1.146-.235.029-.225.046-.487-.313-.525.068.008.695-.246.799-.36.146-.168.481-.442.724-.442.284 0 .223-.413.354-.615.131.053-.07.376.087.507-.01-.103.445.057.489.033.104-.054.684-.022.594-.294-.1-.277.051-.195.181-.253-.022.009.34-.619.402-.413-.043-.212-.421.074-.553.063-.305-.024-.176-.52-.061-.665.089-.115-.243-.256-.247-.036-.006.329-.312.627-.241 1.064.108.659-.735-.159-.809-.114-.28.17-.509-.214-.364-.444.148-.235.505-.224.652-.476.104-.178.225-.385.385-.52.535-.449.683-.09 1.216-.041.521.048.176.124.104.324-.069.19.286.258.409.099.07-.092.229-.323.298-.494.089-.222.901-.197.334-.536-.374-.223-2.004-.672-3.096-.672-.236 0-.401.263-.581.412-.356.295-1.268.874-1.775.698-.519-.179-1.63.66-1.808.666-.065.004.004-.634.358-.681-.153.023 1.247-.707 1.209-.859-.046-.18-2.799.822-2.676 1.023.059.092.299.092-.016.294-.18.109-.372.801-.541.801-.505.221-.537-.435-1.099.409l-.894.36c-1.328 1.411-2.247 3.198-2.58 5.183-.013.079.334.226.379.28.112.134.112.712.167.901.138.478.479.744.74 1.179.154.259.41.914.329 1.186.108-.178 1.07.815 1.246 1.022.414.487.733 1.077.061 1.559-.217.156.33 1.129.048 1.368l-.361.093c-.356.219-.195.756.021.982 1.818 1.901 4.38 3.087 7.22 3.087 5.517 0 9.989-4.472 9.989-9.989zm-11.507-6.357c.125-.055.293-.053.311-.22.015-.148.044-.046.08-.1.035-.053-.067-.138-.11-.146-.064-.014-.108.069-.149.104l-.072.019-.068.087.008.048-.087.106c-.085.084.002.139.087.102z"})),f=({width:e,height:t})=>l.a.createElement("svg",{viewBox:"0 0 24 24",style:E(e,t),"data-test":"icon-tasks"},l.a.createElement("path",{d:"M19 2h-4.2C14.4.8 13.3 0 12 0c-1.3 0-2.4.8-2.8 2H5C4 2 3 3 3 4v16c0 1 1 2 2 2h14c1 0 2-1 2-2V4c0-1-1-2-2-2zm-7 0c.6 0 1 .5 1 1s-.5 1-1 1-1-.5-1-1 .5-1 1-1zm7 18H5V4h2v3h10V4h2v16z"})),T=({width:e,height:t})=>l.a.createElement("svg",{viewBox:"0 0 24 24",style:E(e,t)},l.a.createElement("path",{fill:"none",d:"M0 0h24v24H0z"}),l.a.createElement("path",{d:"M13 1l.001 3.062A8.004 8.004 0 0 1 19.938 11H23v2l-3.062.001a8.004 8.004 0 0 1-6.937 6.937L13 23h-2v-3.062a8.004 8.004 0 0 1-6.938-6.937L1 13v-2h3.062A8.004 8.004 0 0 1 11 4.062V1h2zm-1 9a2 2 0 1 0 0 4 2 2 0 0 0 0-4z"})),w=[{key:"data",importType:"DATAVALUE_IMPORT",icon:l.a.createElement(g,null),label:o.a.t("Data")},{key:"event",importType:"EVENT_IMPORT",icon:l.a.createElement(y,null),label:o.a.t("Event")},{key:"gml",importType:"GML_IMPORT",icon:l.a.createElement(S,null),label:o.a.t("GML")},{key:"metadata",importType:"METADATA_IMPORT",icon:l.a.createElement(h,null),label:o.a.t("Metadata")},{key:"tei",importType:"TEI_IMPORT",icon:l.a.createElement(T,null),label:o.a.t("TEI")}],D=w.map(({importType:e})=>e),k={events:{resource:"system/tasks/",id:({type:e,taskId:t})=>"".concat(e,"/").concat(t)}},O={summary:{resource:"system/taskSummaries/",id:({type:e,taskId:t})=>"".concat(e,"/").concat(t)}},j={data:{},event:{},gml:{},metadata:{},tei:{}},x={activeTypes:D,selectedJob:void 0},I=()=>{const e=Object(p.c)(),[t,a]=Object(n.useState)(j),[l,r]=Object(n.useState)(x),s=((e,t)=>async(a,n,l)=>{const r={...l},{summary:s,error:o}=await e.query(O,{variables:{type:l.importType,taskId:l.id}});o?console.error("fetchSummary error: ",o):(s&&"ERROR"==s.status&&!r.error&&(r.error=!0),r.summary=s,t(e=>({...e,[a]:{...e[a],[n]:r}})))})(e,a),o=((e,t,a)=>(n,l,r)=>{const s=async()=>{if(r.completed)return;const o={...r},{events:c,error:i}=await e.query(k,{variables:{type:r.importType,taskId:r.id}});if(i)console.error("fetchEvents error: ",i);else{if(c&&c.length){const e=c.filter(e=>!r.events.some(t=>t.id==e.uid)).map(e=>({id:e.uid,level:e.level,text:e.message,date:new Date(e.time)})),t=e.find(e=>"ERROR"==e.level);t&&(o.error=t.text),o.events=[...o.events,...e.reverse()],o.completed=c[0].completed}o.lastUpdated=new Date,o.completed?a(n,l,o):setTimeout(()=>s(n,l,o),2e3),t(e=>({...e,[n]:{...e[n],[l]:o}}))}};s()})(e,a,s);return{tasks:t,addTask:((e,t)=>(a,n,l)=>{e(e=>({...e,[a]:{...e[a],[n]:l}})),t(a,n,l)})(a,o),jobOverview:l,updateJobOverview:(e=>t=>{e(e=>({...e,...t}))})(r)}},_={user:{resource:"me"}},A={data:{resource:"programs",fields:"id,displayName",id:({id:e})=>"".concat(e),params:{fields:"programStages[id,displayName]",paging:"false"}}},C=o.a.t("All program stages"),M={keys:{resource:"metadata/csvImportClasses"}};var N=a(182),U=a.n(N);const R={json:"application/json",xml:"application/xml",csv:"application/csv",gml:"application/xml",adx:"application/adx+xml",pdf:"application/pdf"},F=({url:e,upload:t,type:a,onResponse:n,onError:l,setProgress:r,format:s})=>{const o=new XMLHttpRequest,c=(e=>R[e]||null)(s);return o.withCredentials=!0,o.open("POST",e,!0),o.setRequestHeader("Content-Type",c),o.setRequestHeader("Content-Disposition",'attachment filename="'+t.name+'"'),o.onreadystatechange=P({xhr:o,type:a,onResponse:n,onError:l}),o.upload.onprogress=J(r),o},P=({xhr:e,type:t,onResponse:a,onError:n})=>l=>{const r=Math.floor(e.status/100);if(4===e.readyState&&2===r){const n=L(e);a({...n,type:t})}else 4===e.readyState&&n(l)},L=e=>{const t=JSON.parse(e.responseText),{message:a,status:n,typeReports:l,response:r}=t;return n&&"ERROR"===n&&Array.isArray(l)&&Array.isArray(l[0].objectReports)&&Array.isArray(l[0].objectReports[0].errorReports)?{error:!0,msg:{id:"init",text:l[0].objectReports[0].errorReports[0].message,date:new Date},typeReports:t}:"undefined"!==typeof r?{id:r.id,msg:{id:"init",text:a,date:new Date(r.created)}}:{error:!0}},J=e=>t=>{if(t.lengthComputable){const a=parseInt(t.loaded/t.total*100);e(Math.max(1,a))}},z=e=>{const t=e.split("/");return t[t.length-1]},V=e=>"".concat(e.getFullYear().toString(),"-").concat((e.getMonth()+1).toString().padStart(2,0),"-").concat(e.getDate().toString().padStart(2,0)),q=e=>"".concat(V(e)," ").concat(e.getHours().toString().padStart(2,0),":").concat(e.getMinutes().toString().padStart(2,0),":").concat(e.getSeconds().toString().padStart(2,0),"\n"),B=(e,t)=>"gzip"===t?"application/".concat(e,"+gzip"):"zip"===t?"application/".concat(e,"+zip"):"xml"===e?"application/xml":"json"===e?"application/json":void 0,H=(e,t,a="none")=>URL.createObjectURL(new Blob([e],{type:B(t,a)})),G=(e,t)=>{const a=document.createElement("a");a.href=e,a.setAttribute("download",t),document.body.appendChild(a),a.click(),a.remove()},K=async(e,t)=>{const a="unique:eq:true&filter=".concat(t,":eq:true"),n="".concat(e,"attributes.json?paging=false&fields=").concat("id,displayName","&filter=").concat(a);return(await(e=>fetch(e,{credentials:"include"}).then(e=>{if(e.status>=200&&e.status<300)return Promise.resolve(e.json());throw e}).catch(e=>{const a=new Error(e.statusText||e.status);return console.error("fetchAttributes ".concat(t," fetch error: "),a),Promise.reject(a)}))(n).catch(e=>Promise.reject(e))).attributes.map(({id:e,displayName:t})=>({value:"ATTRIBUTE:".concat(e),label:t}))},X=o.a.t("An unknown error occurred. Please try again later"),W=e=>t=>{const a=(new Date).getTime();return e(0),{id:"xhr-".concat(a),critical:!0,message:t||X}},Y=({url:e,file:t,format:a,type:n,setProgress:l,addEntry:r})=>{l(1);const s=W(l);return new Promise((o,c)=>{try{F({url:e,upload:t,type:n,onResponse:({error:e,id:t,msg:a,typeReports:i})=>{let m;m=e&&a?{id:(new Date).getTime(),level:"ERROR",created:new Date,lastUpdated:new Date,completed:!0,events:[a],summary:i,error:!0,importType:n}:e?{id:(new Date).getTime(),level:"ERROR",created:new Date,lastUpdated:new Date,completed:!0,summary:void 0,error:!0,importType:n}:{id:t,level:"INFO",created:new Date,lastUpdated:new Date,completed:!1,events:[a],summary:void 0,error:!1,importType:n},r(m.id,m),e&&c(s(a&&a.text)),l(0),o({})},onError:e=>{let t;try{t=JSON.parse(e.target.response).message}catch(a){t=X}console.error("sendFile error",t),c(s(t))},setProgress:l,format:a}).send(t)}catch(i){c(W(i))}})},Z=e=>{window.locationAssign?window.locationAssign(e):window.location=e},$=(e,t)=>{if(!e||!e.id)return{};const a=t[e.id];return a?a.jobDetails:{}};var Q=a(3),ee=a.n(Q);const te=ee.a.exact({value:ee.a.string.isRequired,label:ee.a.string.isRequired}),ae=(ee.a.arrayOf(te),({name:e,label:t,dataElementIdSchemeOptions:a,dataTest:r})=>{const{baseUrl:s}=Object(p.b)(),[i,m]=Object(n.useState)(!0),[d,u]=Object(n.useState)([]),[E,h]=Object(n.useState)(void 0);Object(n.useEffect)(()=>{K("".concat(s,"/api/"),"dataElementAttribute").then(e=>u(e)).catch(e=>h(e)),m(!1)},[]);const b=E&&"".concat(o.a.t("Something went wrong when loading the additional data element ID schemes")," : ").concat(E.message),v=[...a,...d];return l.a.createElement(uc,{component:c.x,name:e,label:t,options:v,dataTest:r,loading:i,validationText:b,error:!!E})}),ne=({name:e,error:t,label:a,date:n,onChange:r,dataTest:s})=>{const o=n&&V(n);return l.a.createElement(c.o,{type:"date",name:e,value:o,label:a,onChange:({value:e})=>{r(e?new Date(e):e)},inputWidth:"200px",error:!!t,validationText:t,dataTest:s})},{Field:le}=c.v,re=e=>e?se(e):void 0,se=e=>"Invalid Date"==new Date(e)?o.a.t("Invalid date"):void 0,oe=(e,t)=>e>t?o.a.t("Start date must be before end date"):void 0,ce=(e,t)=>e<t?o.a.t("End date must be after start date"):void 0,ie=({input:{value:e,onChange:t},meta:{error:a},inputName:n,...r})=>l.a.createElement(ne,Object.assign({name:n,error:a,date:e,onChange:t},r)),me=({name:e,validator:t,...a})=>l.a.createElement(le,Object.assign({component:ie,name:e,validate:t,inputName:e},a)),de=({name:e,label:t,eventIdSchemeOptions:a,dataTest:n})=>l.a.createElement(uc,{component:c.x,name:e,label:t,options:a,dataTest:n}),{Field:ue}=c.v,pe=({initialValue:e,required:t,name:a,label:n,helpText:r,accept:s="*",validator:o,dataTest:i})=>l.a.createElement(ye,{label:n,required:t,dataTest:i},l.a.createElement(ue,{component:c.m,name:a,accept:s,required:t,initialValue:e,validate:o,dataTest:"".concat(i,"-fileinput"),helpText:r}));var Ee=a(183),he=a.n(Ee);const be=({alerts:e,dataTest:t})=>{const[a,r]=Object(n.useState)([]);return Object(n.useEffect)(()=>{if(e){const t=e.map(e=>l.a.createElement(c.a,{key:"alert-".concat(e.id),warning:e.warning,info:e.info,critical:e.critical,success:e.success,duration:8e3},e.message));r(t)}},[e]),0==a.length?null:l.a.createElement("div",{className:he.a.container,"data-test":t},a)};var ve=a(184),ge=a.n(ve);const ye=({dataTest:e,label:t,required:a=!1,children:n})=>l.a.createElement("div",{className:ge.a.container,"data-test":e},l.a.createElement("span",{className:ge.a.label},t,a&&l.a.createElement("span",null," *")),n),Se=({name:e,label:t,idSchemeOptions:a,dataTest:r})=>{const{baseUrl:s}=Object(p.b)(),[i,m]=Object(n.useState)(!0),[d,u]=Object(n.useState)([]),[E,h]=Object(n.useState)(void 0);Object(n.useEffect)(()=>{(async()=>{let e;const t=await K("".concat(s,"/api/"),"dataElementAttribute").catch(t=>e=t),a=await K("".concat(s,"/api/"),"organisationUnitAttribute").catch(t=>e=t);if(h(e),!e){const e=t.reduce((e,t)=>((e,t)=>!!t.find(({value:t})=>t===e.value))(t,a)?[...e,t]:e,[]);u(e)}m(!1)})()},[]);const b=E&&"".concat(o.a.t("Something went wrong when loading the additional ID schemes")," : ").concat(E.message),v=[...a,...d];return l.a.createElement(uc,{component:c.x,name:e,label:t,options:v,dataTest:r,loading:i,validationText:b,error:!!E})};var fe=a(185),Te=a.n(fe);const we=o.a.t("A dry run tests the import settings without importing any data"),De=({dryRunDataTest:e,importDataTest:t,form:a,dataTest:n})=>l.a.createElement("div",{className:Te.a.container,"data-test":n},l.a.createElement(c.c,{dataTest:"".concat(n,"-button-strip")},l.a.createElement(c.b,{primary:!0,type:"submit",onClick:()=>a.change("dryRun",!0),dataTest:e,className:Te.a.dryRun},o.a.t("Start dry run")),l.a.createElement(c.b,{secondary:!0,type:"submit",onClick:()=>a.change("dryRun",!1),dataTest:t},o.a.t("Start import"))),l.a.createElement(c.n,{dataTest:"".concat(n,"-help")},we));var ke=a(177),Oe=a.n(ke);const je=w.reduce((e,t)=>(e[t.importType]=t,e),{});var xe=a(186),Ie=a.n(xe);const _e=({task:e})=>{return l.a.createElement("div",{className:Ie.a.container,"data-test":"job-overview-menu-label-".concat(e.id)},l.a.createElement("div",{className:Ie.a.status},l.a.createElement("span",null,(t=15,(a=e.jobDetails.files[0].name).length>t?a.substring(0,t-3)+"...":a)),l.a.createElement("br",null),l.a.createElement("span",null,e.completed?o.a.t("Completed"):o.a.t("In progress")," ")),l.a.createElement("div",{className:Ie.a.date},q(e.created)));var t,a},Ae=({children:e})=>l.a.createElement("div",{className:Oe.a.chips,"data-test":"job-overview-chips"},e),Ce=({activeTypes:e,setActiveTypes:t,selectedJob:a,setSelectedJob:s})=>{const{tasks:i}=Object(n.useContext)(d),m=w.map(({key:e})=>Object.keys(i[e]).map(t=>i[e][t])).flat().sort((e,t)=>e.importType>t.importType||e.createdAt>t.createdAt?-1:void 0),u=m.filter(t=>e.includes(t.importType));return Object(n.useEffect)(()=>{!a&&m.length>0&&s(m[0])},[]),a?l.a.createElement("div",{className:Oe.a.container,"data-test":"job-overview-container"},l.a.createElement("div",{className:Oe.a.items,"data-test":"job-overview-tasks"},l.a.createElement(c.q,{className:Oe.a.Menu},l.a.createElement(Ae,null,w.map(({key:a,importType:n,label:r})=>l.a.createElement(c.g,{onClick:()=>(a=>{e.includes(a)?t([...e].filter(e=>e!=a)):t([...e,a])})(n),selected:e.includes(n),key:a,dataTest:"job-overview-chips-".concat(a)},r))),u.map(e=>l.a.createElement(c.r,{key:"job-overview-tasks-".concat(e.id),active:a.id==e.id,label:l.a.createElement(_e,{task:e}),onClick:()=>s(e),icon:je[e.importType].icon})))),l.a.createElement("div",{className:Oe.a.summary,"data-test":"job-overview-summary"},l.a.createElement(Ze,{task:a,dataTest:"job-summary-container",showFileDetails:!1,showJobDetails:!0}),l.a.createElement(r.b,{to:(p=a,{pathname:"/import/".concat(je[p.importType].key),query:{id:p.id}})},l.a.createElement(c.b,{primary:!0},o.a.t("Recreate job"))))):l.a.createElement("p",null,o.a.t("No jobs started yet."));var p};var Me=a(193),Ne=a.n(Me);const Ue=({events:e})=>l.a.createElement(ye,{label:"".concat(o.a.t("Events")),dataTest:"job-summary-events",name:"events"},l.a.createElement(c.A,null,l.a.createElement(c.E,null,l.a.createElement(c.G,null,l.a.createElement(c.D,null,o.a.t("Time")),l.a.createElement(c.D,null,o.a.t("Message")),l.a.createElement(c.D,null,o.a.t("ID")))),l.a.createElement(c.B,null,e.map((e,t)=>l.a.createElement(c.F,{key:"job-summary-events-".concat(e.id,"-").concat(t)},l.a.createElement(c.C,null,q(e.date)),l.a.createElement(c.C,null,e.text),l.a.createElement(c.C,null,e.id))))));var Re=a(194),Fe=a.n(Re);const Pe={deleted:ee.a.number.isRequired,ignored:ee.a.number.isRequired,total:ee.a.number.isRequired,updated:ee.a.number.isRequired,imported:ee.a.number,created:ee.a.number},Le=(ee.a.exact(Pe),e=>{const t=e.split(".");return t[t.length-1]}),Je=(ee.a.arrayOf(ee.a.exact({uid:ee.a.string,type:ee.a.string,property:ee.a.string,message:ee.a.string})),({status:e,description:t})=>l.a.createElement(c.A,null,l.a.createElement(c.E,null,l.a.createElement(c.G,null,l.a.createElement(c.D,null,o.a.t("Status")),l.a.createElement(c.D,null,o.a.t("Description")))),l.a.createElement(c.B,null,l.a.createElement(c.F,null,l.a.createElement(c.C,null,e),l.a.createElement(c.C,null,t))))),ze=({importCount:e,status:t,description:a,conflicts:n,id:r})=>l.a.createElement("div",null,l.a.createElement(ye,{label:"".concat(o.a.t("Summary")," #").concat(r),dataTest:"job-summary-single-summary",name:"summary"},l.a.createElement(l.a.Fragment,null,t&&l.a.createElement(Je,{description:a,status:t}),l.a.createElement(c.A,null,l.a.createElement(c.E,null,l.a.createElement(c.G,null,l.a.createElement(c.D,null,o.a.t("Created")),l.a.createElement(c.D,null,o.a.t("Deleted")),l.a.createElement(c.D,null,o.a.t("Ignored")),l.a.createElement(c.D,null,o.a.t("Updated")),l.a.createElement(c.D,null,o.a.t("Total")))),l.a.createElement(c.B,null,l.a.createElement(c.F,null,l.a.createElement(c.C,null,e.imported),l.a.createElement(c.C,null,e.deleted),l.a.createElement(c.C,null,e.ignored),l.a.createElement(c.C,null,e.updated),l.a.createElement(c.C,null,e.total)))))),n&&l.a.createElement(ye,{label:"".concat(o.a.t("Conflicts")),dataTest:"job-summary-conflicts",name:"conflicts"},l.a.createElement(c.A,null,l.a.createElement(c.E,null,l.a.createElement(c.G,null,l.a.createElement(c.D,null,o.a.t("Object")),l.a.createElement(c.D,null,o.a.t("Value")))),l.a.createElement(c.B,null,n.map((e,t)=>l.a.createElement(c.F,{key:"job-summary-conflicts-".concat(e.object,"-").concat(t)},l.a.createElement(c.C,null,e.object),l.a.createElement(c.C,null,e.value))))))),Ve=({stats:e})=>0==e.length?null:l.a.createElement(ye,{label:"".concat(o.a.t("Type count")),dataTest:"job-summary-type-count",name:"typeCount"},l.a.createElement(c.A,null,l.a.createElement(c.E,null,l.a.createElement(c.G,null,l.a.createElement(c.D,null,o.a.t("Type")),l.a.createElement(c.D,null,o.a.t("Created")),l.a.createElement(c.D,null,o.a.t("Deleted")),l.a.createElement(c.D,null,o.a.t("Ignored")),l.a.createElement(c.D,null,o.a.t("Updated")),l.a.createElement(c.D,null,o.a.t("Total")))),l.a.createElement(c.B,null,e.map((e,t)=>l.a.createElement(c.F,{key:"job-summary-type-count-".concat(t)},l.a.createElement(c.C,null,e.type),l.a.createElement(c.C,null,e.created),l.a.createElement(c.C,null,e.deleted),l.a.createElement(c.C,null,e.ignored),l.a.createElement(c.C,null,e.updated),l.a.createElement(c.C,null,e.total)))))),qe=(ee.a.string.isRequired,({messages:e})=>0==e.length?null:l.a.createElement(ye,{label:"".concat(o.a.t("Messages")),dataTest:"job-summary-messages",name:"messages"},l.a.createElement(c.A,null,l.a.createElement(c.E,null,l.a.createElement(c.G,null,l.a.createElement(c.D,null,o.a.t("UID")),l.a.createElement(c.D,null,o.a.t("Type")),l.a.createElement(c.D,null,o.a.t("Property")),l.a.createElement(c.D,null,o.a.t("Message")))),l.a.createElement(c.B,null,e.map((e,t)=>l.a.createElement(c.F,{key:"job-summary-messages-".concat(t)},l.a.createElement(c.C,null,e.uid),l.a.createElement(c.C,null,e.type),l.a.createElement(c.C,null,e.property),l.a.createElement(c.C,null,e.message))))))),Be=({overviewStats:e,stats:t,messages:a})=>l.a.createElement("div",null,l.a.createElement(ze,{importCount:e,id:o.a.t("Overview")}),l.a.createElement(Ve,{stats:t}),l.a.createElement(qe,{messages:a})),He=e=>{if("ImportSummaries"==e.responseType){const{imported:t,deleted:a,ignored:n,updated:l,total:r}=e;return{imported:t,deleted:a,ignored:n,updated:l,total:r}}if(e.importCount){const{imported:t,deleted:a,ignored:n,updated:l}=e.importCount;return{imported:t,deleted:a,ignored:n,updated:l,total:t+a+n+l}}if(e.stats){const{imported:t,deleted:a,ignored:n,updated:l,total:r}=e.stats;return{imported:t,deleted:a,ignored:n,updated:l,total:r}}},Ge=({summary:e})=>{if(e.typeReports){const t={...e.stats,imported:e.stats.created},{stats:a,messages:n}=(e=>{let t=[];const a=[];return Object.keys(e).forEach(n=>{const{klass:l,objectReports:r,stats:s}=e[n];t=[...t,{...s,type:Le(l)}],r&&r.forEach(e=>{const{uid:t,errorReports:n}=e;n&&n.forEach(e=>{a.push({uid:t,type:Le(e.mainKlass),property:e.errorProperty,message:e.message})})})}),{stats:t,messages:a}})(e.typeReports);return l.a.createElement("div",{"data-test":"job-summary-summary"},l.a.createElement(Be,{overviewStats:t,stats:a,messages:n}))}const t=He(e),a=l.a.createElement(ze,{importCount:t,status:e.status,description:e.description,conflicts:e.conflicts,id:o.a.t("Overview")}),n="ImportSummaries"==e.responseType&&e.importSummaries?e.importSummaries.map((e,t)=>{const a=He(e);return l.a.createElement(ze,{key:"single-summary-".concat(t),importCount:a,status:e.status,description:e.description,conflicts:e.conflicts,id:"".concat(t+1)})}):null;return l.a.createElement("div",{"data-test":"job-summary-summary"},a,l.a.createElement("div",{className:Fe.a.rest,"data-test":"job-summary-summary-rest"},n))},Ke=e=>e instanceof File?e.name:Array.isArray(e)?e.map(e=>Ke(e)).join(","):e instanceof Object?e.label:"".concat(e),Xe=({details:e})=>l.a.createElement(ye,{label:"".concat(o.a.t("Job details")),dataTest:"job-summary-job-details",name:"details"},l.a.createElement(c.A,null,l.a.createElement(c.E,null,l.a.createElement(c.G,null,l.a.createElement(c.D,null,o.a.t("Key")),l.a.createElement(c.D,null,o.a.t("Value")))),l.a.createElement(c.B,null,Object.keys(e).map(t=>l.a.createElement(c.F,{key:"job-summary-job-details-".concat(t)},l.a.createElement(c.C,null,t),l.a.createElement(c.C,null,Ke(e[t]))))))),We=({jobDetails:e,task:t,showFileDetails:a})=>l.a.createElement("div",{className:Ne.a.header},l.a.createElement("h3",{className:Ne.a.title},"".concat(o.a.t("Job summary"))),a&&l.a.createElement("span",{className:Ne.a.taskDetails},l.a.createElement("span",{"data-test":"job-summary-filename"},e.files[0].name)," ","-"," ",l.a.createElement("span",{"data-test":"job-summary-date"},q(t.created)," "))),Ye=({jobDetails:e,task:t})=>l.a.createElement("div",{className:Ne.a.tags,"data-test":"job-summary-tags"},t.completed?l.a.createElement(c.H,{positive:!0},o.a.t("Completed")):l.a.createElement(c.H,{neutral:!0},o.a.t("In progress")),t.error&&l.a.createElement(c.H,{negative:!0,bold:!0},o.a.t("Error")),t.summary&&t.summary.conflicts&&l.a.createElement(c.H,{negative:!0},o.a.t("Conflicts")),e.dryRun&&l.a.createElement(c.H,{neutral:!0,bold:!0},o.a.t("Dry run"))),Ze=({task:e,showFileDetails:t=!0,showJobDetails:a=!1,dataTest:n})=>{if(!e)return null;const{jobDetails:r}=e;return l.a.createElement("div",{className:Ne.a.container,"data-test":n},l.a.createElement(We,{jobDetails:r,task:e,showFileDetails:t}),l.a.createElement(Ye,{jobDetails:r,task:e}),l.a.createElement(c.l,null),e.completed&&e.summary&&l.a.createElement(Ge,{summary:e.summary}),l.a.createElement("div",{className:Ne.a.events},l.a.createElement(Ue,{events:e.events})),a&&l.a.createElement("div",{className:Ne.a.jobDetails},l.a.createElement(Xe,{details:e.jobDetails})))},$e=({task:e,dataTest:t})=>e?l.a.createElement("div",{"data-test":t},l.a.createElement(lt,{label:o.a.t("View summary of recently started import job"),dataTest:"".concat(t,"-MoreOptions"),noBottomMargin:!0},l.a.createElement(Ze,{task:e,dataTest:"".concat(t,"-JobSummary")}))):null;var Qe=a(5),et=a.n(Qe),tt=a(175),at=a(195),nt=a.n(at);const lt=({children:e,initiallyVisible:t,noBottomMargin:a,label:r=o.a.t("Advanced options"),dataTest:s="interaction-more-options"})=>{const[i,m]=Object(n.useState)(!t);return l.a.createElement("section",{className:et()({[nt.a.container]:!a}),"data-test":s},l.a.createElement("header",{className:nt.a.header,onClick:()=>{m(!i)},"data-test":"".concat(s,"-header")},l.a.createElement(tt.j,{className:et()({[nt.a.chevronHidden]:i,[nt.a.chevronVisible]:!i})}),l.a.createElement("h2",{className:nt.a.label},r)),l.a.createElement(c.l,null),l.a.createElement("div",{className:nt.a.children,"data-test":"".concat(s,"-children")},!i&&e))};lt.defaultProps={initiallyVisible:!1,noBottomMargin:!1};const rt=({name:e,label:t,orgUnitIdSchemeOptions:a,dataTest:r})=>{const{baseUrl:s}=Object(p.b)(),[i,m]=Object(n.useState)(!0),[d,u]=Object(n.useState)([]),[E,h]=Object(n.useState)(void 0);Object(n.useEffect)(()=>{K("".concat(s,"/api/"),"organisationUnitAttribute").then(e=>u(e)).catch(e=>h(e)),m(!1)},[]);const b=E&&"".concat(o.a.t("Something went wrong when loading the additional organisation unit ID schemes")," : ").concat(E.message),v=[...a,...d];return l.a.createElement(uc,{component:c.x,name:e,label:t,options:v,dataTest:r,loading:i,validationText:b,error:!!E})},{Field:st}=c.v,ot={roots:{resource:"organisationUnits",params:{filter:"level:eq:1",fields:"id",paging:"false"}}},ct=e=>0==e.length?o.a.t("At least one organisation unit must be selected"):void 0,it=e=>1!=e.length?o.a.t("One organisation unit must be selected"):void 0,mt=({input:{value:e,onChange:t},meta:a,multiSelect:n,...r})=>{const{loading:s,data:i,error:m}=Object(p.d)(ot);return l.a.createElement(l.a.Fragment,null,s&&l.a.createElement(c.h,null),m&&l.a.createElement(c.n,{error:!0},o.a.t("Something went wrong when loading the organisation units!")),i&&l.a.createElement(c.t,Object.assign({onChange:({selected:e})=>{t(e)},selected:e,roots:i.roots.organisationUnits.map(e=>e.id)},r,{singleSelection:!n})),(a.touched||!a.pristine)&&a.error&&l.a.createElement(c.n,{error:!0},a.error))},dt=({name:e,validator:t,...a})=>l.a.createElement(st,Object.assign({component:mt,name:e,validate:t},a));var ut=a(196),pt=a.n(ut);const Et=({title:e,desc:t,summaryTask:a,showFullSummaryTask:n=!1,limitWidth:r=!0,children:s,loading:o=!1,dataTest:i})=>{const m="number"==typeof o?l.a.createElement(c.p,{amount:o}):l.a.createElement(c.h,null);return l.a.createElement("div",{className:et()(pt.a.container,{[pt.a.limitedWidth]:r}),"data-test":i},l.a.createElement("header",{className:pt.a.header},l.a.createElement("h1",{className:pt.a.title},e),l.a.createElement("p",{className:pt.a.desc},t)),a&&l.a.createElement(c.d,{className:pt.a.preBody},n?l.a.createElement(Ze,{task:a,dataTest:"job-summary-container"}):l.a.createElement($e,{task:a,dataTest:"mini-job-summary-container"})),l.a.createElement("div",{className:pt.a.content},!!o&&l.a.createElement(c.i,null,m),s))};var ht=a(197),bt=a.n(ht);const vt=({name:e,label:t,selectedProgram:a,form:r,validator:s,dataTest:i})=>{const{loading:m,error:d,validationText:u,programStages:E}=((e,t)=>{const a=Object(p.c)(),[l,r]=Object(n.useState)(void 0),[s,c]=Object(n.useState)(!0),[i,m]=Object(n.useState)([]);Object(n.useEffect)(()=>{e?(c(!0),t(void 0)):c(!1),e&&a.query(A,{variables:{id:e},onComplete:e=>{const a=e.data.programStages.map(e=>({value:e.id,label:e.displayName}));m([{value:"ALL",label:C},...a]),t("ALL"),c(!1)},onError:e=>{r(e),console.error("useProgramStages error: ",e)}})},[e]);return{loading:s,error:l,validationText:l&&"".concat(o.a.t("Something went wrong when loading the program stages")," : ").concat(l.message),programStages:i}})(a,t=>r.change(e,t));return l.a.createElement("div",{className:bt.a.container},l.a.createElement(uc,{component:c.x,name:e,loading:m,label:t,validate:s,dataTest:i,options:E,validationText:u,error:!!d}))};var gt=a(198),yt=a.n(gt);const St=({name:e,label:t,options:a,checked:n,setValue:r,vertical:s,helpText:o,dataTest:i})=>l.a.createElement(ye,{label:t,dataTest:i,name:e},l.a.createElement("div",{className:et()({[yt.a.vertical]:s,[yt.a.horizontal]:!s})},a.map(t=>l.a.createElement("div",{key:t.value},l.a.createElement(c.u,{name:e,value:t.value,label:t.label,checked:t.value==n,onChange:()=>r(t.value),dataTest:"".concat(i,"-").concat(t.value)}),t.help&&l.a.createElement(c.n,null,t.help)))),o&&l.a.createElement(c.n,null,o)),{Field:ft}=c.v,Tt=({input:{value:e,onChange:t},meta:{error:a},inputName:n,...r})=>l.a.createElement(St,Object.assign({name:n,error:a,checked:e,setValue:t},r)),wt=({name:e,...t})=>l.a.createElement(ft,Object.assign({component:Tt,name:e,inputName:e},t));var Dt=a(171);const kt=({children:e})=>{const t=Object(Dt.g)();return Object(n.useEffect)(()=>{const e=t.listen(()=>{var e;null===(e=document.getElementsByClassName("app-shell-app")[0])||void 0===e||e.scrollTo(0,0)});return()=>{e()}},[]),l.a.createElement(l.a.Fragment,null,e)};kt.propTypes={children:ee.a.node};const Ot=o.a.t("Select a file to import values from"),jt=e=>e&&0!=e.length?void 0:o.a.t("Please select a file"),xt=({helpText:e})=>l.a.createElement(pe,{name:"files",label:Ot,validator:jt,dataTest:"input-file-upload",helpText:e}),It=({form:e})=>l.a.createElement(De,{form:e,dryRunDataTest:"input-dry-run",importDataTest:"input-import-submit",dataTest:"input-import-button-strip"}),_t=({alerts:e})=>l.a.createElement(be,{alerts:e,dataTest:"input-form-alerts"}),At=[{value:"json",label:o.a.t("JSON")},{value:"csv",label:o.a.t("CSV")},{value:"xml",label:o.a.t("XML")}],Ct=At.filter(e=>"csv"!=e.value),Mt=[...[...At,{value:"adx",label:o.a.t("ADX")}],{value:"pdf",label:o.a.t("PDF")}],Nt=[...At,{value:"jsonp",label:o.a.t("JSONP")}],Ut=At[0].value,Rt=o.a.t("What format is the data to import?"),Ft=o.a.t("What format should the data be exported as?"),Pt=e=>"import"===e?Rt:Ft,Lt=({availableFormats:e,type:t})=>l.a.createElement(wt,{name:"format",label:Pt(t),options:e,dataTest:"input-format"}),{Field:Jt}=c.v,zt=o.a.t("Is the first row a header row?"),Vt=o.a.t("First row is header"),qt=o.a.t("A header row will be ignored during import"),Bt=({show:e})=>e&&l.a.createElement(ye,{label:zt,dataTest:"input-first-row-is-header"},l.a.createElement(Jt,{type:"checkbox",component:c.f,name:"firstRowIsHeader",label:Vt,helpText:qt,dataTest:"".concat("input-first-row-is-header","-sf")})),Ht=o.a.t("Class key"),Gt=({form:e,prevValue:t,show:a=!0})=>{const{loading:r,error:s,validationText:i,classKeys:m}=((e,t)=>{const[a,l]=Object(n.useState)([]),{loading:r,error:s}=Object(p.d)(M,{onComplete:a=>{l(a.keys.map(e=>({value:e,label:e}))),e(t||a.keys[0])},onError:e=>{console.error("useClassKeys error: ",e)}});return{loading:r,error:s,validationText:s&&"".concat(o.a.t("Something went wrong when loading the class keys")," : ").concat(s.message),classKeys:a}})(t=>e.change("classKey",t),t);return a&&l.a.createElement(uc,{component:c.x,name:"classKey",label:Ht,options:m,loading:r,dataTest:"input-class-key",validationText:i,error:!!s,filterable:!0})},Kt=[{value:"NEW_AND_UPDATES",label:o.a.t("Import new values and update existing")},{value:"NEW",label:o.a.t("Import new values only")},{value:"UPDATES",label:o.a.t("Only update existing values, ignore new values")},{value:"DELETE",label:o.a.t("Remove values not included in uploaded file")}],Xt=Kt[0].value,Wt=o.a.t("Strategy"),Yt=()=>l.a.createElement(wt,{name:"strategy",label:Wt,options:Kt,dataTest:"input-strategy",vertical:!0}),{Field:Zt}=c.v,$t=o.a.t("Preheat cache"),Qt=o.a.t("Preheat cache to make large imports faster"),ea=o.a.t("Large imports will be processed faster but will consume more resources"),ta=()=>l.a.createElement(ye,{label:$t,dataTest:"input-preheat-cache"},l.a.createElement(Zt,{type:"checkbox",component:c.f,name:"preheatCache",label:Qt,helpText:ea,dataTest:"".concat("input-preheat-cache","-sf")})),{Field:aa}=c.v,na=o.a.t("Skip audit"),la=o.a.t("Skip audit, meaning audit values will not be generated"),ra=o.a.t("Improves performance at the cost of ability to audit changes"),sa=()=>l.a.createElement(ye,{label:na,dataTest:"input-has-authority-to-skip-audit"},l.a.createElement(aa,{type:"checkbox",component:c.f,name:"skipAudit",label:la,helpText:ra,dataTest:"".concat("input-has-authority-to-skip-audit","-sf")})),{Field:oa}=c.v,ca=o.a.t("Skip exisiting check"),ia=o.a.t("Skip checks for existing data values"),ma=o.a.t("Improves performance and should only be used for empty databases or when the data values to import do not exist already"),da=()=>l.a.createElement(ye,{label:ca,dataTest:"input-skip-exisiting-check"},l.a.createElement(oa,{type:"checkbox",component:c.f,name:"skipExistingCheck",label:ia,helpText:ma,dataTest:"".concat("input-skip-exisiting-check","-sf")})),ua=[{value:"UID",label:o.a.t("UID")},{value:"CODE",label:o.a.t("Code")},{value:"AUTO",label:o.a.t("Auto")}],pa=ua[0].value,Ea=o.a.t("Identifier"),ha=o.a.t("Identifier scheme to use for reference matching"),ba=()=>l.a.createElement(wt,{name:"identifier",label:Ea,options:ua,helpText:ha,dataTest:"input-identifier"}),va=[{value:"ERRORS",label:o.a.t("Only include reports for objects that have errors")},{value:"FULL",label:o.a.t("Reports for all objects imported")},{value:"DEBUG",label:o.a.t("Reports for all objects imported along with their names (if available)")}],ga=va[0].value,ya=o.a.t("Import report mode"),Sa=o.a.t("Controls what should be reported after the import is done"),fa=()=>l.a.createElement(wt,{name:"importReportMode",label:ya,options:va,helpText:Sa,dataTest:"input-import-report-mode",vertical:!0}),Ta=[{value:"REFERENCE",label:o.a.t("Intelligent scan")},{value:"ALL",label:o.a.t("All")},{value:"NONE",label:o.a.t("None")}],wa=Ta[0].value,Da=o.a.t("Preheat mode"),ka=o.a.t("Controls the level of preheating that should be done"),Oa=()=>l.a.createElement(wt,{name:"preheatMode",label:Da,options:Ta,helpText:ka,dataTest:"input-preheat-mode"}),ja=[{value:"CREATE_AND_UPDATE",label:o.a.t("Import new values and update existing")},{value:"CREATE",label:o.a.t("Import new values only")},{value:"UPDATES",label:o.a.t("Only update existing values, ignore new values")},{value:"DELETE",label:o.a.t("Remove values not included in uploaded file")}],xa=ja[0].value,Ia=o.a.t("Import strategy"),_a=()=>l.a.createElement(wt,{name:"importStrategy",label:Ia,options:ja,dataTest:"input-import-strategy",vertical:!0}),Aa=[{value:"ALL",label:o.a.t("Do not import")},{value:"NONE",label:o.a.t("Import")}],Ca=Aa[0].value,Ma=o.a.t("Atomic mode"),Na=o.a.t("Whether to import objects even if some references do not exist"),Ua=()=>l.a.createElement(wt,{name:"atomicMode",label:Ma,options:Aa,helpText:Na,dataTest:"input-atomic-mode"}),Ra=[{value:"MERGE",label:o.a.t("Only overwrite the old property if the new property value is not-null")},{value:"REPLACE",label:o.a.t("Overwrite regardless of whether the new property value is null")}],Fa=Ra[0].value,Pa=o.a.t("Merge mode"),La=o.a.t("Strategy to take when merging two objects"),Ja=()=>l.a.createElement(wt,{name:"mergeMode",label:Pa,options:Ra,helpText:La,dataTest:"input-merge-mode",vertical:!0}),za=[{value:"AUTO",label:o.a.t("Auto (recommended)")},{value:"OBJECT",label:o.a.t("Object (debugging purposes)")}],Va=za[0].value,qa=o.a.t("Flush mode"),Ba=o.a.t("Controls when to flush the internal cache"),Ha=()=>l.a.createElement(wt,{name:"flushMode",label:qa,options:za,helpText:Ba,dataTest:"input-flush-mode"}),Ga=[{value:"NON_NULL",label:o.a.t("Includes properties which are not null")},{value:"ALWAYS",label:o.a.t("Include all properties")},{value:"NON_EMPTY",label:o.a.t("Include non-empty properties")}],Ka=Ga[0].value,Xa=o.a.t("Inclusion strategy"),Wa=o.a.t("Controls which properties to include"),Ya=()=>l.a.createElement(wt,{name:"inclusionStrategy",label:Xa,options:Ga,helpText:Wa,dataTest:"input-inclusion-strategy",vertical:!0}),{Field:Za}=c.v,$a=o.a.t("Skip sharing"),Qa=o.a.t("Skip sharing and access settings"),en=o.a.t("Skip sharing properties, do not merge sharing when doing updates, and do not add user group access when creating new objects"),tn=()=>l.a.createElement(ye,{label:$a,dataTest:"input-skip-sharing"},l.a.createElement(Za,{type:"checkbox",component:c.f,name:"skipSharing",label:Qa,helpText:en,dataTest:"".concat("input-skip-sharing","-sf")})),{Field:an}=c.v,nn=o.a.t("Skip validation"),ln=o.a.t("Skip validation for import (not recommended)"),rn=()=>l.a.createElement(ye,{label:nn,dataTest:"input-skip-validation"},l.a.createElement(an,{type:"checkbox",component:c.f,name:"skipValidation",label:ln,dataTest:"".concat("input-skip-validation","-sf")})),{Field:sn}=c.v,on=o.a.t("Async"),cn=o.a.t("Asynchronous import"),mn=o.a.t("Controls whether the import is done asynchronously"),dn=()=>l.a.createElement(ye,{label:on,dataTest:"input-is-async"},l.a.createElement(sn,{type:"checkbox",component:c.f,name:"isAsync",label:cn,helpText:mn,dataTest:"".concat("input-is-async","-sf")})),un=o.a.t("Organisation unit(s) to export data from"),pn=({multiSelect:e})=>{const t=e?ct:it,a=Object(c.J)(c.K,t);return l.a.createElement(ye,{label:un,dataTest:"input-org-unit-tree"},l.a.createElement(dt,{name:"selectedOrgUnits",validator:a,multiSelect:e,label:un,dataTest:"input-org-unit-tree"}))};pn.defaultProps={multiSelect:!0};const En=1,hn=2,bn=3,vn=4,gn=o.a.t("Which data sets should be included in export?"),yn=o.a.t("Filter data sets"),Sn=o.a.t("Selected data sets"),fn=o.a.t("Something went wrong when loading the data sets!"),Tn=En,wn=e=>0==e.length?o.a.t("At least one data set must be selected"):void 0,Dn=e=>1!=e.length?o.a.t("One data set must be selected"):void 0,kn=({multiSelect:e=!0})=>{const t=e?wn:Dn,a=Object(c.J)(c.K,t);return l.a.createElement(tc,{name:"selectedDataSets",resourceType:Tn,errorMessage:fn,listName:"dataSetPicker",label:gn,filterLabel:yn,selectedLabel:Sn,dataTest:"input-data-set-picker",validator:a,multiSelect:e})},On=o.a.t("Program to export events from"),jn=o.a.t("Filter programs"),xn=o.a.t("Selected programs"),In=o.a.t("Something went wrong when loading the programs!"),_n=hn,An=e=>0==e.length?o.a.t("At least one program must be selected"):void 0,Cn=e=>e?void 0:o.a.t("One program must be selected"),Mn=({multiSelect:e,label:t,show:a,...n})=>{const r=e?An:Cn,s=Object(c.J)(c.K,r);return a&&l.a.createElement("div",{style:{maxWidth:"480px"}},l.a.createElement(tc,Object.assign({name:"selectedPrograms",resourceType:_n,errorMessage:In,listName:"selectedPrograms",label:t,filterLabel:jn,selectedLabel:xn,dataTest:"input-program-picker",multiSelect:e,validator:s,autoSelectFirst:!0},n)))};Mn.defaultProps={label:On,multiSelect:!1,show:!0};const{Field:Nn}=c.v,Un=o.a.t("Include first level units"),Rn=o.a.t("Include the first level of organisation units inside selections"),Fn=()=>l.a.createElement(ye,{label:Un,dataTest:"input-include-children"},l.a.createElement(Nn,{type:"checkbox",component:c.f,name:"includeChildren",label:Rn,dataTest:"".concat("input-include-children","-sf")})),{Field:Pn}=c.v,Ln=o.a.t("Include deleted"),Jn=o.a.t("Include deleted data in export"),zn=()=>l.a.createElement(ye,{label:Ln,dataTest:"input-include-deleted"},l.a.createElement(Pn,{type:"checkbox",component:c.f,name:"includeDeleted",label:Jn,dataTest:"".concat("input-include-deleted","-sf")})),Vn=[{value:"zip",label:o.a.t("Zip")},{value:"gz",label:o.a.t("GZip")},{value:"",label:o.a.t("Uncompressed")}],qn=Vn[0].value,Bn=o.a.t("Compression mode"),Hn=()=>l.a.createElement(wt,{name:"compression",label:Bn,options:Vn,dataTest:"input-compression"}),Gn=[{value:"SELECTED",label:o.a.t("Only include selected organisation unit")},{value:"CHILDREN",label:o.a.t("Include the first level of units inside selections")},{value:"DESCENDANTS",label:o.a.t("Include all units inside selections")}],Kn=Gn[0].value,Xn=o.a.t("How should organisation units inside the selections be included?"),Wn=()=>l.a.createElement(wt,{name:"inclusion",label:Xn,options:Gn,dataTest:"input-inclusion",vertical:!0}),Yn=o.a.t("Start date"),Zn=Object(c.J)(c.K,se),$n=()=>l.a.createElement(me,{name:"startDate",validator:Zn,label:Yn,dataTest:"input-start-date"}),Qn=o.a.t("End date"),el=Object(c.J)(c.K,se),tl=()=>l.a.createElement(me,{name:"endDate",validator:el,label:Qn,dataTest:"input-end-date"}),al=({label:e})=>l.a.createElement("div",{style:{marginBottom:"var(--spacers-dp24)"}},l.a.createElement(c.b,{primary:!0,type:"submit",dataTest:"input-export-submit"},e)),nl=Object(c.J)(c.K,e=>e?void 0:o.a.t("One program stage must be selected")),ll=o.a.t("Which program stage should be included?"),rl=e=>l.a.createElement(vt,Object.assign({name:"programStage",label:ll,validator:nl,dataTest:"input-program-stage-select"},e)),{Field:sl}=c.v,ol=({input:{onChange:e},meta:t,...a})=>l.a.createElement(Do,Object.assign({meta:t,setCheckedSchemas:e},a)),cl=({name:e,validator:t,...a})=>l.a.createElement(sl,Object.assign({component:ol,name:e,validate:t},a)),il=Object(c.J)(c.K,e=>0==e.length?o.a.t("At least one schema must be selected"):void 0),ml=new Set(["analyticsTableHooks","charts","constants","dataElementDimensions","dataEntryForms","dataSetNotificationTemplates","dataStores","documents","eventCharts","eventReports","icons","jobConfigurations","messageConversations","metadataVersions","minMaxDataElements","oAuth2Clients","programDataElements","programNotificationTemplates","pushAnalysis","reportTables","reportingRates","reports","sections","smsCommands","sqlViews","trackedEntityInstanceFilters","validationNotificationTemplates"]),dl=()=>l.a.createElement(cl,{name:"checkedSchemas",excludeSchemas:ml,validator:il,checkedByDefault:!0,dataTest:"input-schemas"}),ul=[{value:"dataSets",label:o.a.t("Data sets")},{value:"programs",label:o.a.t("Programs")},{value:"categoryCombos",label:o.a.t("Category combination")},{value:"dashboards",label:o.a.t("Dashboard")},{value:"dataElementGroups",label:o.a.t("Data element groups")},{value:"optionSets",label:o.a.t("Option sets")}],pl=ul[0].value,El=o.a.t("Object type"),hl=()=>l.a.createElement("div",{style:{maxWidth:"480px"}},l.a.createElement(uc,{component:c.x,name:"objectType",label:El,options:ul,dataTest:"input-object-type",filled:!0,initialFocus:!0})),bl=o.a.t("Object"),vl=Object(c.J)(c.K,e=>e?void 0:o.a.t("One object must be selected")),gl=({objectType:e,form:t})=>{const{loading:a,error:r,validationText:s,objects:i}=((e,t)=>{const a=Object(p.c)(),[l,r]=Object(n.useState)(void 0),[s,c]=Object(n.useState)(!0),[i,m]=Object(n.useState)([]);Object(n.useEffect)(()=>{c(!0),t(void 0),a.query({data:{resource:e,fields:"id,displayName",params:{paging:"false"}}},{onComplete:a=>{const n=a.data[e].map(e=>({value:e.id,label:e.displayName}));m(n),t(n[0].value),c(!1)},onError:e=>{r(e),console.error("useObjects error: ",e)}})},[e]);return{loading:s,error:l,validationText:l&&"".concat(o.a.t("Something went wrong when loading the objects")," : ").concat(l.message),objects:i}})(e,e=>t.change("object",e));return l.a.createElement("div",{style:{maxWidth:"480px"}},l.a.createElement(uc,{component:c.x,loading:a,name:"object",label:bl,options:i,validate:vl,dataTest:"input-object-select",validationText:s,error:!!r,filterable:!0}))},yl=[{value:"UID",label:o.a.t("UID")},{value:"CODE",label:o.a.t("CODE")},{value:"NAME",label:o.a.t("NAME")}],Sl=yl[0].value,fl=o.a.t("Data element ID scheme"),Tl=()=>l.a.createElement(ae,{name:"dataElementIdScheme",label:fl,dataElementIdSchemeOptions:yl,dataTest:"input-data-element-id-scheme"}),wl=[{value:"UID",label:o.a.t("Uid")},{value:"CODE",label:o.a.t("Code")}],Dl=wl[0].value,kl=o.a.t("Event ID scheme"),Ol=()=>l.a.createElement(de,{name:"eventIdScheme",label:kl,eventIdSchemeOptions:wl,dataTest:"input-event-id-scheme"}),jl=[{value:"UID",label:o.a.t("Uid")},{value:"CODE",label:o.a.t("Code")}],xl=jl[0].value,Il=o.a.t("ID scheme"),_l=()=>l.a.createElement(Se,{name:"idScheme",label:Il,idSchemeOptions:jl,dataTest:"input-id-scheme"}),Al=[{value:"UID",label:o.a.t("Uid")},{value:"CODE",label:o.a.t("Code")},{value:"NAME",label:o.a.t("Name")}],Cl=Al[0].value,Ml=o.a.t("Organisation unit ID scheme"),Nl=()=>l.a.createElement(rt,{name:"orgUnitIdScheme",label:Ml,orgUnitIdSchemeOptions:Al,dataTest:"input-org-unit-id-scheme"}),Ul=e=>e.includes("ALL")||e.includes("F_SKIP_DATA_IMPORT_AUDIT"),Rl=[{value:"SELECTED",label:o.a.t("Only include selected organisation unit")},{value:"CHILDREN",label:o.a.t("Include the first level of units inside selections")},{value:"DESCENDANTS",label:o.a.t("Include all units inside selections")},{value:"ACCESSIBLE",label:o.a.t("Data view organisation units associated with the current user")},{value:"CAPTURE",label:o.a.t("Data capture organisation units associated with the current user")},{value:"ALL",label:o.a.t("All organisation units in the system")}],Fl=Rl[0].value,Pl=o.a.t("How should organisation units inside the selections be included?"),Ll=()=>{const e=Object(n.useContext)(m);const t=!!e&&e.authorities.includes("ALL")?Rl:Rl.filter(({value:e})=>"ALL"!=e);return l.a.createElement(wt,{name:"ouMode",label:Pl,options:t,dataTest:"input-ouMode",vertical:!0})},Jl=[{value:"NONE",label:o.a.t("None")},{value:"PROGRAM",label:o.a.t("Program")},{value:"TE",label:o.a.t("Tracked entity type")}],zl=Jl[0].value,Vl=o.a.t("Filter by"),ql=()=>l.a.createElement(wt,{name:"teiTypeFilter",label:Vl,options:Jl,dataTest:"input-tei-type-filter"}),Bl=[{value:"ALL",label:o.a.t("All statuses")},{value:"ACTIVE",label:o.a.t("Active")},{value:"COMPLETED",label:o.a.t("Completed")},{value:"CANCELLED",label:o.a.t("Cancelled")}],Hl=Bl[0].value,Gl=o.a.t("Include only entities with status"),Kl=({show:e})=>e&&l.a.createElement(wt,{name:"programStatus",label:Gl,options:Bl,dataTest:"input-program-status"}),Xl=[{value:"ALL",label:o.a.t("All")},{value:"TRUE",label:o.a.t("Marked for follow-up")},{value:"FALSE",label:o.a.t("Not marked for follow-up")}],Wl=Xl[0].value,Yl=o.a.t("Include only entities with follow-up status"),Zl=({show:e})=>e&&l.a.createElement(wt,{name:"followUpStatus",label:Yl,options:Xl,dataTest:"input-follow-up-status"}),$l=o.a.t("Start date"),Ql=Object(c.J)(re),er=({show:e})=>e&&l.a.createElement(me,{name:"programStartDate",validator:Ql,label:$l,dataTest:"input-program-start-date"}),tr=o.a.t("End date"),ar=Object(c.J)(re),nr=({show:e})=>e&&l.a.createElement(me,{name:"programEndDate",validator:ar,label:tr,dataTest:"input-program-end-date"}),lr=o.a.t("Tracked entity types"),rr=o.a.t("Filter tracked entity types by name"),sr=o.a.t("Selected tracked entity types"),or=o.a.t("Something went wrong when loading the tracked entity types!"),cr=bn,ir=e=>0==e.length?o.a.t("At least one tracked entity type must be selected"):void 0,mr=e=>e?void 0:o.a.t("One tracked entity type must be selected"),dr=({multiSelect:e,show:t,...a})=>{const n=e?ir:mr,r=Object(c.J)(c.K,n);return t&&l.a.createElement(tc,Object.assign({name:"selectedTETypes",resourceType:cr,errorMessage:or,listName:"selectedTETypes",label:lr,filterLabel:rr,selectedLabel:sr,dataTest:"input-te-type-picker",multiSelect:e,validator:r,withActions:!1,autoSelectFirst:!0},a))};dr.defaultProps={multiSelect:!1};const ur=[{value:"NONE",label:o.a.t("Do not filter by last updated date")},{value:"DATE",label:o.a.t("Start/end dates")},{value:"DURATION",label:o.a.t("Time since last updated")}],pr=ur[0].value,Er=o.a.t("Filter by last updated date"),hr=()=>l.a.createElement(wt,{name:"lastUpdatedFilter",label:Er,options:ur,dataTest:"input-last-updated-filter"}),br=o.a.t("Last updated start date"),vr=Object(c.J)(re),gr=({show:e})=>e&&l.a.createElement(me,{name:"lastUpdatedStartDate",validator:vr,label:br,dataTest:"input-last-updated-start-date"}),yr=o.a.t("Last updated end date"),Sr=Object(c.J)(re),fr=({show:e})=>e&&l.a.createElement(me,{name:"lastUpdatedEndDate",validator:Sr,label:yr,dataTest:"input-last-updated-end-date"}),{Field:Tr}=c.v,wr=/^(\d+d)?(\d+h)?(\d+m)?(\d+s)?$/,Dr="".concat(o.a.t("Format"),": 00d00h00m00s"),kr=({input:{value:e,onChange:t},meta:{error:a},inputName:n,label:r,dataTest:s})=>l.a.createElement(ye,{label:r,dataTest:s},l.a.createElement(c.o,{name:n,value:e,onChange:({value:e})=>t(e),inputWidth:"200px",error:!!a,validationText:a,helpText:Dr,placeholder:"100d5h30m"})),Or=({name:e,validator:t,...a})=>l.a.createElement(Tr,Object.assign({component:kr,name:e,inputName:e,validate:t},a)),jr=o.a.t("Last updated duration"),xr=Object(c.J)(c.K,e=>!e||e.match(wr)?void 0:o.a.t("Invalid duration")),Ir=({show:e})=>e&&l.a.createElement(Or,{name:"lastUpdatedDuration",validator:xr,label:jr,dataTest:"input-last-updated-duration"}),_r=[{value:"ANY",label:o.a.t("Any user")},{value:"CURRENT",label:o.a.t("Current user")},{value:"NONE",label:o.a.t("None")},{value:"PROVIDED",label:o.a.t("Selected users")}],Ar=_r[0].value,Cr=o.a.t("Assigned user mode"),Mr=()=>l.a.createElement(wt,{name:"assignedUserMode",label:Cr,options:_r,dataTest:"input-assigned-user-mode"}),Nr=o.a.t("Which users should be used?"),Ur=o.a.t("Filter users"),Rr=o.a.t("Selected users"),Fr=o.a.t("Something went wrong when loading the users!"),Pr=vn,Lr=e=>0==e.length?o.a.t("At least one user must be selected"):void 0,Jr=e=>1!=e.length?o.a.t("One user must be selected"):void 0,zr=({multiSelect:e,show:t,...a})=>{const n=e?Lr:Jr,r=Object(c.J)(c.K,n);return t&&l.a.createElement(tc,Object.assign({name:"selectedUsers",resourceType:Pr,errorMessage:Fr,listName:"userPicker",label:Nr,filterLabel:Ur,selectedLabel:Rr,dataTest:"input-user-picker",multiSelect:e,validator:r,withActions:!0},a))};zr.defaultProps={multiSelect:!0};const{Field:Vr}=c.v,qr=o.a.t("Include all attributes"),Br=o.a.t("Include all attributes"),Hr=()=>l.a.createElement(ye,{label:qr,dataTest:"input-include-all-attributes"},l.a.createElement(Vr,{type:"checkbox",component:c.f,name:"includeAllAttributes",label:Br,dataTest:"".concat("input-include-all-attributes","-sf")})),Gr=({label:e,show:t,children:a})=>t&&l.a.createElement(ye,{label:e,dataTest:"input-dates"},l.a.createElement("div",{style:{display:"flex"}},a[0],l.a.createElement("span",{style:{marginLeft:"var(--spacers-dp8)"}},a[1])));Gr.defaultProps={label:"",show:!0};const Kr="FINAL_FORM/form-error",Xr=e=>{return{classKey:(t=e.format,a=e.classKey,"csv"!=t||a?void 0:o.a.t("A class key must be selected"))};var t,a},{Form:Wr}=c.v,Yr=o.a.t("Metadata import"),Zr=o.a.t("Import metadata like data elements and organisation units using the DXF 2 format."),$r=l.a.createElement(h,null),Qr=()=>{const{tasks:{metadata:e},addTask:t}=Object(n.useContext)(d),a=Object(Dt.h)().query,r=$(a,e),s=(e=>({files:e.files,format:e.format||Ut,identifier:e.identifier||pa,importReportMode:e.importReportMode||ga,preheatMode:e.preheatMode||wa,importStrategy:e.importStrategy||xa,firstRowIsHeader:!!e.firstRowIsHeader,atomicMode:e.atomicMode||Ca,mergeMode:e.mergeMode||Fa,flushMode:e.flushMode||Va,inclusionStrategy:e.inclusionStrategy||Ka,skipSharing:!!e.skipSharing,skipValidation:!!e.skipValidation,isAsync:!e.isAsync}))(r),[c,i]=Object(n.useState)(0),[m,E]=Object(n.useState)(!1),{baseUrl:h}=Object(p.b)(),b=(({baseUrl:e,setProgress:t,addTask:a,setShowFullSummaryTask:n})=>async l=>{const{dryRun:r,files:s,format:o,identifier:c,importReportMode:i,preheatMode:m,importStrategy:d,atomicMode:u,mergeMode:p,flushMode:E,skipSharing:h,skipValidation:b,inclusionStrategy:v,isAsync:g,firstRowIsHeader:y,classKey:S}=l,f="".concat(e,"/api/"),T=["importMode=".concat(r?"VALIDATE":"COMMIT"),"identifier=".concat(c),"importReportMode=".concat(i),"preheatMode=".concat(m),"importStrategy=".concat(d),"atomicMode=".concat(u),"mergeMode=".concat(p),"flushMode=".concat(E),"skipSharing=".concat(h),"skipValidation=".concat(b),"inclusionStrategy=".concat(v),"async=".concat(g),"format=".concat(o),"csv"==o?"firstRowIsHeader=".concat(y,"&classKey=").concat(S):""].filter(e=>""!=e).join("&"),w="".concat(f).concat("metadata.json","?").concat(T);try{await Y({url:w,file:s[0],format:o,type:"METADATA_IMPORT",setProgress:t,addEntry:(e,t)=>a("metadata",e,{...t,jobDetails:l})})}catch(D){const e=Xr(l);return{[Kr]:[D],...e}}finally{n(!0)}})({baseUrl:h,setProgress:i,addTask:t,setShowFullSummaryTask:E});return l.a.createElement(Et,{title:Yr,desc:Zr,icon:$r,loading:c,dataTest:"page-import-metadata",summaryTask:u(e),showFullSummaryTask:m},l.a.createElement(Wr,{onSubmit:b,initialValues:s,subscription:{values:!0,submitError:!0},render:({handleSubmit:e,form:t,values:a,submitError:n})=>l.a.createElement("form",{onSubmit:e},l.a.createElement(rc,null,l.a.createElement(xt,{helpText:o.a.t("Supported file types: JSON, CSV, and XML.",{nsSeparator:">"})}),l.a.createElement(Lt,{availableFormats:At,type:"import"}),l.a.createElement(Bt,{show:"csv"==a.format}),l.a.createElement(Gt,{show:"csv"==a.format,form:t,prevValue:r.classKey}),l.a.createElement(ba,null),l.a.createElement(fa,null),l.a.createElement(Oa,null),l.a.createElement(_a,null),l.a.createElement(Ua,null),l.a.createElement(Ja,null)),l.a.createElement(lt,null,l.a.createElement(Ha,null),l.a.createElement(tn,null),l.a.createElement(rn,null),l.a.createElement(dn,null),l.a.createElement(Ya,null)),l.a.createElement(It,{form:t}),l.a.createElement(_t,{alerts:n}))}))},{Form:es}=c.v,ts=o.a.t("Metadata export"),as=o.a.t("Export metadata, such as data elements and organisation units, in XML, JSON or CSV format."),ns=l.a.createElement(b,null),ls={checkedSchemas:[],format:Ut,compression:qn,skipSharing:!1},rs=()=>{const{baseUrl:e}=Object(p.b)(),t=(e=>t=>{const{checkedSchemas:a,format:n,compression:l,skipSharing:r}=t,s="".concat(e,"/api/"),o=l?"".concat(n,".").concat(l):n,c=a.map(e=>"".concat(e,"=true")).join("&"),i="skipSharing=".concat(r,"&download=true&").concat(c),m="".concat(s).concat("metadata",".").concat(o,"?").concat(i);Z(m)})(e);return l.a.createElement(Et,{title:ts,desc:as,icon:ns,dataTest:"page-export-metadata"},l.a.createElement(es,{onSubmit:t,initialValues:ls,render:({handleSubmit:e,form:t})=>l.a.createElement("form",{onSubmit:e},l.a.createElement(dl,null),l.a.createElement(Lt,{availableFormats:At}),l.a.createElement(Hn,null),l.a.createElement(tn,null),l.a.createElement(al,{label:o.a.t("Export metadata")}))}))},{Form:ss}=c.v,os=o.a.t("Metadata dependency export"),cs=o.a.t("Export metadata dependencies, such as data sets and programs, including related metadata objects, in XML or JSON format."),is=l.a.createElement(v,null),ms={objectType:pl,object:void 0,format:Ut,compression:qn,skipSharing:!1},ds=()=>{const{baseUrl:e}=Object(p.b)(),t=(e=>t=>{const{objectType:a,object:n,format:l,compression:r,skipSharing:s}=t,o="".concat(e,"/api/"),c="".concat(a,"/").concat(n,"/metadata"),i=r?"".concat(l,".").concat(r):l,m="skipSharing=".concat(s,"&download=true"),d="".concat(o).concat(c,".").concat(i,"?").concat(m);Z(d)})(e);return l.a.createElement(Et,{title:os,desc:cs,icon:is,dataTest:"page-export-metadata-dependency"},l.a.createElement(ss,{onSubmit:t,initialValues:ms,render:({handleSubmit:e,form:t,values:a})=>l.a.createElement("form",{onSubmit:e},l.a.createElement(hl,null),l.a.createElement(gl,{objectType:a.objectType,form:t}),l.a.createElement(Lt,{availableFormats:Ct}),l.a.createElement(Hn,null),l.a.createElement(tn,null),l.a.createElement(al,{label:o.a.t("Export metadata dependencies")}))}))};var us=a(199),ps=a.n(us);const Es=()=>{const{jobOverview:e,updateJobOverview:t}=Object(n.useContext)(d);return l.a.createElement(Et,{title:hs,desc:bs,icon:vs,limitWidth:!1,dataTest:"job-overview-page"},l.a.createElement("div",{className:ps.a.container},l.a.createElement(Ce,{activeTypes:e.activeTypes,setActiveTypes:e=>{t({activeTypes:e})},selectedJob:e.selectedJob,setSelectedJob:e=>{t({selectedJob:e})}})))},hs=o.a.t("Job overview"),bs=o.a.t("An overview of all import jobs started this session."),vs=l.a.createElement(f,null),{Form:gs}=c.v,ys=o.a.t("GML import"),Ss=o.a.t("Import geographic data for organisation units using the GML format. GML is an XML grammar for expressing geographical features."),fs=l.a.createElement(S,null),Ts=()=>{const{tasks:{gml:e},addTask:t}=Object(n.useContext)(d),a=Object(Dt.h)().query,r=(e=>({files:e.files}))($(a,e)),[s,o]=Object(n.useState)(0),[c,i]=Object(n.useState)(!1),{baseUrl:m}=Object(p.b)(),E=(({baseUrl:e,setProgress:t,addTask:a,setShowFullSummaryTask:n})=>async l=>{const{dryRun:r,files:s}=l,o="".concat(e,"/api/"),c=["dryRun=".concat(r),"format=json"].join("&"),i="".concat(o).concat("metadata/gml.json","?").concat(c);try{await Y({url:i,file:s[0],format:"gml",type:"GML_IMPORT",setProgress:t,addEntry:(e,t)=>a("gml",e,{...t,jobDetails:l})})}catch(m){return{[Kr]:[m]}}finally{n(!0)}})({baseUrl:m,setProgress:o,addTask:t,setShowFullSummaryTask:i});return l.a.createElement(Et,{title:ys,desc:Ss,icon:fs,loading:s,dataTest:"page-import-gml",summaryTask:u(e),showFullSummaryTask:c},l.a.createElement(gs,{onSubmit:E,initialValues:r,render:({handleSubmit:e,form:t,submitError:a})=>l.a.createElement("form",{onSubmit:e},l.a.createElement(xt,null),l.a.createElement(It,{form:t}),l.a.createElement(_t,{alerts:a}))}))},ws=o.a.t("Event import"),Ds=o.a.t("Import events for programs, stages and tracked entities using the DXF 2 format."),ks=l.a.createElement(y,null),{Form:Os}=c.v,js=()=>{const{tasks:{event:e},addTask:t}=Object(n.useContext)(d),a=Object(Dt.h)().query,r=(e=>({files:e.files,format:e.format||Ut,dataElementIdScheme:e.dataElementIdScheme||Sl,orgUnitIdScheme:e.orgUnitIdScheme||Cl,eventIdScheme:e.eventIdScheme||Dl,idScheme:e.idScheme||xl}))($(a,e)),[s,c]=Object(n.useState)(0),[i,m]=Object(n.useState)(!1),{baseUrl:E}=Object(p.b)(),h=(({baseUrl:e,setProgress:t,addTask:a,setShowFullSummaryTask:n})=>async l=>{const{dryRun:r,files:s,format:o,dataElementIdScheme:c,orgUnitIdScheme:i,eventIdScheme:m,idScheme:d}=l,u="".concat(e,"/api/"),p=["skipFirst=true","async=true","dryRun=".concat(r),"dataElementIdScheme=".concat(c),"orgUnitIdScheme=".concat(i),"eventIdScheme=".concat(m),"idScheme=".concat(d),"payloadFormat=".concat(o)].join("&"),E="".concat(u).concat("events.json","?").concat(p);try{await Y({url:E,file:s[0],format:o,type:"EVENT_IMPORT",setProgress:t,addEntry:(e,t)=>a("event",e,{...t,jobDetails:l})})}catch(h){return{[Kr]:[h]}}finally{n(!0)}})({baseUrl:E,setProgress:c,addTask:t,setShowFullSummaryTask:m});return l.a.createElement(Et,{title:ws,desc:Ds,icon:ks,loading:s,dataTest:"page-import-event",summaryTask:u(e),showFullSummaryTask:i},l.a.createElement(Os,{onSubmit:h,initialValues:r,subscription:{values:!0,submitError:!0},render:({handleSubmit:e,form:t,submitError:a})=>l.a.createElement("form",{onSubmit:e},l.a.createElement(rc,null,l.a.createElement(xt,{helpText:o.a.t("Supported file types: JSON, CSV, and XML.",{nsSeparator:">"})}),l.a.createElement(Lt,{availableFormats:At,type:"import"})),l.a.createElement(lt,null,l.a.createElement(cc,null,l.a.createElement(Ol,null),l.a.createElement(Tl,null),l.a.createElement(Nl,null),l.a.createElement(_l,null))),l.a.createElement(It,{form:t}),l.a.createElement(_t,{alerts:a}))}))},xs=e=>({startDate:oe(e.startDate,e.endDate),endDate:ce(e.endDate,e.startDate)}),{Form:Is}=c.v,_s=o.a.t("Event export"),As=o.a.t("Export event data for programs, stages and tracked entities in DXF 2 format."),Cs=l.a.createElement(y,null),Ms=new Date,Ns={selectedOrgUnits:[],selectedPrograms:"",programStage:void 0,format:Ut,compression:qn,startDate:new Date(Ms.getFullYear(),Ms.getMonth()-3,Ms.getDate()),endDate:Ms,includeDeleted:!1,dataElementIdScheme:Sl,orgUnitIdScheme:Cl,idScheme:xl,inclusion:Kn},Us=()=>{const{baseUrl:e}=Object(p.b)(),t=(e=>t=>{const{selectedOrgUnits:a,selectedPrograms:n,programStage:l,format:r,compression:s,startDate:o,endDate:c,includeDeleted:i,dataElementIdScheme:m,orgUnitIdScheme:d,idScheme:u,inclusion:p}=t,E="".concat(e,"/api/"),h=s?"".concat(r,".").concat(s):r,b="".concat("events",".").concat(h),v=["links=false","skipPaging=true","orgUnit=".concat(z(a[0])),"program=".concat(n),"includeDeleted=".concat(i),"dataElementIdScheme=".concat(m),"orgUnitIdScheme=".concat(d),"idScheme=".concat(u),"attachment=".concat(b),"startDate=".concat(V(o)),"endDate=".concat(V(c)),"ouMode=".concat(p),"format=".concat(r),"ALL"!=l?"programStage=".concat(l):""].filter(e=>""!=e).join("&"),g="".concat(E).concat("events",".").concat(h,"?").concat(v);Z(g)})(e);return l.a.createElement(Et,{title:_s,desc:As,icon:Cs,dataTest:"page-export-data"},l.a.createElement(Is,{onSubmit:t,initialValues:Ns,validate:xs,subscription:{values:!0},render:({handleSubmit:e,form:t,values:a})=>l.a.createElement("form",{onSubmit:e},l.a.createElement(rc,null,l.a.createElement(pn,{multiSelect:!1}),l.a.createElement(Wn,null),l.a.createElement(Mn,{autoSelectFirst:!0}),l.a.createElement(rl,{selectedProgram:a.selectedPrograms,form:t}),l.a.createElement(Gr,{label:o.a.t("Date range to export data for")},l.a.createElement($n,null),l.a.createElement(tl,null)),l.a.createElement(Lt,{availableFormats:At}),l.a.createElement(Hn,null)),l.a.createElement(lt,null,l.a.createElement(zn,null),l.a.createElement(cc,null,l.a.createElement(Tl,null),l.a.createElement(Nl,null),l.a.createElement(_l,null))),l.a.createElement(al,{label:o.a.t("Export events")}))}))},{Form:Rs}=c.v,Fs=o.a.t("Data import"),Ps=o.a.t("Import data values from ADX XML, DXF 2 XML, JSON, CSV or PDF files."),Ls=l.a.createElement(g,null),Js=()=>{const{tasks:{data:e},addTask:t}=Object(n.useContext)(d),a=Object(Dt.h)().query,r=(e=>({files:e.files,format:e.format||Ut,strategy:e.strategy||Xt,firstRowIsHeader:!!e.firstRowIsHeader,preheatCache:!!e.preheatCache,skipAudit:!!e.skipAudit,dataElementIdScheme:e.dataElementIdScheme||Sl,orgUnitIdScheme:e.orgUnitIdScheme||Cl,idScheme:e.idScheme||xl,skipExistingCheck:!!e.skipExistingCheck}))($(a,e)),[s,c]=Object(n.useState)(0),[i,m]=Object(n.useState)(!1),{baseUrl:E}=Object(p.b)(),h=(({baseUrl:e,setProgress:t,addTask:a,setShowFullSummaryTask:n})=>async l=>{const{dryRun:r,files:s,strategy:o,preheatCache:c,skipAudit:i,dataElementIdScheme:m,orgUnitIdScheme:d,idScheme:u,skipExistingCheck:p,format:E,firstRowIsHeader:h}=l,b="".concat(e,"/api/"),v=["async=true","dryRun=".concat(r),"strategy=".concat(o),"preheatCache=".concat(c),"skipAudit=".concat(i),"dataElementIdScheme=".concat(m),"orgUnitIdScheme=".concat(d),"idScheme=".concat(u),"skipExistingCheck=".concat(p),"format=".concat(E),"csv"==E?"firstRowIsHeader=".concat(h):""].filter(e=>""!=e).join("&"),g="".concat(b).concat("dataValueSets.json","?").concat(v);try{await Y({url:g,file:s[0],format:E,type:"DATAVALUE_IMPORT",setProgress:t,addEntry:(e,t)=>a("data",e,{...t,jobDetails:l})})}catch(y){return{[Kr]:[y]}}finally{n(!0)}})({baseUrl:E,setProgress:c,addTask:t,setShowFullSummaryTask:m});return l.a.createElement(Et,{title:Fs,desc:Ps,icon:Ls,loading:s,dataTest:"page-import-data",summaryTask:u(e),showFullSummaryTask:i},l.a.createElement(Rs,{onSubmit:h,initialValues:r,subscription:{values:!0,submitError:!0},render:({handleSubmit:e,form:t,values:a,submitError:n})=>l.a.createElement("form",{onSubmit:e},l.a.createElement(rc,null,l.a.createElement(xt,{helpText:o.a.t("Supported file types: JSON, CSV, XML, ADX and PDF.",{nsSeparator:">"})}),l.a.createElement(Lt,{availableFormats:Mt,type:"import"}),l.a.createElement(Bt,{show:"csv"==a.format}),l.a.createElement(Yt,null),l.a.createElement(ta,null),l.a.createElement(Bo,{pred:Ul},l.a.createElement(sa,null))),l.a.createElement(lt,null,l.a.createElement(cc,null,l.a.createElement(Tl,null),l.a.createElement(Nl,null),l.a.createElement(_l,null)),l.a.createElement(da,null)),l.a.createElement(It,{form:t}),l.a.createElement(_t,{alerts:n}))}))};var zs=a(179),Vs=a.n(zs);const qs={sets:{resource:"dataValueSets",params:({dataElementIdScheme:e,orgUnitIdScheme:t,idScheme:a,includeDeleted:n,children:l,startDate:r,endDate:s,orgUnit:o,dataSet:c,format:i})=>({dataElementIdScheme:e,orgUnitIdScheme:t,idScheme:a,includeDeleted:n,children:l,startDate:r,endDate:s,orgUnit:o,dataSet:c,format:i})}},Bs=e=>({startDate:oe(e.startDate,e.endDate),endDate:ce(e.endDate,e.startDate)}),{Form:Hs}=c.v,Gs=o.a.t("Data export"),Ks=o.a.t("Export metadata, such as data elements and organisation units, in DXF 2 format."),Xs=l.a.createElement(g,null),Ws=new Date,Ys={selectedOrgUnits:[],includeChildren:!0,selectedDataSets:[],format:Ut,compression:qn,startDate:new Date(Ws.getFullYear(),Ws.getMonth()-3,Ws.getDate()),endDate:Ws,includeDeleted:!1,dataElementIdScheme:Sl,orgUnitIdScheme:Cl,idScheme:xl},Zs=()=>{const e=(e=>async t=>{const{selectedOrgUnits:a,includeChildren:n,selectedDataSets:l,format:r,compression:s,startDate:c,endDate:i,includeDeleted:m,dataElementIdScheme:d,orgUnitIdScheme:u,idScheme:p}=t;try{const{sets:t}=await e.query(qs,{variables:{dataElementIdScheme:d,orgUnitIdScheme:u,idScheme:p,includeDeleted:m.toString(),children:n.toString(),startDate:V(c),endDate:V(i),orgUnit:a.map(e=>z(e)),dataSet:l,format:r}}),o="json"===r?JSON.stringify(t):t,E="data.".concat(r);if(""!==s){const e=new Vs.a;e.file(E,o),e.generateAsync({type:"blob"}).then(e=>{const t=URL.createObjectURL(e);G(t,"".concat(E,".").concat(s))})}else{const e=H(o,r);G(e,E)}}catch(E){const e=[{id:"http-".concat((new Date).getTime()),critical:!0,message:"".concat(o.a.t("HTTP error when fetching data"),". ").concat(E.message)}];return console.error("DataExport onExport error: ",E),{[Kr]:e}}})(Object(p.c)());return l.a.createElement(Et,{title:Gs,desc:Ks,icon:Xs,dataTest:"page-export-data"},l.a.createElement(Hs,{onSubmit:e,initialValues:Ys,validate:Bs,subscription:{values:!0,submitError:!0},render:({handleSubmit:e,form:t,submitError:a})=>l.a.createElement("form",{onSubmit:e},l.a.createElement(rc,null,l.a.createElement(pn,null),l.a.createElement(Fn,null),l.a.createElement(kn,null),l.a.createElement(Gr,{label:o.a.t("Date range to export data for")},l.a.createElement($n,null),l.a.createElement(tl,null)),l.a.createElement(Lt,{availableFormats:At}),l.a.createElement(Hn,null)),l.a.createElement(lt,null,l.a.createElement(zn,null),l.a.createElement(cc,null,l.a.createElement(Tl,null),l.a.createElement(Nl,null),l.a.createElement(_l,null))),l.a.createElement(al,{label:o.a.t("Export data")}),l.a.createElement(_t,{alerts:a}))}))},$s=({selectedOrgUnits:e,selectedUsers:t,selectedPrograms:a,selectedTETypes:n,ouMode:l,format:r,includeDeleted:s,includeAllAttributes:o,dataElementIdScheme:c,eventIdScheme:i,orgUnitIdScheme:m,idScheme:d,assignedUserMode:u,teiTypeFilter:p,programStatus:E,followUpStatus:h,programStartDate:b,programEndDate:v,lastUpdatedFilter:g,lastUpdatedStartDate:y,lastUpdatedEndDate:S,lastUpdatedDuration:f})=>{const T={ou:e.map(e=>z(e)).join(";"),ouMode:l,format:r,includeDeleted:s.toString(),includeAllAttributes:o.toString(),dataElementIdScheme:c,eventIdScheme:i,orgUnitIdScheme:m,idScheme:d,assignedUserMode:u};return"PROVIDED"==u&&(T.assignedUser=t.join(";")),"PROGRAM"==p&&(T.program=a,T.programStatus=E,T.followUpStatus=h,b&&(T.programStartDate=V(b)),v&&(T.programEndDate=V(v))),"TE"==p&&(T.trackedEntity=n),"DATE"==g&&(y&&(T.lastUpdatedStartDate=V(y)),S&&(T.lastUpdatedEndDate=V(S))),"DURATION"==g&&(T.lastUpdatedDuration=f),T},Qs={sets:{resource:"trackedEntityInstances",params:e=>e}},eo=e=>{const t={};return"PROGRAM"==e.teiTypeFilter&&e.programStartDate&&e.programEndDate&&(t.programStartDate=oe(e.programStartDate,e.programEndDate),t.programEndDate=ce(e.programEndDate,e.programStartDate)),"DATE"==e.lastUpdatedFilter&&e.lastUpdatedStartDate&&e.lastUpdatedEndDate&&(t.lastUpdatedStartDate=oe(e.lastUpdatedStartDate,e.lastUpdatedEndDate),t.lastUpdatedEndDate=ce(e.lastUpdatedEndDate,e.lastUpdatedStartDate)),"DATE"!=e.lastUpdatedFilter||e.lastUpdatedStartDate||e.lastUpdatedEndDate||(t.lastUpdatedEndDate=o.a.t("At least one of the 'last updated' date fields must be specified")),t},{Form:to}=c.v,ao=o.a.t("Tracked entity instances export"),no=o.a.t("Export tracked entity instances in XML, JSON, JSONP or CSV format."),lo=l.a.createElement(T,null),ro={selectedOrgUnits:[],selectedPrograms:[],selectedTETypes:[],selectedUsers:[],format:Ut,ouMode:Fl,teiTypeFilter:zl,programStatus:Hl,followUpStatus:Wl,programStartDate:"",programEndDate:"",compression:qn,lastUpdatedFilter:pr,lastUpdatedStartDate:"",lastUpdatedEndDate:"",lastUpdatedDuration:"",assignedUserMode:Ar,includeDeleted:!1,includeAllAttributes:!1,dataElementIdScheme:Sl,eventIdScheme:Dl,orgUnitIdScheme:Cl,idScheme:xl},so=()=>{const e=(e=>async t=>{const{format:a,compression:n}=t;try{const{sets:l}=await e.query(Qs,{variables:$s(t)}),r="json"===a?JSON.stringify(l):l,s="trackedEntityInstances.".concat(a);if(""!==n){const e=new Vs.a;e.file(s,r),e.generateAsync({type:"blob"}).then(e=>{const t=URL.createObjectURL(e);G(t,"".concat(s,".").concat(n))})}else{const e=H(r,a);G(e,s)}}catch(l){const e=[{id:"http-".concat((new Date).getTime()),critical:!0,message:"".concat(o.a.t("HTTP error when fetching tracked entity instances"),". ").concat(l.message)}];return console.error("TEIExport onExport error: ",l),{[Kr]:e}}})(Object(p.c)());return l.a.createElement(Et,{title:ao,desc:no,icon:lo,dataTest:"page-export-tei"},l.a.createElement(to,{onSubmit:e,initialValues:ro,validate:eo,subscription:{values:!0,submitError:!0},render:({handleSubmit:e,form:t,values:a,submitError:n})=>{const r="PROGRAM"==a.teiTypeFilter,s="TE"==a.teiTypeFilter,c="DATE"==a.lastUpdatedFilter,i="DURATION"==a.lastUpdatedFilter,m="PROVIDED"==a.assignedUserMode;return l.a.createElement("form",{onSubmit:e},l.a.createElement(rc,null,l.a.createElement(pn,null),l.a.createElement(Ll,null),l.a.createElement(ql,null),l.a.createElement(Mn,{label:o.a.t("Program to export from"),show:r}),l.a.createElement(Kl,{show:r}),l.a.createElement(Zl,{show:r}),l.a.createElement(Gr,{label:o.a.t("Enrollment date range"),show:r},l.a.createElement(er,{show:r}),l.a.createElement(nr,{show:r})),l.a.createElement(dr,{show:s}),l.a.createElement(Lt,{availableFormats:Nt}),l.a.createElement(Hn,null)),l.a.createElement(lt,null,l.a.createElement(hr,null),l.a.createElement(Gr,{show:c},l.a.createElement(gr,{show:c}),l.a.createElement(fr,{show:c})),l.a.createElement(Ir,{show:i}),l.a.createElement(Mr,null),l.a.createElement(zr,{show:m}),l.a.createElement(zn,null),l.a.createElement(Hr,null),l.a.createElement(cc,null,l.a.createElement(Tl,null),l.a.createElement(Ol,null),l.a.createElement(Nl,null),l.a.createElement(_l,null))),l.a.createElement(al,{label:o.a.t("Export tracked entity instances")}),l.a.createElement(_t,{alerts:n}))}}))},oo=()=>({}),{Form:co}=c.v,io=o.a.t("Tracked entity instances import"),mo=o.a.t("Import tracked entity instances from JSON or XML files."),uo=l.a.createElement(T,null),po=()=>{const{tasks:{tei:e},addTask:t}=Object(n.useContext)(d),a=Object(Dt.h)().query,r=(e=>({files:e.files,format:e.format||Ut,identifier:e.identifier||pa,importReportMode:e.importReportMode||ga,preheatMode:e.preheatMode||wa,importStrategy:e.importStrategy||xa,atomicMode:e.atomicMode||Ca,mergeMode:e.mergeMode||Fa,flushMode:e.flushMode||Va,inclusionStrategy:e.inclusionStrategy||Ka,skipSharing:!!e.skipSharing,skipValidation:!!e.skipValidation,isAsync:!e.isAsync,dataElementIdScheme:e.dataElementIdScheme||Sl,orgUnitIdScheme:e.orgUnitIdScheme||Cl,eventIdScheme:e.eventIdScheme||Dl,idScheme:e.idScheme||xl}))($(a,e)),[s,c]=Object(n.useState)(0),[i,m]=Object(n.useState)(!1),{baseUrl:E}=Object(p.b)(),h=(({baseUrl:e,setProgress:t,addTask:a,setShowFullSummaryTask:n})=>async l=>{const{dryRun:r,files:s,format:o,identifier:c,importReportMode:i,preheatMode:m,importStrategy:d,atomicMode:u,mergeMode:p,flushMode:E,skipSharing:h,skipValidation:b,inclusionStrategy:v,isAsync:g,dataElementIdScheme:y,orgUnitIdScheme:S,eventIdScheme:f,idScheme:T}=l,w="".concat(e,"/api/"),D=["importMode=".concat(r?"VALIDATE":"COMMIT"),"identifier=".concat(c),"importReportMode=".concat(i),"preheatMode=".concat(m),"importStrategy=".concat(d),"atomicMode=".concat(u),"mergeMode=".concat(p),"flushMode=".concat(E),"skipSharing=".concat(h),"skipValidation=".concat(b),"inclusionStrategy=".concat(v),"async=".concat(g),"format=".concat(o),"dataElementIdScheme=".concat(y),"orgUnitIdScheme=".concat(S),"eventIdScheme=".concat(f),"idScheme=".concat(T)].filter(e=>""!=e).join("&"),k="".concat(w).concat("trackedEntityInstances.json","?").concat(D);try{await Y({url:k,file:s[0],format:o,type:"TEI_IMPORT",setProgress:t,addEntry:(e,t)=>a("tei",e,{...t,jobDetails:l})})}catch(O){const e=oo(l);return{[Kr]:[O],...e}}finally{n(!0)}})({baseUrl:E,setProgress:c,addTask:t,setShowFullSummaryTask:m});return l.a.createElement(Et,{title:io,desc:mo,icon:uo,loading:s,dataTest:"page-import-tei",summaryTask:u(e),showFullSummaryTask:i},l.a.createElement(co,{onSubmit:h,initialValues:r,subscription:{values:!0,submitError:!0},render:({handleSubmit:e,form:t,submitError:a})=>l.a.createElement("form",{onSubmit:e},l.a.createElement(rc,null,l.a.createElement(xt,{helpText:o.a.t("Supported file types: JSON and XML.",{nsSeparator:">"})}),l.a.createElement(Lt,{availableFormats:Ct,type:"import"}),l.a.createElement(ba,null),l.a.createElement(fa,null),l.a.createElement(Oa,null),l.a.createElement(_a,null),l.a.createElement(Ua,null),l.a.createElement(Ja,null)),l.a.createElement(lt,null,l.a.createElement(Ha,null),l.a.createElement(tn,null),l.a.createElement(rn,null),l.a.createElement(dn,null),l.a.createElement(Ya,null),l.a.createElement(cc,null,l.a.createElement(Tl,null),l.a.createElement(Ol,null),l.a.createElement(Nl,null),l.a.createElement(_l,null))),l.a.createElement(It,{form:t}),l.a.createElement(_t,{alerts:a}))}))},Eo=()=>l.a.createElement(kt,null,l.a.createElement(Dt.d,null,l.a.createElement(Dt.b,{path:"/import/data",component:Js}),l.a.createElement(Dt.b,{path:"/import/event",component:js}),l.a.createElement(Dt.b,{path:"/import/gml",component:Ts}),l.a.createElement(Dt.b,{path:"/import/metadata",component:Qr}),l.a.createElement(Dt.b,{path:"/import/tei",component:po}),l.a.createElement(Dt.b,{path:"/export/data",component:Zs}),l.a.createElement(Dt.b,{path:"/export/event",component:Us}),l.a.createElement(Dt.b,{path:"/export/metadata-dependency",component:ds}),l.a.createElement(Dt.b,{path:"/export/metadata",component:rs}),l.a.createElement(Dt.b,{path:"/export/tei",component:so}),l.a.createElement(Dt.b,{path:"/utils/job-overview",component:Es}),l.a.createElement(Dt.a,{from:"*",to:"/import/data"})));function ho(e,t){return t.reduce((t,{name:a,displayName:n})=>t||((t=>e===t.toLowerCase())(a)?n:t),"")}function bo(e,t){return t.reduce((t,{name:a})=>{if(t)return t;return(t=>t.includes(e)&&0===t.indexOf(e))(a.toLowerCase())?(n=a.substr(0,e.length).replace(/([A-Z]+)/g," $1"))[0].toUpperCase()+n.substr(1):t;var n},"")}const vo=e=>(e=>Object.keys(e).reduce((t,a)=>{const n=e[a];return 1===n.length?{...t,other:[...t.other,n[0]]}:{...t,[a]:n}},{other:[]}))((e=>e.reduce((e,t)=>{const{group:a}=t;return{...e,[a]:e[a]?[...e[a],t]:[t]}},{}))(e)),go=e=>Object.entries(e).reduce((e,[t,a])=>{const n=function(e,t){const a=e.toLowerCase();return"oauth2"===a||"other"===a?e:ho(a,t)||bo(a,t)||e[0].toUpperCase()+e.substr(1)}(t,a);return{...e,[t]:n}},{}),yo=e=>{const t=e.split(".");return t.pop(),e.includes(".dhis")||t.pop(),t[t.length-1].replace(/(.)([A-Z])/g,"$1 $2")};var So=a(180),fo=a.n(So);const To=({label:e,schemas:t,toggleSchema:a,dataTest:n})=>l.a.createElement("div",{className:fo.a.group,"data-test":n},l.a.createElement("span",{className:fo.a.formLabel},e),l.a.createElement("div",{className:fo.a.schema},t.map((e,t)=>l.a.createElement("div",{key:e.name},l.a.createElement(c.e,{label:e.label,name:"schemas.".concat(e.name),value:"schemas.".concat(e.name),checked:e.checked,onChange:()=>a(t)}))))),wo={schemas:{resource:"schemas",params:{fields:["metadata","collectionName","displayName","klass"]}}},Do=({excludeSchemas:e,setCheckedSchemas:t,meta:a,checkedByDefault:r,dataTest:s})=>{const[i,m]=Object(n.useState)(void 0),[d,u]=Object(n.useState)(void 0),[E,h]=Object(n.useState)(void 0),{error:b,loading:v}=Object(p.d)(wo,{onComplete:t=>{const a=t.schemas.schemas,n=((e,t)=>e.map(e=>({checked:t,label:e.displayName,name:e.collectionName,group:yo(e.klass)})))(((e,t)=>t.filter(t=>t.metadata&&!e.has(t.collectionName)))(e,a),r),l=vo(n);m(l),h((e=>{const t=Object.keys(e);return t.sort(),t})(l)),u(go(l)),g(l)},onError:e=>{console.error("Schemas error: ",e)}}),g=e=>{t(Object.keys(e).reduce((t,a)=>[...t,...e[a].filter(e=>e.checked).map(e=>e.name)],[]))},y=e=>()=>{const t=Object.keys(i).reduce((t,a)=>({...t,[a]:i[a].reduce((t,a)=>[...t,{...a,checked:e}],[])}),{});m(t),g(t)},S=!v&&!b;return l.a.createElement("div",{className:fo.a.container,"data-test":s},v&&l.a.createElement(c.h,{dataTest:"".concat(s,"-loading")}),b&&l.a.createElement("div",{"data-test":"".concat(s,"-error")},l.a.createElement("p",null,o.a.t("Something went wrong when loading the schemas!")),l.a.createElement("p",null,b.message)),S&&l.a.createElement(l.a.Fragment,null,l.a.createElement(c.c,null,l.a.createElement(c.b,{onClick:y(!0),dataTest:"".concat(s,"-select-all")},o.a.t("Select All")),l.a.createElement(c.b,{onClick:y(!1),dataTest:"".concat(s,"-select-none")},o.a.t("Select None"))),l.a.createElement("div",{className:fo.a.formControl},E.map(e=>{const t=d[e];return l.a.createElement(To,{key:t,label:t,schemas:i[e],toggleSchema:(a=e,e=>{const t=[...i[a]];t[e]={...t[e],checked:!t[e].checked};const n={...i,[a]:t};m(n),g(n)})});var a})),(a.touched||!a.pristine)&&a.error&&l.a.createElement(c.n,{error:!0},a.error)))};a(206);const{Field:ko}=c.v;var Oo=a(207),jo=a.n(Oo);const xo={name:o.a.t("Data import"),code:"data-import",icon:l.a.createElement(g,null),path:"/import/data"},Io={name:o.a.t("Event import"),code:"event-import",icon:l.a.createElement(y,null),path:"/import/event"},_o={name:o.a.t("GML import"),code:"gml-import",icon:l.a.createElement(S,null),path:"/import/gml"},Ao={name:o.a.t("Metadata import"),code:"metadata-import",path:"/import/metadata",icon:l.a.createElement(h,null)},Co={name:o.a.t("TEI import"),code:"tei-import",path:"/import/tei",icon:l.a.createElement(T,null)},Mo={name:o.a.t("Data export"),code:"data-export",path:"/export/data",icon:l.a.createElement(g,null)},No={name:o.a.t("Event export"),code:"event-export",path:"/export/event",icon:l.a.createElement(y,null)},Uo={name:o.a.t("Metadata dependency export"),code:"metadata-dependency-export",path:"/export/metadata-dependency",icon:l.a.createElement(v,null)},Ro={name:o.a.t("Metadata export"),code:"metadata-export",path:"/export/metadata",icon:l.a.createElement(b,null)},Fo={name:o.a.t("TEI export"),code:"tei-export",path:"/export/tei",icon:l.a.createElement(T,null)},Po=[xo,Io,_o,Ao,Co],Lo=[Mo,No,Uo,Ro,Fo],Jo={name:o.a.t("Job overview"),code:"job-overview",path:"/utils/job-overview",icon:l.a.createElement(f,null)},zo=({name:e,path:t,code:a,active:n,className:r})=>{const s=Object(Dt.g)();return l.a.createElement(c.r,{active:n,onClick:()=>s.push(t),label:e,className:et()(r,{[jo.a.sidebarItem]:!n,[jo.a.sidebarItemActive]:n}),dataTest:"sidebar-link-".concat(a)})},Vo=()=>{const e=Object(Dt.h)().pathname;return l.a.createElement(c.q,{className:jo.a.Menu},l.a.createElement(c.s,{className:jo.a.sectionTitle,label:o.a.t("Import"),noDivider:!0}),Po.map(({icon:t,name:a,code:n,path:r})=>{const s=e==r;return l.a.createElement(zo,{name:a,path:r,code:n,icon:t,active:s,key:r})}),l.a.createElement(c.s,{className:jo.a.sectionTitle,label:o.a.t("Export")}),Lo.map(({icon:t,name:a,code:n,path:r})=>{const s=e==r;return l.a.createElement(zo,{name:a,path:r,code:n,icon:t,active:s,key:r})}),l.a.createElement(c.l,null),l.a.createElement(zo,{name:Jo.name,path:Jo.path,code:Jo.code,icon:Jo.icon,active:e==Jo.path,className:e==Jo.path?"":jo.a.jobOverview,key:Jo.path}))},{Field:qo}=c.v,Bo=({pred:e,children:t})=>{const a=Object(n.useContext)(m);return a&&e(a.authorities)?t:null};var Ho=a(208),Go=a.n(Ho);const Ko={dataSets:{resource:"dataSets",params:{fields:"id,displayName",paging:"false"}}},Xo={programs:{resource:"programs",params:{fields:"id,displayName",paging:"false"}}},Wo={trackedEntityTypes:{resource:"trackedEntityTypes",params:{fields:"id,displayName",paging:"false"}}},Yo={users:{resource:"users",params:{fields:"id,displayName",paging:"false"}}},{Field:Zo}=c.v,$o=({label:e,resourceType:t,selected:a,setSelected:r,meta:s,multiSelect:o,withFilter:i,autoSelectFirst:m,dataTest:d,listName:u,filterLabel:E,selectedLabel:h,errorMessage:b})=>{const[v,g]=Object(n.useState)([]),[y,S]=Object(n.useState)(void 0),{error:f,resourceName:T,query:w}=(e=>e==En?{resourceName:"dataSets",query:Ko}:e==hn?{resourceName:"programs",query:Xo}:e==bn?{resourceName:"trackedEntityTypes",query:Wo}:e==vn?{resourceName:"users",query:Yo}:{error:"Unkown resource type: ".concat(e)})(t);if(f)return console.error("ResourcePicker: ".concat(f)),null;const{loading:D}=Object(p.d)(w,{onComplete:e=>{const t=e[T][T].map(({id:e,displayName:t})=>({value:e,label:t}));g(t),m&&t.length&&r({selected:o?[t[0].value]:t[0].value})},onError:e=>{S(e),console.error("ResourcePicker(".concat(T,") error: "),e)}}),k=!D&&!y;return l.a.createElement(ye,{label:e,dataTest:d},D&&l.a.createElement(c.h,{dataTest:"".concat(d,"-loading")}),y&&l.a.createElement(c.n,{error:!0,"data-test":"".concat(d,"-error")},l.a.createElement("p",null,b),l.a.createElement("p",null,y.message)),k&&(o?l.a.createElement(c.I,{name:u,label:E,selected:a,onChange:r,options:v,filterable:i,filterPlaceholder:E,rightHeader:l.a.createElement("p",{className:Go.a.selectedLabel},h),dataTest:"".concat(d,"-list"),loading:D}):l.a.createElement(Zo,{component:c.x,name:u,options:v,filterable:i,dataTest:"".concat(d,"-select"),loading:D})),(s.touched||!s.pristine)&&s.error&&l.a.createElement(c.n,{error:!0},s.error))};$o.defaultProps={multiSelect:!0,withFilter:!0};const{Field:Qo}=c.v,ec=({input:{value:e,onChange:t},meta:a,...n})=>l.a.createElement($o,Object.assign({meta:a,selected:e,setSelected:({selected:e})=>t(e)},n)),tc=({name:e,validator:t,...a})=>l.a.createElement(Qo,Object.assign({component:ec,name:e,validate:t},a));var ac=a(209),nc=a.n(ac);const lc=o.a.t("Basic options"),rc=({children:e})=>l.a.createElement("section",{className:nc.a.container},l.a.createElement("header",{className:nc.a.header},l.a.createElement("h2",{className:nc.a.label},lc),l.a.createElement(c.l,null)),e);var sc=a(210),oc=a.n(sc);const cc=({children:e})=>l.a.createElement("div",{className:oc.a.container},e);var ic=a(211),mc=a.n(ic);const{Field:dc}=c.v,uc=e=>l.a.createElement("div",{className:mc.a.container},l.a.createElement(dc,e));t.default=()=>{const{tasks:e,addTask:t,jobOverview:a,updateJobOverview:n}=I(),{loading:s,error:u,user:E}=(()=>{const{loading:e,error:t,data:a}=Object(p.d)(_);return t&&console.log("useUser error: ",t),{loading:e,error:t,user:a&&a.user}})(),h=!s&&!u;return l.a.createElement(l.a.Fragment,null,l.a.createElement(c.j,null),l.a.createElement(c.k,{spacers:!0,colors:!0}),s&&l.a.createElement(i.o,{dataTest:"app-screen-cover"},l.a.createElement(c.h,{dataTest:"app-loader"})),u&&l.a.createElement("div",{"data-test":"app-error"},l.a.createElement("p",null,o.a.t("Something went wrong when loading the current user!")),l.a.createElement("p",null,u.message)),h&&l.a.createElement(r.a,null,l.a.createElement(m.Provider,{value:E},l.a.createElement(d.Provider,{value:{tasks:e,addTask:t,jobOverview:a,updateJobOverview:n}},l.a.createElement("div",{className:U.a.container},l.a.createElement("div",{className:U.a.sidebar},l.a.createElement(Vo,null)),l.a.createElement("main",{className:U.a.content},l.a.createElement(Eo,null)))))))}}}]);
//# sourceMappingURL=app.6dc236fe.chunk.js.map