(this["webpackJsonp@dhis2/app-shell"]=this["webpackJsonp@dhis2/app-shell"]||[]).push([[133],{177:function(e,t,a){e.exports={container:"JobOverview_container__1_oyo",items:"JobOverview_items__2B1hs",Menu:"JobOverview_Menu__2bTUp",summary:"JobOverview_summary__13xs1"}},179:function(e,t,a){e.exports={container:"Schemas_container__3H0XX",group:"Schemas_group__QeGXq",schema:"Schemas_schema__36IFP",formLabel:"Schemas_formLabel__1geS0",formControl:"Schemas_formControl__2ycln"}},181:function(e,t,a){e.exports={container:"App_container__2zgzu",sidebar:"App_sidebar__10tAV",content:"App_content__3I8HS"}},182:function(e,t,a){e.exports={container:"FormAlerts_container__JPYH9"}},183:function(e,t,a){e.exports={container:"FormField_container__3nG83",label:"FormField_label__2Au43"}},184:function(e,t,a){e.exports={container:"ImportButtonStrip_container__12EQC",dryRun:"ImportButtonStrip_dryRun__112kw"}},185:function(e,t,a){e.exports={container:"MenuLabel_container__ZTyjb",status:"MenuLabel_status__1UTMj",date:"MenuLabel_date__1r_sY"}},192:function(e,t,a){e.exports={container:"JobSummary_container__2Zh6N",title:"JobSummary_title__sZ7p4",taskDetails:"JobSummary_taskDetails__3aEqI",tags:"JobSummary_tags__3qnhf"}},193:function(e,t,a){e.exports={rest:"Summary_rest__GeByI"}},194:function(e,t,a){e.exports={container:"MoreOptions_container__2zKqV",header:"MoreOptions_header__120Ww",label:"MoreOptions_label__1zKNe",children:"MoreOptions_children__1atPW",chevronHidden:"MoreOptions_chevronHidden__3r-Ts",chevronVisible:"MoreOptions_chevronVisible__2pP_E"}},195:function(e,t,a){e.exports={wrapper:"OrgUnitTreeField_wrapper__lSSwo"}},196:function(e,t,a){e.exports={container:"Page_container__3NEqL",limitedWidth:"Page_limitedWidth__Y4JEb",content:"Page_content__39Ql1",preBody:"Page_preBody__3d4Jp",header:"Page_header__13-dA",title:"Page_title__rl9Ut",desc:"Page_desc__2uKSe"}},197:function(e,t,a){e.exports={container:"ProgramStages_container__2q8As"}},198:function(e,t,a){e.exports={horizontal:"RadioGroup_horizontal__2D7__",vertical:"RadioGroup_vertical__1Rhum"}},199:function(e,t,a){e.exports={container:"JobOverview_container__F-fbL"}},200:function(e,t,a){e.exports={select:"Select_select__3_2MB"}},201:function(e,t,a){e.exports={Menu:"Sidebar_Menu__3Gy0D",sidebarItem:"Sidebar_sidebarItem__3GXPY",sidebarItemActive:"Sidebar_sidebarItemActive__3d6JP",sectionTitle:"Sidebar_sectionTitle__lKKbo",jobOverview:"Sidebar_jobOverview__2MJ0c"}},202:function(e,t,a){e.exports={selectedLabel:"ResourcePicker_selectedLabel__2kKYb"}},203:function(e,t,a){e.exports={container:"BasicOptions_container__3a0Mm",label:"BasicOptions_label__3abuV",header:"BasicOptions_header__2gFRx"}},204:function(e,t,a){e.exports={container:"SchemeContainer_container__EmEkB"}},205:function(e,t,a){e.exports={container:"StyledField_container__2GRLx"}},206:function(e,t,a){"use strict";a.r(t);var n=a(1),l=a.n(n),r=a(172),o=a(6),c=a.n(o),s=a(170),i=a(4);const m=l.a.createContext(void 0),d=l.a.createContext(void 0),u=e=>Object.keys(e).map(t=>e[t]).sort((e,t)=>e.created<t.created?1:-1)[0];var p=a(7);const E=(e,t)=>({width:e||24,height:t||24,display:"inline-block",fill:"current-color",color:"current-color",userSelect:"none"}),h=({width:e,height:t})=>l.a.createElement("svg",{viewBox:"0 0 24 24",style:E(e,t),"data-test":"icon-metadataimport"},l.a.createElement("path",{d:"M14.039 8.968l-3.961-3.968h1.968s.991-3.178-2.985-5c6.191.222 6.972 5 6.972 5h1.967l-3.961 3.968zm6.461 5.575l-.342.195v1.717l.342-.195v-1.717zm-.844.481l-.35.199v1.717l.35-.199v-1.717zm.906-10.024l-1.306 1.55 1.62.919-6.859 3.698-8.86-5.138 4.436-2.685c-.234-.5-.626-.989-1.313-1.338l-5.124 2.978-3.156 5.487 2 1.106v5.445l12.25 6.978 9.75-5.551v-11.508l-3.438-1.941zm-16.624 2.688l7.897 4.54-1.192 2.091-7.872-4.605 1.167-2.026zm9.062 13.298l-9-5.126v-3.112l7.377 4.319 1.623-2.845v6.764zm9-3.7l-7 3.985v-8.361l7-3.773v8.149zm-4.907-.802l-.349.199v1.713l.349-.195v-1.717zm.584-.333l-.343.195v1.717l.343-.195v-1.717zm1.395-.794l-.343.195v1.717l.343-.195v-1.717zm-.574.327l-.344.196v1.717l.344-.196v-1.717z"})),b=({width:e,height:t})=>l.a.createElement("svg",{viewBox:"0 0 24 24",style:E(e,t),"data-test":"icon-metadataexport"},l.a.createElement("path",{d:"M13.904 9c-3.514-3.984-.1-7.598-.1-7.598l-1.393-1.389 5.589-.013v5.607l-1.372-1.391c0 .001-3.581.706-2.724 4.784zm5.752 6.024l-.35.199v1.717l.35-.199v-1.717zm.844-.481l-.342.195v1.717l.342-.195v-1.717zm-3.407 1.941l-.349.199v1.713l.349-.195v-1.717zm1.979-1.127l-.343.195v1.717l.343-.195v-1.717zm.949-10.673v2.295l.855.489-6.859 3.698-8.86-5.138 6.374-3.654-1.5-1.406-6.864 3.97-3.167 5.533 2 1.106v5.445l12.25 6.978 9.75-5.551v-11.508l-3.979-2.257zm-16.083 3.004l7.897 4.54-1.193 2.091-7.871-4.605 1.167-2.026zm9.062 13.298l-9-5.126v-3.112l5.632 3.297 1.746 1.022 1.002-1.757.62-1.088v6.764zm9-3.7l-7 3.985v-8.361l7-3.773v8.149zm-4.323-1.135l-.343.195v1.717l.343-.195v-1.717zm.821-.467l-.344.196v1.717l.344-.196v-1.717z"})),v=({width:e,height:t})=>l.a.createElement("svg",{viewBox:"0 0 24 24",style:E(e,t),"data-test":"icon-metadatadependencyexport"},l.a.createElement("path",{d:"M16.949 16.132h2.332c-1.092 1.728-3.605 3.638-6.281 3.852v-8.984h3v-2h-3v-1.103c0-2.39 2-2.619 2-4.897 0-1.654-1.346-3-3-3s-3 1.346-3 3c0 2.297 2 2.487 2 4.897v1.103h-3v2h3v9c-2.639-.18-5.133-2.053-6.281-3.868h2.332l-5.051-3.132v5.912l1.269-1.8c2.702 4.503 6.379 4.305 8.731 6.888 2.352-2.583 6.029-2.385 8.731-6.889l1.269 1.8v-5.911l-5.051 3.132zm-5.949-13.132c0-.551.449-1 1-1s1 .449 1 1-.448 1-1 1-1-.449-1-1z"})),g=({width:e,height:t})=>l.a.createElement("svg",{viewBox:"0 0 24 24",style:E(e,t),"data-test":"icon-data"},l.a.createElement("path",{d:"M6.083 4c1.38 1.612 2.578 3 4.917 3h11v13h-20v-16h4.083zm.917-2h-7v20h24v-17h-13c-1.629 0-2.305-1.058-4-3z"})),y=({width:e,height:t})=>l.a.createElement("svg",{viewBox:"0 0 24 24",style:E(e,t),"data-test":"icon-event"},l.a.createElement("path",{d:"M20 20h-4v-4h4v4zm-6-10h-4v4h4v-4zm6 0h-4v4h4v-4zm-12 6h-4v4h4v-4zm6 0h-4v4h4v-4zm-6-6h-4v4h4v-4zm16-8v22h-24v-22h3v1c0 1.103.897 2 2 2s2-.897 2-2v-1h10v1c0 1.103.897 2 2 2s2-.897 2-2v-1h3zm-2 6h-20v14h20v-14zm-2-7c0-.552-.447-1-1-1s-1 .448-1 1v2c0 .552.447 1 1 1s1-.448 1-1v-2zm-14 2c0 .552-.447 1-1 1s-1-.448-1-1v-2c0-.552.447-1 1-1s1 .448 1 1v2z"})),S=({width:e,height:t})=>l.a.createElement("svg",{viewBox:"0 0 24 24",style:E(e,t),"data-test":"icon-gml"},l.a.createElement("path",{d:"M13.144 8.171c-.035-.066.342-.102.409-.102.074.009-.196.452-.409.102zm-2.152-3.072l.108-.031c.064.055-.072.095-.051.136.086.155.021.248.008.332-.014.085-.104.048-.149.093-.053.066.258.075.262.085.011.033-.375.089-.304.171.096.136.824-.195.708-.176.225-.113.029-.125-.097-.19-.043-.215-.079-.547-.213-.68l.088-.102c-.206-.299-.36.362-.36.362zm13.008 6.901c0 6.627-5.373 12-12 12-6.628 0-12-5.373-12-12s5.372-12 12-12c6.627 0 12 5.373 12 12zm-8.31-5.371c-.006-.146-.19-.284-.382-.031-.135.174-.111.439-.184.557-.104.175.567.339.567.174.025-.277.732-.063.87-.025.248.069.643-.226.211-.381-.355-.13-.542-.269-.574-.523 0 0 .188-.176.106-.166-.218.027-.614.786-.614.395zm6.296 5.371c0-1.035-.177-2.08-.357-2.632-.058-.174-.189-.312-.359-.378-.256-.1-1.337.597-1.5.254-.107-.229-.324.146-.572.008-.12-.066-.454-.515-.605-.46-.309.111.474.964.688 1.076.201-.152.852-.465.992-.038.268.804-.737 1.685-1.251 2.149-.768.694-.624-.449-1.147-.852-.275-.211-.272-.66-.55-.815-.124-.07-.693-.725-.688-.813l-.017.166c-.094.071-.294-.268-.315-.321 0 .295.48.765.639 1.001.271.405.416.995.748 1.326.178.178.858.914 1.035.898.193-.017.803-.458.911-.433.644.152-1.516 3.205-1.721 3.583-.169.317.138 1.101.113 1.476-.029.433-.37.573-.693.809-.346.253-.265.745-.556.925-.517.318-.889 1.353-1.623 1.348-.216-.001-1.14.36-1.261.007-.094-.256-.22-.45-.353-.703-.13-.248-.015-.505-.173-.724-.109-.152-.475-.497-.508-.677-.002-.155.117-.626.28-.708.229-.117.044-.458.016-.656-.048-.354-.267-.646-.53-.851-.389-.299-.188-.537-.097-.964 0-.204-.124-.472-.398-.392-.564.164-.393-.44-.804-.413-.296.021-.538.209-.813.292-.346.104-.7-.082-1.042-.125-1.407-.178-1.866-1.786-1.499-2.946.037-.19-.114-.542-.048-.689.158-.352.48-.747.762-1.014.158-.15.361-.112.547-.229.287-.181.291-.553.572-.781.4-.325.946-.318 1.468-.388.278-.037 1.336-.266 1.503-.06 0 .038.191.604-.019.572.433.023 1.05.749 1.461.579.211-.088.134-.736.567-.423.262.188 1.436.272 1.68.069.15-.124.234-.93.052-1.021.116.115-.611.124-.679.098-.12-.044-.232.114-.425.025.116.055-.646-.354-.218-.667-.179.131-.346-.037-.539.107-.133.108.062.18-.128.274-.302.153-.53-.525-.644-.602-.116-.076-1.014-.706-.77-.295l.789.785c-.039.025-.207-.286-.207-.059.053-.135.02.579-.104.347-.055-.089.09-.139.006-.268 0-.085-.228-.168-.272-.226-.125-.155-.457-.497-.637-.579-.05-.023-.764.087-.824.11-.07.098-.13.201-.179.311-.148.055-.287.126-.419.214l-.157.353c-.068.061-.765.291-.769.3.029-.075-.487-.171-.453-.321.038-.165.213-.68.168-.868-.048-.197 1.074.284 1.146-.235.029-.225.046-.487-.313-.525.068.008.695-.246.799-.36.146-.168.481-.442.724-.442.284 0 .223-.413.354-.615.131.053-.07.376.087.507-.01-.103.445.057.489.033.104-.054.684-.022.594-.294-.1-.277.051-.195.181-.253-.022.009.34-.619.402-.413-.043-.212-.421.074-.553.063-.305-.024-.176-.52-.061-.665.089-.115-.243-.256-.247-.036-.006.329-.312.627-.241 1.064.108.659-.735-.159-.809-.114-.28.17-.509-.214-.364-.444.148-.235.505-.224.652-.476.104-.178.225-.385.385-.52.535-.449.683-.09 1.216-.041.521.048.176.124.104.324-.069.19.286.258.409.099.07-.092.229-.323.298-.494.089-.222.901-.197.334-.536-.374-.223-2.004-.672-3.096-.672-.236 0-.401.263-.581.412-.356.295-1.268.874-1.775.698-.519-.179-1.63.66-1.808.666-.065.004.004-.634.358-.681-.153.023 1.247-.707 1.209-.859-.046-.18-2.799.822-2.676 1.023.059.092.299.092-.016.294-.18.109-.372.801-.541.801-.505.221-.537-.435-1.099.409l-.894.36c-1.328 1.411-2.247 3.198-2.58 5.183-.013.079.334.226.379.28.112.134.112.712.167.901.138.478.479.744.74 1.179.154.259.41.914.329 1.186.108-.178 1.07.815 1.246 1.022.414.487.733 1.077.061 1.559-.217.156.33 1.129.048 1.368l-.361.093c-.356.219-.195.756.021.982 1.818 1.901 4.38 3.087 7.22 3.087 5.517 0 9.989-4.472 9.989-9.989zm-11.507-6.357c.125-.055.293-.053.311-.22.015-.148.044-.046.08-.1.035-.053-.067-.138-.11-.146-.064-.014-.108.069-.149.104l-.072.019-.068.087.008.048-.087.106c-.085.084.002.139.087.102z"})),f=({width:e,height:t})=>l.a.createElement("svg",{viewBox:"0 0 24 24",style:E(e,t),"data-test":"icon-tasks"},l.a.createElement("path",{d:"M19 2h-4.2C14.4.8 13.3 0 12 0c-1.3 0-2.4.8-2.8 2H5C4 2 3 3 3 4v16c0 1 1 2 2 2h14c1 0 2-1 2-2V4c0-1-1-2-2-2zm-7 0c.6 0 1 .5 1 1s-.5 1-1 1-1-.5-1-1 .5-1 1-1zm7 18H5V4h2v3h10V4h2v16z"})),T=({width:e,height:t})=>l.a.createElement("svg",{viewBox:"0 0 24 24",style:E(e,t)},l.a.createElement("path",{fill:"none",d:"M0 0h24v24H0z"}),l.a.createElement("path",{d:"M13 1l.001 3.062A8.004 8.004 0 0 1 19.938 11H23v2l-3.062.001a8.004 8.004 0 0 1-6.937 6.937L13 23h-2v-3.062a8.004 8.004 0 0 1-6.938-6.937L1 13v-2h3.062A8.004 8.004 0 0 1 11 4.062V1h2zm-1 9a2 2 0 1 0 0 4 2 2 0 0 0 0-4z"})),w=[{key:"data",importType:"DATAVALUE_IMPORT",icon:l.a.createElement(g,null),label:c.a.t("Data")},{key:"event",importType:"EVENT_IMPORT",icon:l.a.createElement(y,null),label:c.a.t("Event")},{key:"gml",importType:"GML_IMPORT",icon:l.a.createElement(S,null),label:c.a.t("GML")},{key:"metadata",importType:"METADATA_IMPORT",icon:l.a.createElement(h,null),label:c.a.t("Metadata")},{key:"tei",importType:"TEI_IMPORT",icon:l.a.createElement(T,null),label:c.a.t("TEI")}],k=w.map(({importType:e})=>e),D={events:{resource:"system/tasks/",id:({type:e,taskId:t})=>"".concat(e,"/").concat(t)}},O={summary:{resource:"system/taskSummaries/",id:({type:e,taskId:t})=>"".concat(e,"/").concat(t)}},j={data:{},event:{},gml:{},metadata:{},tei:{}},x={activeTypes:k,selectedJob:void 0},_=()=>{const e=Object(p.c)(),[t,a]=Object(n.useState)(j),[l,r]=Object(n.useState)(x),o=((e,t)=>async(a,n,l)=>{const r={...l},{summary:o,error:c}=await e.query(O,{variables:{type:l.importType,taskId:l.id}});c?console.error("fetchSummary error: ",c):(o&&"ERROR"==o.status&&!r.error&&(r.error=!0),r.summary=o,t(e=>({...e,[a]:{...e[a],[n]:r}})))})(e,a),c=((e,t,a)=>(n,l,r)=>{const o=async()=>{if(r.completed)return;const c={...r},{events:s,error:i}=await e.query(D,{variables:{type:r.importType,taskId:r.id}});if(i)console.error("fetchEvents error: ",i);else{if(s&&s.length){const e=s.filter(e=>!r.events.some(t=>t.id==e.uid)).map(e=>({id:e.uid,level:e.level,text:e.message,date:new Date(e.time)})),t=e.find(e=>"ERROR"==e.level);t&&(c.error=t.text),c.events=[...c.events,...e.reverse()],c.completed=s[0].completed}c.lastUpdated=new Date,c.completed?a(n,l,c):setTimeout(()=>o(n,l,c),2e3),t(e=>({...e,[n]:{...e[n],[l]:c}}))}};o()})(e,a,o);return{tasks:t,addTask:((e,t)=>(a,n,l)=>{e(e=>({...e,[a]:{...e[a],[n]:l}})),t(a,n,l)})(a,c),jobOverview:l,updateJobOverview:(e=>t=>{e(e=>({...e,...t}))})(r)}},I={user:{resource:"me"}},A={data:{resource:"programs",fields:"id,displayName",id:({id:e})=>"".concat(e),params:{fields:"programStages[id,displayName]",paging:"false"}}},C=c.a.t("All program stages"),M={keys:{resource:"metadata/csvImportClasses"}};var N=a(181),U=a.n(N);const F={json:"application/json",xml:"application/xml",csv:"application/csv",gml:"application/xml",adx:"application/adx+xml",pdf:"application/pdf"},R=e=>F[e]||null,P=({xhr:e,type:t,onResponse:a,onError:n})=>l=>{const r=Math.floor(e.status/100);if(4===e.readyState&&2===r){const n=L(e);a({...n,type:t})}else 4===e.readyState&&n(l)},L=e=>{const t=JSON.parse(e.responseText),{message:a,status:n,typeReports:l,response:r}=t;return n&&"ERROR"===n&&Array.isArray(l)&&Array.isArray(l[0].objectReports)&&Array.isArray(l[0].objectReports[0].errorReports)?{error:!0,msg:{id:"init",text:l[0].objectReports[0].errorReports[0].message,date:new Date},typeReports:t}:"undefined"!==typeof r?{id:r.id,msg:{id:"init",text:a,date:new Date(r.created)}}:{error:!0}},J=e=>t=>{if(t.lengthComputable){const a=parseInt(t.loaded/t.total*100);e(Math.max(1,a))}},z=e=>{const t=e.split("/");return t[t.length-1]},V=e=>"".concat(e.getFullYear().toString(),"-").concat((e.getMonth()+1).toString().padStart(2,0),"-").concat(e.getDate().toString().padStart(2,0)),q=e=>"".concat(V(e)," ").concat(e.getHours().toString().padStart(2,0),":").concat(e.getMinutes().toString().padStart(2,0),":").concat(e.getSeconds().toString().padStart(2,0),"\n"),B=e=>"gz"===e?"gzip":e,H=(e,t)=>"gzip"===t?"application/".concat(e,"+gzip"):"zip"===t?"application/".concat(e,"+zip"):R(e),G=(e,t,a="none")=>URL.createObjectURL(new Blob([e],{type:H(t,a)})),K=(e,t)=>{const a=document.createElement("a");a.href=e,a.setAttribute("download",t),document.body.appendChild(a),a.click(),a.remove()},X=async(e,t)=>{const a="unique:eq:true&filter=".concat(t,":eq:true"),n="".concat(e,"attributes.json?paging=false&fields=").concat("id,displayName","&filter=").concat(a);return(await(e=>fetch(e,{credentials:"include"}).then(e=>{if(e.status>=200&&e.status<300)return Promise.resolve(e.json());throw e}).catch(e=>{const a=new Error(e.statusText||e.status);return console.error("fetchAttributes ".concat(t," fetch error: "),a),Promise.reject(a)}))(n).catch(e=>Promise.reject(e))).attributes.map(({id:e,displayName:t})=>({value:"ATTRIBUTE:".concat(e),label:t}))},W=c.a.t("An unknown error occurred. Please try again later"),Y=e=>t=>{const a=(new Date).getTime();return e(0),{id:"xhr-".concat(a),critical:!0,message:t||W}},Z=({url:e,file:t,format:a,type:n,setProgress:l,addEntry:r})=>{l(1);const o=Y(l);return new Promise((c,s)=>{try{(({url:e,upload:t,type:a,onResponse:n,onError:l,setProgress:r,format:o})=>{const c=new XMLHttpRequest,s=R(o);return c.withCredentials=!0,c.open("POST",e,!0),c.setRequestHeader("Content-Type",s),c.setRequestHeader("Content-Disposition",'attachment filename="'+t.name+'"'),c.onreadystatechange=P({xhr:c,type:a,onResponse:n,onError:l}),c.upload.onprogress=J(r),c})({url:e,upload:t,type:n,onResponse:({error:e,id:t,msg:a,typeReports:i})=>{let m;m=e&&a?{id:(new Date).getTime(),level:"ERROR",created:new Date,lastUpdated:new Date,completed:!0,events:[a],summary:i,error:!0,importType:n}:e?{id:(new Date).getTime(),level:"ERROR",created:new Date,lastUpdated:new Date,completed:!0,summary:void 0,error:!0,importType:n}:{id:t,level:"INFO",created:new Date,lastUpdated:new Date,completed:!1,events:[a],summary:void 0,error:!1,importType:n},r(m.id,m),e&&s(o(a&&a.text)),l(0),c({})},onError:e=>{let t;try{t=JSON.parse(e.target.response).message}catch(a){t=W}console.error("sendFile error",t),s(o(t))},setProgress:l,format:a}).send(t)}catch(i){s(Y(i))}})},$=e=>{window.locationAssign?window.locationAssign(e):window.location=e},Q=(e,t)=>{if(!e||!e.id)return{};const a=t[e.id];return a?a.jobDetails:{}};var ee=a(3),te=a.n(ee);const ae=te.a.exact({value:te.a.string.isRequired,label:te.a.string.isRequired}),ne=(te.a.arrayOf(ae),({name:e,label:t,dataElementIdSchemeOptions:a,dataTest:r})=>{const{baseUrl:o}=Object(p.b)(),[i,m]=Object(n.useState)(!0),[d,u]=Object(n.useState)([]),[E,h]=Object(n.useState)(void 0);Object(n.useEffect)(()=>{X("".concat(o,"/api/"),"dataElementAttribute").then(e=>u(e)).catch(e=>h(e)),m(!1)},[]);const b=E&&"".concat(c.a.t("Something went wrong when loading the additional data element ID schemes")," : ").concat(E.message),v=[...a,...d];return l.a.createElement(us,{component:s.x,name:e,label:t,options:v,dataTest:r,loading:i,validationText:b,error:!!E})}),le=({name:e,error:t,label:a,date:n,onChange:r,dataTest:o})=>{const c=n&&V(n);return l.a.createElement(s.o,{type:"date",name:e,value:c,label:a,onChange:({value:e})=>{r(e?new Date(e):e)},inputWidth:"200px",error:!!t,validationText:t,dataTest:o})},{Field:re}=s.v,oe=e=>e?ce(e):void 0,ce=e=>"Invalid Date"==new Date(e)?c.a.t("Invalid date"):void 0,se=(e,t)=>e>t?c.a.t("Start date must be before end date"):void 0,ie=(e,t)=>e<t?c.a.t("End date must be after start date"):void 0,me=({input:{value:e,onChange:t},meta:{error:a},inputName:n,...r})=>l.a.createElement(le,Object.assign({name:n,error:a,date:e,onChange:t},r)),de=({name:e,validator:t,...a})=>l.a.createElement(re,Object.assign({component:me,name:e,validate:t,inputName:e},a)),ue=({name:e,label:t,eventIdSchemeOptions:a,dataTest:n})=>l.a.createElement(us,{component:s.x,name:e,label:t,options:a,dataTest:n}),{Field:pe}=s.v,Ee=({initialValue:e,required:t,name:a,label:n,helpText:r,accept:o="*",validator:c,dataTest:i})=>l.a.createElement(Se,{label:n,required:t,dataTest:i},l.a.createElement(pe,{component:s.m,name:a,accept:o,required:t,initialValue:e,validate:c,dataTest:"".concat(i,"-fileinput"),helpText:r}));var he=a(182),be=a.n(he);const ve=({alerts:e,dataTest:t})=>{const[a,r]=Object(n.useState)([]);return Object(n.useEffect)(()=>{if(e){const t=e.map(e=>l.a.createElement(s.a,{key:"alert-".concat(e.id),warning:e.warning,info:e.info,critical:e.critical,success:e.success,duration:8e3},e.message));r(t)}},[e]),0==a.length?null:l.a.createElement("div",{className:be.a.container,"data-test":t},a)};var ge=a(183),ye=a.n(ge);const Se=({dataTest:e,label:t,required:a=!1,children:n})=>l.a.createElement("div",{className:ye.a.container,"data-test":e},l.a.createElement("span",{className:ye.a.label},t,a&&l.a.createElement("span",null," *")),n),fe=({name:e,label:t,idSchemeOptions:a,dataTest:r})=>{const{baseUrl:o}=Object(p.b)(),[i,m]=Object(n.useState)(!0),[d,u]=Object(n.useState)([]),[E,h]=Object(n.useState)(void 0);Object(n.useEffect)(()=>{(async()=>{let e;const t=await X("".concat(o,"/api/"),"dataElementAttribute").catch(t=>e=t),a=await X("".concat(o,"/api/"),"organisationUnitAttribute").catch(t=>e=t);if(h(e),!e){const e=t.reduce((e,t)=>((e,t)=>!!t.find(({value:t})=>t===e.value))(t,a)?[...e,t]:e,[]);u(e)}m(!1)})()},[]);const b=E&&"".concat(c.a.t("Something went wrong when loading the additional ID schemes")," : ").concat(E.message),v=[...a,...d];return l.a.createElement(us,{component:s.x,name:e,label:t,options:v,dataTest:r,loading:i,validationText:b,error:!!E})};var Te=a(184),we=a.n(Te);const ke=c.a.t("A dry run tests the import settings without importing any data"),De=({dryRunDataTest:e,importDataTest:t,form:a,dataTest:n})=>l.a.createElement("div",{className:we.a.container,"data-test":n},l.a.createElement(s.c,{dataTest:"".concat(n,"-button-strip")},l.a.createElement(s.b,{primary:!0,type:"submit",onClick:()=>a.change("dryRun",!0),dataTest:e,className:we.a.dryRun},c.a.t("Start dry run")),l.a.createElement(s.b,{secondary:!0,type:"submit",onClick:()=>a.change("dryRun",!1),dataTest:t},c.a.t("Start import"))),l.a.createElement(s.n,{dataTest:"".concat(n,"-help")},ke));var Oe=a(177),je=a.n(Oe);const xe=w.reduce((e,t)=>(e[t.importType]=t,e),{});var _e=a(185),Ie=a.n(_e);const Ae=({task:e})=>{return l.a.createElement("div",{className:Ie.a.container,"data-test":"job-overview-menu-label-".concat(e.id)},l.a.createElement("div",{className:Ie.a.status},l.a.createElement("span",null,(t=15,(a=e.jobDetails.files[0].name).length>t?a.substring(0,t-3)+"...":a)),l.a.createElement("br",null),l.a.createElement("span",null,e.completed?c.a.t("Completed"):c.a.t("In progress")," ")),l.a.createElement("div",{className:Ie.a.date},q(e.created)));var t,a},Ce=({children:e})=>l.a.createElement("div",{className:je.a.chips,"data-test":"job-overview-chips"},e),Me=({activeTypes:e,setActiveTypes:t,selectedJob:a,setSelectedJob:o})=>{const{tasks:i}=Object(n.useContext)(d),m=w.map(({key:e})=>Object.keys(i[e]).map(t=>i[e][t])).flat().sort((e,t)=>e.importType>t.importType||e.createdAt>t.createdAt?-1:void 0),u=m.filter(t=>e.includes(t.importType));return Object(n.useEffect)(()=>{!a&&m.length>0&&o(m[0])},[]),a?l.a.createElement("div",{className:je.a.container,"data-test":"job-overview-container"},l.a.createElement("div",{className:je.a.items,"data-test":"job-overview-tasks"},l.a.createElement(s.q,{className:je.a.Menu},l.a.createElement(Ce,null,w.map(({key:a,importType:n,label:r})=>l.a.createElement(s.g,{onClick:()=>(a=>{e.includes(a)?t([...e].filter(e=>e!=a)):t([...e,a])})(n),selected:e.includes(n),key:a,dataTest:"job-overview-chips-".concat(a)},r))),u.map(e=>l.a.createElement(s.r,{key:"job-overview-tasks-".concat(e.id),active:a.id==e.id,label:l.a.createElement(Ae,{task:e}),onClick:()=>o(e),icon:xe[e.importType].icon})))),l.a.createElement("div",{className:je.a.summary,"data-test":"job-overview-summary"},l.a.createElement($e,{task:a,dataTest:"job-summary-container",showFileDetails:!1,showJobDetails:!0}),l.a.createElement(r.b,{to:(p=a,{pathname:"/import/".concat(xe[p.importType].key),query:{id:p.id}})},l.a.createElement(s.b,{primary:!0},c.a.t("Recreate job"))))):l.a.createElement("p",null,c.a.t("No jobs started yet."));var p};var Ne=a(192),Ue=a.n(Ne);const Fe=({events:e})=>l.a.createElement(Se,{label:"".concat(c.a.t("Events")),dataTest:"job-summary-events",name:"events"},l.a.createElement(s.A,null,l.a.createElement(s.E,null,l.a.createElement(s.G,null,l.a.createElement(s.D,null,c.a.t("Time")),l.a.createElement(s.D,null,c.a.t("Message")),l.a.createElement(s.D,null,c.a.t("ID")))),l.a.createElement(s.B,null,e.map((e,t)=>l.a.createElement(s.F,{key:"job-summary-events-".concat(e.id,"-").concat(t)},l.a.createElement(s.C,null,q(e.date)),l.a.createElement(s.C,null,e.text),l.a.createElement(s.C,null,e.id))))));var Re=a(193),Pe=a.n(Re);const Le={deleted:te.a.number.isRequired,ignored:te.a.number.isRequired,total:te.a.number.isRequired,updated:te.a.number.isRequired,imported:te.a.number,created:te.a.number},Je=(te.a.exact(Le),e=>{const t=e.split(".");return t[t.length-1]}),ze=(te.a.arrayOf(te.a.exact({uid:te.a.string,type:te.a.string,property:te.a.string,message:te.a.string})),({status:e,description:t})=>l.a.createElement(s.A,null,l.a.createElement(s.E,null,l.a.createElement(s.G,null,l.a.createElement(s.D,null,c.a.t("Status")),l.a.createElement(s.D,null,c.a.t("Description")))),l.a.createElement(s.B,null,l.a.createElement(s.F,null,l.a.createElement(s.C,null,e),l.a.createElement(s.C,null,t))))),Ve=({importCount:e,status:t,description:a,conflicts:n,id:r})=>l.a.createElement("div",null,l.a.createElement(Se,{label:"".concat(c.a.t("Summary")," #").concat(r),dataTest:"job-summary-single-summary",name:"summary"},l.a.createElement(l.a.Fragment,null,t&&l.a.createElement(ze,{description:a,status:t}),l.a.createElement(s.A,null,l.a.createElement(s.E,null,l.a.createElement(s.G,null,l.a.createElement(s.D,null,c.a.t("Created")),l.a.createElement(s.D,null,c.a.t("Deleted")),l.a.createElement(s.D,null,c.a.t("Ignored")),l.a.createElement(s.D,null,c.a.t("Updated")),l.a.createElement(s.D,null,c.a.t("Total")))),l.a.createElement(s.B,null,l.a.createElement(s.F,null,l.a.createElement(s.C,null,e.imported),l.a.createElement(s.C,null,e.deleted),l.a.createElement(s.C,null,e.ignored),l.a.createElement(s.C,null,e.updated),l.a.createElement(s.C,null,e.total)))))),n&&l.a.createElement(Se,{label:"".concat(c.a.t("Conflicts")),dataTest:"job-summary-conflicts",name:"conflicts"},l.a.createElement(s.A,null,l.a.createElement(s.E,null,l.a.createElement(s.G,null,l.a.createElement(s.D,null,c.a.t("Object")),l.a.createElement(s.D,null,c.a.t("Value")))),l.a.createElement(s.B,null,n.map((e,t)=>l.a.createElement(s.F,{key:"job-summary-conflicts-".concat(e.object,"-").concat(t)},l.a.createElement(s.C,null,e.object),l.a.createElement(s.C,null,e.value))))))),qe=({stats:e})=>0==e.length?null:l.a.createElement(Se,{label:"".concat(c.a.t("Type count")),dataTest:"job-summary-type-count",name:"typeCount"},l.a.createElement(s.A,null,l.a.createElement(s.E,null,l.a.createElement(s.G,null,l.a.createElement(s.D,null,c.a.t("Type")),l.a.createElement(s.D,null,c.a.t("Created")),l.a.createElement(s.D,null,c.a.t("Deleted")),l.a.createElement(s.D,null,c.a.t("Ignored")),l.a.createElement(s.D,null,c.a.t("Updated")),l.a.createElement(s.D,null,c.a.t("Total")))),l.a.createElement(s.B,null,e.map((e,t)=>l.a.createElement(s.F,{key:"job-summary-type-count-".concat(t)},l.a.createElement(s.C,null,e.type),l.a.createElement(s.C,null,e.created),l.a.createElement(s.C,null,e.deleted),l.a.createElement(s.C,null,e.ignored),l.a.createElement(s.C,null,e.updated),l.a.createElement(s.C,null,e.total)))))),Be=(te.a.string.isRequired,({messages:e})=>0==e.length?null:l.a.createElement(Se,{label:"".concat(c.a.t("Messages")),dataTest:"job-summary-messages",name:"messages"},l.a.createElement(s.A,null,l.a.createElement(s.E,null,l.a.createElement(s.G,null,l.a.createElement(s.D,null,c.a.t("UID")),l.a.createElement(s.D,null,c.a.t("Type")),l.a.createElement(s.D,null,c.a.t("Property")),l.a.createElement(s.D,null,c.a.t("Message")))),l.a.createElement(s.B,null,e.map((e,t)=>l.a.createElement(s.F,{key:"job-summary-messages-".concat(t)},l.a.createElement(s.C,null,e.uid),l.a.createElement(s.C,null,e.type),l.a.createElement(s.C,null,e.property),l.a.createElement(s.C,null,e.message))))))),He=({overviewStats:e,stats:t,messages:a})=>l.a.createElement("div",null,l.a.createElement(Ve,{importCount:e,id:c.a.t("Overview")}),l.a.createElement(qe,{stats:t}),l.a.createElement(Be,{messages:a})),Ge=e=>{if("ImportSummaries"==e.responseType){const{imported:t,deleted:a,ignored:n,updated:l,total:r}=e;return{imported:t,deleted:a,ignored:n,updated:l,total:r}}if(e.importCount){const{imported:t,deleted:a,ignored:n,updated:l}=e.importCount;return{imported:t,deleted:a,ignored:n,updated:l,total:t+a+n+l}}if(e.stats){const{imported:t,deleted:a,ignored:n,updated:l,total:r}=e.stats;return{imported:t,deleted:a,ignored:n,updated:l,total:r}}},Ke=({summary:e})=>{if(e.typeReports){const t={...e.stats,imported:e.stats.created},{stats:a,messages:n}=(e=>{let t=[];const a=[];return Object.keys(e).forEach(n=>{const{klass:l,objectReports:r,stats:o}=e[n];t=[...t,{...o,type:Je(l)}],r&&r.forEach(e=>{const{uid:t,errorReports:n}=e;n&&n.forEach(e=>{a.push({uid:t,type:Je(e.mainKlass),property:e.errorProperty,message:e.message})})})}),{stats:t,messages:a}})(e.typeReports);return l.a.createElement("div",{"data-test":"job-summary-summary"},l.a.createElement(He,{overviewStats:t,stats:a,messages:n}))}const t=Ge(e),a=l.a.createElement(Ve,{importCount:t,status:e.status,description:e.description,conflicts:e.conflicts,id:c.a.t("Overview")}),n="ImportSummaries"==e.responseType&&e.importSummaries?e.importSummaries.map((e,t)=>{const a=Ge(e);return l.a.createElement(Ve,{key:"single-summary-".concat(t),importCount:a,status:e.status,description:e.description,conflicts:e.conflicts,id:"".concat(t+1)})}):null;return l.a.createElement("div",{"data-test":"job-summary-summary"},a,l.a.createElement("div",{className:Pe.a.rest,"data-test":"job-summary-summary-rest"},n))},Xe=e=>e instanceof File?e.name:Array.isArray(e)?e.map(e=>Xe(e)).join(","):e instanceof Object?e.label:"".concat(e),We=({details:e})=>l.a.createElement(Se,{label:"".concat(c.a.t("Job details")),dataTest:"job-summary-job-details",name:"details"},l.a.createElement(s.A,null,l.a.createElement(s.E,null,l.a.createElement(s.G,null,l.a.createElement(s.D,null,c.a.t("Key")),l.a.createElement(s.D,null,c.a.t("Value")))),l.a.createElement(s.B,null,Object.keys(e).map(t=>l.a.createElement(s.F,{key:"job-summary-job-details-".concat(t)},l.a.createElement(s.C,null,t),l.a.createElement(s.C,null,Xe(e[t]))))))),Ye=({jobDetails:e,task:t,showFileDetails:a})=>l.a.createElement("div",{className:Ue.a.header},l.a.createElement("h3",{className:Ue.a.title},"".concat(c.a.t("Job summary"))),a&&l.a.createElement("span",{className:Ue.a.taskDetails},l.a.createElement("span",{"data-test":"job-summary-filename"},e.files[0].name)," ","-"," ",l.a.createElement("span",{"data-test":"job-summary-date"},q(t.created)," "))),Ze=({jobDetails:e,task:t})=>l.a.createElement("div",{className:Ue.a.tags,"data-test":"job-summary-tags"},t.completed?l.a.createElement(s.H,{positive:!0},c.a.t("Completed")):l.a.createElement(s.H,{neutral:!0},c.a.t("In progress")),t.error&&l.a.createElement(s.H,{negative:!0,bold:!0},c.a.t("Error")),t.summary&&t.summary.conflicts&&l.a.createElement(s.H,{negative:!0},c.a.t("Conflicts")),e.dryRun&&l.a.createElement(s.H,{neutral:!0,bold:!0},c.a.t("Dry run"))),$e=({task:e,showFileDetails:t=!0,showJobDetails:a=!1,dataTest:n})=>{if(!e)return null;const{jobDetails:r}=e;return l.a.createElement("div",{className:Ue.a.container,"data-test":n},l.a.createElement(Ye,{jobDetails:r,task:e,showFileDetails:t}),l.a.createElement(Ze,{jobDetails:r,task:e}),l.a.createElement(s.l,null),e.completed&&e.summary&&l.a.createElement(Ke,{summary:e.summary}),l.a.createElement("div",{className:Ue.a.events},l.a.createElement(Fe,{events:e.events})),a&&l.a.createElement("div",{className:Ue.a.jobDetails},l.a.createElement(We,{details:e.jobDetails})))},Qe=({task:e,dataTest:t})=>e?l.a.createElement("div",{"data-test":t},l.a.createElement(rt,{label:c.a.t("View summary of recently started import job"),dataTest:"".concat(t,"-MoreOptions"),noBottomMargin:!0},l.a.createElement($e,{task:e,dataTest:"".concat(t,"-JobSummary")}))):null;var et=a(5),tt=a.n(et),at=a(175),nt=a(194),lt=a.n(nt);const rt=({children:e,initiallyVisible:t,noBottomMargin:a,label:r=c.a.t("Advanced options"),dataTest:o="interaction-more-options"})=>{const[i,m]=Object(n.useState)(!t);return l.a.createElement("section",{className:tt()({[lt.a.container]:!a}),"data-test":o},l.a.createElement("header",{className:lt.a.header,onClick:()=>{m(!i)},"data-test":"".concat(o,"-header")},l.a.createElement(at.j,{className:tt()({[lt.a.chevronHidden]:i,[lt.a.chevronVisible]:!i})}),l.a.createElement("h2",{className:lt.a.label},r)),l.a.createElement(s.l,null),l.a.createElement("div",{className:lt.a.children,"data-test":"".concat(o,"-children")},!i&&e))};rt.defaultProps={initiallyVisible:!1,noBottomMargin:!1};const ot=({name:e,label:t,orgUnitIdSchemeOptions:a,dataTest:r})=>{const{baseUrl:o}=Object(p.b)(),[i,m]=Object(n.useState)(!0),[d,u]=Object(n.useState)([]),[E,h]=Object(n.useState)(void 0);Object(n.useEffect)(()=>{X("".concat(o,"/api/"),"organisationUnitAttribute").then(e=>u(e)).catch(e=>h(e)),m(!1)},[]);const b=E&&"".concat(c.a.t("Something went wrong when loading the additional organisation unit ID schemes")," : ").concat(E.message),v=[...a,...d];return l.a.createElement(us,{component:s.x,name:e,label:t,options:v,dataTest:r,loading:i,validationText:b,error:!!E})};var ct=a(195),st=a.n(ct);const{Field:it}=s.v,mt={roots:{resource:"organisationUnits",params:{filter:"level:eq:1",fields:"id",paging:"false"}}},dt=e=>0==e.length?c.a.t("At least one organisation unit must be selected"):void 0,ut=e=>1!=e.length?c.a.t("One organisation unit must be selected"):void 0,pt=({input:{value:e,onChange:t},meta:a,multiSelect:n,...r})=>{const{loading:o,data:i,error:m}=Object(p.d)(mt);return l.a.createElement(l.a.Fragment,null,o&&l.a.createElement(s.h,null),m&&l.a.createElement(s.n,{error:!0},c.a.t("Something went wrong when loading the organisation units!")),i&&l.a.createElement("div",{className:st.a.wrapper},l.a.createElement(s.t,Object.assign({onChange:({selected:e})=>{t(e)},selected:e,roots:i.roots.organisationUnits.map(e=>e.id)},r,{singleSelection:!n}))),(a.touched||!a.pristine)&&a.error&&l.a.createElement(s.n,{error:!0},a.error))},Et=({name:e,validator:t,...a})=>l.a.createElement(it,Object.assign({component:pt,name:e,validate:t},a));var ht=a(196),bt=a.n(ht);const vt=({title:e,desc:t,summaryTask:a,showFullSummaryTask:n=!1,limitWidth:r=!0,children:o,loading:c=!1,dataTest:i})=>{const m="number"==typeof c?l.a.createElement(s.p,{amount:c}):l.a.createElement(s.h,null);return l.a.createElement("div",{className:tt()(bt.a.container,{[bt.a.limitedWidth]:r}),"data-test":i},l.a.createElement("header",{className:bt.a.header},l.a.createElement("h1",{className:bt.a.title},e),l.a.createElement("p",{className:bt.a.desc},t)),a&&l.a.createElement(s.d,{className:bt.a.preBody},n?l.a.createElement($e,{task:a,dataTest:"job-summary-container"}):l.a.createElement(Qe,{task:a,dataTest:"mini-job-summary-container"})),l.a.createElement("div",{className:bt.a.content},!!c&&l.a.createElement(s.i,null,m),o))};var gt=a(197),yt=a.n(gt);const St=({name:e,label:t,selectedProgram:a,form:r,validator:o,dataTest:i})=>{const{loading:m,error:d,validationText:u,programStages:E}=((e,t)=>{const a=Object(p.c)(),[l,r]=Object(n.useState)(void 0),[o,s]=Object(n.useState)(!0),[i,m]=Object(n.useState)([]);Object(n.useEffect)(()=>{e?(s(!0),t(void 0)):s(!1),e&&a.query(A,{variables:{id:e},onComplete:e=>{const a=e.data.programStages.map(e=>({value:e.id,label:e.displayName}));m([{value:"ALL",label:C},...a]),t("ALL"),s(!1)},onError:e=>{r(e),console.error("useProgramStages error: ",e)}})},[e]);return{loading:o,error:l,validationText:l&&"".concat(c.a.t("Something went wrong when loading the program stages")," : ").concat(l.message),programStages:i}})(a,t=>r.change(e,t));return l.a.createElement("div",{className:yt.a.container},l.a.createElement(us,{component:s.x,name:e,loading:m,label:t,validate:o,dataTest:i,options:E,validationText:u,error:!!d}))};var ft=a(198),Tt=a.n(ft);const wt=({name:e,label:t,options:a,checked:n,setValue:r,vertical:o,helpText:c,dataTest:i})=>l.a.createElement(Se,{label:t,dataTest:i,name:e},l.a.createElement("div",{className:tt()({[Tt.a.vertical]:o,[Tt.a.horizontal]:!o})},a.map(t=>l.a.createElement("div",{key:t.value},l.a.createElement(s.u,{name:e,value:t.value,label:t.label,checked:t.value==n,onChange:()=>r(t.value),dataTest:"".concat(i,"-").concat(t.value)}),t.help&&l.a.createElement(s.n,null,t.help)))),c&&l.a.createElement(s.n,null,c)),{Field:kt}=s.v,Dt=({input:{value:e,onChange:t},meta:{error:a},inputName:n,...r})=>l.a.createElement(wt,Object.assign({name:n,error:a,checked:e,setValue:t},r)),Ot=({name:e,...t})=>l.a.createElement(kt,Object.assign({component:Dt,name:e,inputName:e},t));var jt=a(171);const xt=({children:e})=>{const t=Object(jt.g)();return Object(n.useEffect)(()=>{const e=t.listen(()=>{var e;null===(e=document.getElementsByClassName("app-shell-app")[0])||void 0===e||e.scrollTo(0,0)});return()=>{e()}},[]),l.a.createElement(l.a.Fragment,null,e)};xt.propTypes={children:te.a.node};const _t=c.a.t("Select a file to import values from"),It=e=>e&&0!=e.length?void 0:c.a.t("Please select a file"),At=({helpText:e})=>l.a.createElement(Ee,{name:"files",label:_t,validator:It,dataTest:"input-file-upload",helpText:e}),Ct=({form:e})=>l.a.createElement(De,{form:e,dryRunDataTest:"input-dry-run",importDataTest:"input-import-submit",dataTest:"input-import-button-strip"}),Mt=({alerts:e})=>l.a.createElement(ve,{alerts:e,dataTest:"input-form-alerts"}),Nt=[{value:"json",label:c.a.t("JSON")},{value:"csv",label:c.a.t("CSV")},{value:"xml",label:c.a.t("XML")}],Ut=Nt.filter(e=>"csv"!=e.value),Ft=[...[...Nt,{value:"adx",label:c.a.t("ADX")}],{value:"pdf",label:c.a.t("PDF")}],Rt=[...Nt,{value:"jsonp",label:c.a.t("JSONP")}],Pt=Nt[0].value,Lt=c.a.t("What format is the data to import?"),Jt=c.a.t("What format should the data be exported as?"),zt=e=>"import"===e?Lt:Jt,Vt=({availableFormats:e,type:t})=>l.a.createElement(Ot,{name:"format",label:zt(t),options:e,dataTest:"input-format"}),{Field:qt}=s.v,Bt=c.a.t("Is the first row a header row?"),Ht=c.a.t("First row is header"),Gt=c.a.t("A header row will be ignored during import"),Kt=({show:e})=>e&&l.a.createElement(Se,{label:Bt,dataTest:"input-first-row-is-header"},l.a.createElement(qt,{type:"checkbox",component:s.f,name:"firstRowIsHeader",label:Ht,helpText:Gt,dataTest:"".concat("input-first-row-is-header","-sf")})),Xt=c.a.t("Class key"),Wt=({form:e,prevValue:t,show:a=!0})=>{const{loading:r,error:o,validationText:i,classKeys:m}=((e,t)=>{const[a,l]=Object(n.useState)([]),{loading:r,error:o}=Object(p.d)(M,{onComplete:a=>{l(a.keys.map(e=>({value:e,label:e}))),e(t||a.keys[0])},onError:e=>{console.error("useClassKeys error: ",e)}});return{loading:r,error:o,validationText:o&&"".concat(c.a.t("Something went wrong when loading the class keys")," : ").concat(o.message),classKeys:a}})(t=>e.change("classKey",t),t);return a&&l.a.createElement(us,{component:s.x,name:"classKey",label:Xt,options:m,loading:r,dataTest:"input-class-key",validationText:i,error:!!o,filterable:!0})},Yt=[{value:"NEW_AND_UPDATES",label:c.a.t("Import new values and update existing")},{value:"NEW",label:c.a.t("Import new values only")},{value:"UPDATES",label:c.a.t("Only update existing values, ignore new values")},{value:"DELETE",label:c.a.t("Remove values not included in uploaded file")}],Zt=Yt[0].value,$t=c.a.t("Strategy"),Qt=()=>l.a.createElement(Ot,{name:"strategy",label:$t,options:Yt,dataTest:"input-strategy",vertical:!0}),{Field:ea}=s.v,ta=c.a.t("Preheat cache"),aa=c.a.t("Preheat cache to make large imports faster"),na=c.a.t("Large imports will be processed faster but will consume more resources"),la=()=>l.a.createElement(Se,{label:ta,dataTest:"input-preheat-cache"},l.a.createElement(ea,{type:"checkbox",component:s.f,name:"preheatCache",label:aa,helpText:na,dataTest:"".concat("input-preheat-cache","-sf")})),{Field:ra}=s.v,oa=c.a.t("Skip audit"),ca=c.a.t("Skip audit, meaning audit values will not be generated"),sa=c.a.t("Improves performance at the cost of ability to audit changes"),ia=()=>l.a.createElement(Se,{label:oa,dataTest:"input-has-authority-to-skip-audit"},l.a.createElement(ra,{type:"checkbox",component:s.f,name:"skipAudit",label:ca,helpText:sa,dataTest:"".concat("input-has-authority-to-skip-audit","-sf")})),{Field:ma}=s.v,da=c.a.t("Skip exisiting check"),ua=c.a.t("Skip checks for existing data values"),pa=c.a.t("Improves performance and should only be used for empty databases or when the data values to import do not exist already"),Ea=()=>l.a.createElement(Se,{label:da,dataTest:"input-skip-exisiting-check"},l.a.createElement(ma,{type:"checkbox",component:s.f,name:"skipExistingCheck",label:ua,helpText:pa,dataTest:"".concat("input-skip-exisiting-check","-sf")})),ha=[{value:"UID",label:c.a.t("UID")},{value:"CODE",label:c.a.t("Code")},{value:"AUTO",label:c.a.t("Auto")}],ba=ha[0].value,va=c.a.t("Identifier"),ga=c.a.t("Identifier scheme to use for reference matching"),ya=()=>l.a.createElement(Ot,{name:"identifier",label:va,options:ha,helpText:ga,dataTest:"input-identifier"}),Sa=[{value:"ERRORS",label:c.a.t("Only include reports for objects that have errors")},{value:"FULL",label:c.a.t("Reports for all objects imported")},{value:"DEBUG",label:c.a.t("Reports for all objects imported along with their names (if available)")}],fa=Sa[0].value,Ta=c.a.t("Import report mode"),wa=c.a.t("Controls what should be reported after the import is done"),ka=()=>l.a.createElement(Ot,{name:"importReportMode",label:Ta,options:Sa,helpText:wa,dataTest:"input-import-report-mode",vertical:!0}),Da=[{value:"REFERENCE",label:c.a.t("Intelligent scan")},{value:"ALL",label:c.a.t("All")},{value:"NONE",label:c.a.t("None")}],Oa=Da[0].value,ja=c.a.t("Preheat mode"),xa=c.a.t("Controls the level of preheating that should be done"),_a=()=>l.a.createElement(Ot,{name:"preheatMode",label:ja,options:Da,helpText:xa,dataTest:"input-preheat-mode"}),Ia=[{value:"CREATE_AND_UPDATE",label:c.a.t("Import new values and update existing")},{value:"CREATE",label:c.a.t("Import new values only")},{value:"UPDATES",label:c.a.t("Only update existing values, ignore new values")},{value:"DELETE",label:c.a.t("Remove values not included in uploaded file")}],Aa=Ia[0].value,Ca=c.a.t("Import strategy"),Ma=()=>l.a.createElement(Ot,{name:"importStrategy",label:Ca,options:Ia,dataTest:"input-import-strategy",vertical:!0}),Na=[{value:"ALL",label:c.a.t("Do not import")},{value:"NONE",label:c.a.t("Import")}],Ua=Na[0].value,Fa=c.a.t("Atomic mode"),Ra=c.a.t("Whether to import objects even if some references do not exist"),Pa=()=>l.a.createElement(Ot,{name:"atomicMode",label:Fa,options:Na,helpText:Ra,dataTest:"input-atomic-mode"}),La=[{value:"MERGE",label:c.a.t("Only overwrite the old property if the new property value is not-null")},{value:"REPLACE",label:c.a.t("Overwrite regardless of whether the new property value is null")}],Ja=La[0].value,za=c.a.t("Merge mode"),Va=c.a.t("Strategy to take when merging two objects"),qa=()=>l.a.createElement(Ot,{name:"mergeMode",label:za,options:La,helpText:Va,dataTest:"input-merge-mode",vertical:!0}),Ba=[{value:"AUTO",label:c.a.t("Auto (recommended)")},{value:"OBJECT",label:c.a.t("Object (debugging purposes)")}],Ha=Ba[0].value,Ga=c.a.t("Flush mode"),Ka=c.a.t("Controls when to flush the internal cache"),Xa=()=>l.a.createElement(Ot,{name:"flushMode",label:Ga,options:Ba,helpText:Ka,dataTest:"input-flush-mode"}),Wa=[{value:"NON_NULL",label:c.a.t("Includes properties which are not null")},{value:"ALWAYS",label:c.a.t("Include all properties")},{value:"NON_EMPTY",label:c.a.t("Include non-empty properties")}],Ya=Wa[0].value,Za=c.a.t("Inclusion strategy"),$a=c.a.t("Controls which properties to include"),Qa=()=>l.a.createElement(Ot,{name:"inclusionStrategy",label:Za,options:Wa,helpText:$a,dataTest:"input-inclusion-strategy",vertical:!0}),{Field:en}=s.v,tn=c.a.t("Skip sharing"),an=c.a.t("Skip sharing and access settings"),nn=c.a.t("Skip sharing properties, do not merge sharing when doing updates, and do not add user group access when creating new objects"),ln=()=>l.a.createElement(Se,{label:tn,dataTest:"input-skip-sharing"},l.a.createElement(en,{type:"checkbox",component:s.f,name:"skipSharing",label:an,helpText:nn,dataTest:"".concat("input-skip-sharing","-sf")})),{Field:rn}=s.v,on=c.a.t("Skip validation"),cn=c.a.t("Skip validation for import (not recommended)"),sn=()=>l.a.createElement(Se,{label:on,dataTest:"input-skip-validation"},l.a.createElement(rn,{type:"checkbox",component:s.f,name:"skipValidation",label:cn,dataTest:"".concat("input-skip-validation","-sf")})),{Field:mn}=s.v,dn=c.a.t("Async"),un=c.a.t("Asynchronous import"),pn=c.a.t("Controls whether the import is done asynchronously"),En=()=>l.a.createElement(Se,{label:dn,dataTest:"input-is-async"},l.a.createElement(mn,{type:"checkbox",component:s.f,name:"isAsync",label:un,helpText:pn,dataTest:"".concat("input-is-async","-sf")})),hn=c.a.t("Organisation unit(s) to export data from"),bn=({multiSelect:e})=>{const t=e?dt:ut,a=Object(s.J)(s.K,t);return l.a.createElement(Se,{label:hn,dataTest:"input-org-unit-tree"},l.a.createElement(Et,{name:"selectedOrgUnits",validator:a,multiSelect:e,label:hn,dataTest:"input-org-unit-tree"}))};bn.defaultProps={multiSelect:!0};const vn=1,gn=2,yn=3,Sn=4,fn=c.a.t("Which data sets should be included in export?"),Tn=c.a.t("Filter data sets"),wn=c.a.t("Selected data sets"),kn=c.a.t("Something went wrong when loading the data sets!"),Dn=vn,On=e=>0==e.length?c.a.t("At least one data set must be selected"):void 0,jn=e=>1!=e.length?c.a.t("One data set must be selected"):void 0,xn=({multiSelect:e=!0})=>{const t=e?On:jn,a=Object(s.J)(s.K,t);return l.a.createElement(ts,{name:"selectedDataSets",resourceType:Dn,errorMessage:kn,listName:"dataSetPicker",label:fn,filterLabel:Tn,selectedLabel:wn,dataTest:"input-data-set-picker",validator:a,multiSelect:e})},_n=c.a.t("Program to export events from"),In=c.a.t("Filter programs"),An=c.a.t("Selected programs"),Cn=c.a.t("Something went wrong when loading the programs!"),Mn=gn,Nn=e=>0==e.length?c.a.t("At least one program must be selected"):void 0,Un=e=>e?void 0:c.a.t("One program must be selected"),Fn=({multiSelect:e,label:t,show:a,...n})=>{const r=e?Nn:Un,o=Object(s.J)(s.K,r);return a&&l.a.createElement("div",{style:{maxWidth:"480px"}},l.a.createElement(ts,Object.assign({name:"selectedPrograms",resourceType:Mn,errorMessage:Cn,listName:"selectedPrograms",label:t,filterLabel:In,selectedLabel:An,dataTest:"input-program-picker",multiSelect:e,validator:o,autoSelectFirst:!0},n)))};Fn.defaultProps={label:_n,multiSelect:!1,show:!0};const{Field:Rn}=s.v,Pn=c.a.t("Include first level units"),Ln=c.a.t("Include the first level of organisation units inside selections"),Jn=()=>l.a.createElement(Se,{label:Pn,dataTest:"input-include-children"},l.a.createElement(Rn,{type:"checkbox",component:s.f,name:"includeChildren",label:Ln,dataTest:"".concat("input-include-children","-sf")})),{Field:zn}=s.v,Vn=c.a.t("Include deleted"),qn=c.a.t("Include deleted data in export"),Bn=()=>l.a.createElement(Se,{label:Vn,dataTest:"input-include-deleted"},l.a.createElement(zn,{type:"checkbox",component:s.f,name:"includeDeleted",label:qn,dataTest:"".concat("input-include-deleted","-sf")})),Hn=[{value:"zip",label:c.a.t("Zip")},{value:"gz",label:c.a.t("GZip")},{value:"",label:c.a.t("Uncompressed")}],Gn=Hn[0].value,Kn=c.a.t("Compression mode"),Xn=()=>l.a.createElement(Ot,{name:"compression",label:Kn,options:Hn,dataTest:"input-compression"}),Wn=[{value:"SELECTED",label:c.a.t("Only include selected organisation unit")},{value:"CHILDREN",label:c.a.t("Include the first level of units inside selections")},{value:"DESCENDANTS",label:c.a.t("Include all units inside selections")}],Yn=Wn[0].value,Zn=c.a.t("How should organisation units inside the selections be included?"),$n=()=>l.a.createElement(Ot,{name:"inclusion",label:Zn,options:Wn,dataTest:"input-inclusion",vertical:!0}),Qn=c.a.t("Start date"),el=Object(s.J)(s.K,ce),tl=()=>l.a.createElement(de,{name:"startDate",validator:el,label:Qn,dataTest:"input-start-date"}),al=c.a.t("End date"),nl=Object(s.J)(s.K,ce),ll=()=>l.a.createElement(de,{name:"endDate",validator:nl,label:al,dataTest:"input-end-date"}),rl=({label:e})=>l.a.createElement("div",{style:{marginBottom:"var(--spacers-dp24)"}},l.a.createElement(s.b,{primary:!0,type:"submit",dataTest:"input-export-submit"},e)),ol=Object(s.J)(s.K,e=>e?void 0:c.a.t("One program stage must be selected")),cl=c.a.t("Which program stage should be included?"),sl=e=>l.a.createElement(St,Object.assign({name:"programStage",label:cl,validator:ol,dataTest:"input-program-stage-select"},e)),{Field:il}=s.v,ml=({input:{onChange:e},meta:t,...a})=>l.a.createElement(kc,Object.assign({meta:t,setCheckedSchemas:e},a)),dl=({name:e,validator:t,...a})=>l.a.createElement(il,Object.assign({component:ml,name:e,validate:t},a)),ul=Object(s.J)(s.K,e=>0==e.length?c.a.t("At least one schema must be selected"):void 0),pl=new Set(["analyticsTableHooks","charts","constants","dataElementDimensions","dataEntryForms","dataSetNotificationTemplates","dataStores","documents","eventCharts","eventReports","icons","jobConfigurations","messageConversations","metadataVersions","minMaxDataElements","oAuth2Clients","programDataElements","programNotificationTemplates","pushAnalysis","reportTables","reportingRates","reports","sections","smsCommands","sqlViews","trackedEntityInstanceFilters","validationNotificationTemplates"]),El=()=>l.a.createElement(dl,{name:"checkedSchemas",excludeSchemas:pl,validator:ul,checkedByDefault:!0,dataTest:"input-schemas"}),hl=[{value:"dataSets",label:c.a.t("Data sets")},{value:"programs",label:c.a.t("Programs")},{value:"categoryCombos",label:c.a.t("Category combination")},{value:"dashboards",label:c.a.t("Dashboard")},{value:"dataElementGroups",label:c.a.t("Data element groups")},{value:"optionSets",label:c.a.t("Option sets")}],bl=hl[0].value,vl=c.a.t("Object type"),gl=()=>l.a.createElement("div",{style:{maxWidth:"480px"}},l.a.createElement(us,{component:s.x,name:"objectType",label:vl,options:hl,dataTest:"input-object-type",filled:!0,initialFocus:!0})),yl=c.a.t("Object"),Sl=Object(s.J)(s.K,e=>e?void 0:c.a.t("One object must be selected")),fl=({objectType:e,form:t})=>{const{loading:a,error:r,validationText:o,objects:i}=((e,t)=>{const a=Object(p.c)(),[l,r]=Object(n.useState)(void 0),[o,s]=Object(n.useState)(!0),[i,m]=Object(n.useState)([]);Object(n.useEffect)(()=>{s(!0),t(void 0),a.query({data:{resource:e,fields:"id,displayName",params:{paging:"false"}}},{onComplete:a=>{const n=a.data[e].map(e=>({value:e.id,label:e.displayName}));m(n),t(n[0].value),s(!1)},onError:e=>{r(e),console.error("useObjects error: ",e)}})},[e]);return{loading:o,error:l,validationText:l&&"".concat(c.a.t("Something went wrong when loading the objects")," : ").concat(l.message),objects:i}})(e,e=>t.change("object",e));return l.a.createElement("div",{style:{maxWidth:"480px"}},l.a.createElement(us,{component:s.x,loading:a,name:"object",label:yl,options:i,validate:Sl,dataTest:"input-object-select",validationText:o,error:!!r,filterable:!0}))},Tl=[{value:"UID",label:c.a.t("UID")},{value:"CODE",label:c.a.t("CODE")},{value:"NAME",label:c.a.t("NAME")}],wl=Tl[0].value,kl=c.a.t("Data element ID scheme"),Dl=()=>l.a.createElement(ne,{name:"dataElementIdScheme",label:kl,dataElementIdSchemeOptions:Tl,dataTest:"input-data-element-id-scheme"}),Ol=[{value:"UID",label:c.a.t("Uid")},{value:"CODE",label:c.a.t("Code")}],jl=Ol[0].value,xl=c.a.t("Event ID scheme"),_l=()=>l.a.createElement(ue,{name:"eventIdScheme",label:xl,eventIdSchemeOptions:Ol,dataTest:"input-event-id-scheme"}),Il=[{value:"UID",label:c.a.t("Uid")},{value:"CODE",label:c.a.t("Code")}],Al=Il[0].value,Cl=c.a.t("ID scheme"),Ml=()=>l.a.createElement(fe,{name:"idScheme",label:Cl,idSchemeOptions:Il,dataTest:"input-id-scheme"}),Nl=[{value:"UID",label:c.a.t("Uid")},{value:"CODE",label:c.a.t("Code")},{value:"NAME",label:c.a.t("Name")}],Ul=Nl[0].value,Fl=c.a.t("Organisation unit ID scheme"),Rl=()=>l.a.createElement(ot,{name:"orgUnitIdScheme",label:Fl,orgUnitIdSchemeOptions:Nl,dataTest:"input-org-unit-id-scheme"}),Pl=e=>e.includes("ALL")||e.includes("F_SKIP_DATA_IMPORT_AUDIT"),Ll=[{value:"SELECTED",label:c.a.t("Only include selected organisation unit")},{value:"CHILDREN",label:c.a.t("Include the first level of units inside selections")},{value:"DESCENDANTS",label:c.a.t("Include all units inside selections")},{value:"ACCESSIBLE",label:c.a.t("Data view organisation units associated with the current user")},{value:"CAPTURE",label:c.a.t("Data capture organisation units associated with the current user")},{value:"ALL",label:c.a.t("All organisation units in the system")}],Jl=Ll[0].value,zl=c.a.t("How should organisation units inside the selections be included?"),Vl=()=>{const e=Object(n.useContext)(m);const t=!!e&&e.authorities.includes("ALL")?Ll:Ll.filter(({value:e})=>"ALL"!=e);return l.a.createElement(Ot,{name:"ouMode",label:zl,options:t,dataTest:"input-ouMode",vertical:!0})},ql=[{value:"NONE",label:c.a.t("None")},{value:"PROGRAM",label:c.a.t("Program")},{value:"TE",label:c.a.t("Tracked entity type")}],Bl=ql[0].value,Hl=c.a.t("Filter by"),Gl=()=>l.a.createElement(Ot,{name:"teiTypeFilter",label:Hl,options:ql,dataTest:"input-tei-type-filter"}),Kl=[{value:"",label:c.a.t("All statuses")},{value:"ACTIVE",label:c.a.t("Active")},{value:"COMPLETED",label:c.a.t("Completed")},{value:"CANCELLED",label:c.a.t("Cancelled")}],Xl=Kl[0].value,Wl=c.a.t("Include only entities with status"),Yl=({show:e})=>e&&l.a.createElement(Ot,{name:"programStatus",label:Wl,options:Kl,dataTest:"input-program-status"}),Zl=[{value:"ALL",label:c.a.t("All")},{value:"TRUE",label:c.a.t("Marked for follow-up")},{value:"FALSE",label:c.a.t("Not marked for follow-up")}],$l=Zl[0].value,Ql=c.a.t("Include only entities with follow-up status"),er=({show:e})=>e&&l.a.createElement(Ot,{name:"followUpStatus",label:Ql,options:Zl,dataTest:"input-follow-up-status"}),tr=c.a.t("Start date"),ar=Object(s.J)(oe),nr=({show:e})=>e&&l.a.createElement(de,{name:"programStartDate",validator:ar,label:tr,dataTest:"input-program-start-date"}),lr=c.a.t("End date"),rr=Object(s.J)(oe),or=({show:e})=>e&&l.a.createElement(de,{name:"programEndDate",validator:rr,label:lr,dataTest:"input-program-end-date"}),cr=c.a.t("Tracked entity types"),sr=c.a.t("Filter tracked entity types by name"),ir=c.a.t("Selected tracked entity types"),mr=c.a.t("Something went wrong when loading the tracked entity types!"),dr=yn,ur=e=>0==e.length?c.a.t("At least one tracked entity type must be selected"):void 0,pr=e=>e?void 0:c.a.t("One tracked entity type must be selected"),Er=({multiSelect:e,show:t,...a})=>{const n=e?ur:pr,r=Object(s.J)(s.K,n);return t&&l.a.createElement(ts,Object.assign({name:"selectedTETypes",resourceType:dr,errorMessage:mr,listName:"selectedTETypes",label:cr,filterLabel:sr,selectedLabel:ir,dataTest:"input-te-type-picker",multiSelect:e,validator:r,withActions:!1,autoSelectFirst:!0},a))};Er.defaultProps={multiSelect:!1};const hr=[{value:"NONE",label:c.a.t("Do not filter by last updated date")},{value:"DATE",label:c.a.t("Start/end dates")},{value:"DURATION",label:c.a.t("Time since last updated")}],br=hr[0].value,vr=c.a.t("Filter by last updated date"),gr=()=>l.a.createElement(Ot,{name:"lastUpdatedFilter",label:vr,options:hr,dataTest:"input-last-updated-filter"}),yr=c.a.t("Last updated start date"),Sr=Object(s.J)(oe),fr=({show:e})=>e&&l.a.createElement(de,{name:"lastUpdatedStartDate",validator:Sr,label:yr,dataTest:"input-last-updated-start-date"}),Tr=c.a.t("Last updated end date"),wr=Object(s.J)(oe),kr=({show:e})=>e&&l.a.createElement(de,{name:"lastUpdatedEndDate",validator:wr,label:Tr,dataTest:"input-last-updated-end-date"}),{Field:Dr}=s.v,Or=/^(\d+d)?(\d+h)?(\d+m)?(\d+s)?$/,jr="".concat(c.a.t("Format"),": 00d00h00m00s"),xr=({input:{value:e,onChange:t},meta:{error:a},inputName:n,label:r,dataTest:o})=>l.a.createElement(Se,{label:r,dataTest:o},l.a.createElement(s.o,{name:n,value:e,onChange:({value:e})=>t(e),inputWidth:"200px",error:!!a,validationText:a,helpText:jr,placeholder:"100d5h30m"})),_r=({name:e,validator:t,...a})=>l.a.createElement(Dr,Object.assign({component:xr,name:e,inputName:e,validate:t},a)),Ir=c.a.t("Last updated duration"),Ar=Object(s.J)(s.K,e=>!e||e.match(Or)?void 0:c.a.t("Invalid duration")),Cr=({show:e})=>e&&l.a.createElement(_r,{name:"lastUpdatedDuration",validator:Ar,label:Ir,dataTest:"input-last-updated-duration"}),Mr=[{value:"ANY",label:c.a.t("Any user")},{value:"CURRENT",label:c.a.t("Current user")},{value:"NONE",label:c.a.t("None")},{value:"PROVIDED",label:c.a.t("Selected users")}],Nr=Mr[0].value,Ur=c.a.t("Assigned user mode"),Fr=()=>l.a.createElement(Ot,{name:"assignedUserMode",label:Ur,options:Mr,dataTest:"input-assigned-user-mode"}),Rr=c.a.t("Which users should be used?"),Pr=c.a.t("Filter users"),Lr=c.a.t("Selected users"),Jr=c.a.t("Something went wrong when loading the users!"),zr=Sn,Vr=e=>0==e.length?c.a.t("At least one user must be selected"):void 0,qr=e=>1!=e.length?c.a.t("One user must be selected"):void 0,Br=({multiSelect:e,show:t,...a})=>{const n=e?Vr:qr,r=Object(s.J)(s.K,n);return t&&l.a.createElement(ts,Object.assign({name:"selectedUsers",resourceType:zr,errorMessage:Jr,listName:"userPicker",label:Rr,filterLabel:Pr,selectedLabel:Lr,dataTest:"input-user-picker",multiSelect:e,validator:r,withActions:!0},a))};Br.defaultProps={multiSelect:!0};const{Field:Hr}=s.v,Gr=c.a.t("Include all attributes"),Kr=c.a.t("Include all attributes"),Xr=()=>l.a.createElement(Se,{label:Gr,dataTest:"input-include-all-attributes"},l.a.createElement(Hr,{type:"checkbox",component:s.f,name:"includeAllAttributes",label:Kr,dataTest:"".concat("input-include-all-attributes","-sf")})),Wr=({label:e,show:t,children:a})=>t&&l.a.createElement(Se,{label:e,dataTest:"input-dates"},l.a.createElement("div",{style:{display:"flex"}},a[0],l.a.createElement("span",{style:{marginLeft:"var(--spacers-dp8)"}},a[1])));Wr.defaultProps={label:"",show:!0};const Yr="FINAL_FORM/form-error",Zr=e=>{return{classKey:(t=e.format,a=e.classKey,"csv"!=t||a?void 0:c.a.t("A class key must be selected"))};var t,a},{Form:$r}=s.v,Qr=c.a.t("Metadata import"),eo=c.a.t("Import metadata like data elements and organisation units using the DXF 2 format."),to=l.a.createElement(h,null),ao=()=>{const{tasks:{metadata:e},addTask:t}=Object(n.useContext)(d),a=Object(jt.h)().query,r=Q(a,e),o=(e=>({files:e.files,format:e.format||Pt,identifier:e.identifier||ba,importReportMode:e.importReportMode||fa,preheatMode:e.preheatMode||Oa,importStrategy:e.importStrategy||Aa,firstRowIsHeader:!!e.firstRowIsHeader,atomicMode:e.atomicMode||Ua,mergeMode:e.mergeMode||Ja,flushMode:e.flushMode||Ha,inclusionStrategy:e.inclusionStrategy||Ya,skipSharing:!!e.skipSharing,skipValidation:!!e.skipValidation,isAsync:!e.isAsync}))(r),[s,i]=Object(n.useState)(0),[m,E]=Object(n.useState)(!1),{baseUrl:h}=Object(p.b)(),b=(({baseUrl:e,setProgress:t,addTask:a,setShowFullSummaryTask:n})=>async l=>{const{dryRun:r,files:o,format:c,identifier:s,importReportMode:i,preheatMode:m,importStrategy:d,atomicMode:u,mergeMode:p,flushMode:E,skipSharing:h,skipValidation:b,inclusionStrategy:v,isAsync:g,firstRowIsHeader:y,classKey:S}=l,f="".concat(e,"/api/"),T=["importMode=".concat(r?"VALIDATE":"COMMIT"),"identifier=".concat(s),"importReportMode=".concat(i),"preheatMode=".concat(m),"importStrategy=".concat(d),"atomicMode=".concat(u),"mergeMode=".concat(p),"flushMode=".concat(E),"skipSharing=".concat(h),"skipValidation=".concat(b),"inclusionStrategy=".concat(v),"async=".concat(g),"format=".concat(c),"csv"==c?"firstRowIsHeader=".concat(y,"&classKey=").concat(S):""].filter(e=>""!=e).join("&"),w="".concat(f).concat("metadata.json","?").concat(T);try{await Z({url:w,file:o[0],format:c,type:"METADATA_IMPORT",setProgress:t,addEntry:(e,t)=>a("metadata",e,{...t,jobDetails:l})})}catch(k){const e=Zr(l);return{[Yr]:[k],...e}}finally{n(!0)}})({baseUrl:h,setProgress:i,addTask:t,setShowFullSummaryTask:E});return l.a.createElement(vt,{title:Qr,desc:eo,icon:to,loading:s,dataTest:"page-import-metadata",summaryTask:u(e),showFullSummaryTask:m},l.a.createElement($r,{onSubmit:b,initialValues:o,subscription:{values:!0,submitError:!0},render:({handleSubmit:e,form:t,values:a,submitError:n})=>l.a.createElement("form",{onSubmit:e},l.a.createElement(rs,null,l.a.createElement(At,{helpText:c.a.t("Supported file types: JSON, CSV, and XML.",{nsSeparator:">"})}),l.a.createElement(Vt,{availableFormats:Nt,type:"import"}),l.a.createElement(Kt,{show:"csv"==a.format}),l.a.createElement(Wt,{show:"csv"==a.format,form:t,prevValue:r.classKey}),l.a.createElement(ya,null),l.a.createElement(ka,null),l.a.createElement(_a,null),l.a.createElement(Ma,null),l.a.createElement(Pa,null),l.a.createElement(qa,null)),l.a.createElement(rt,null,l.a.createElement(Xa,null),l.a.createElement(ln,null),l.a.createElement(sn,null),l.a.createElement(En,null),l.a.createElement(Qa,null)),l.a.createElement(Ct,{form:t}),l.a.createElement(Mt,{alerts:n}))}))},{Form:no}=s.v,lo=c.a.t("Metadata export"),ro=c.a.t("Export metadata, such as data elements and organisation units, in XML, JSON or CSV format."),oo=l.a.createElement(b,null),co={checkedSchemas:[],format:Pt,compression:Gn,skipSharing:!1},so=()=>{const{baseUrl:e}=Object(p.b)(),t=(e=>t=>{const{checkedSchemas:a,format:n,compression:l,skipSharing:r}=t,o="".concat(e,"/api/"),c=l?"".concat(n,".").concat(l):n,s=a.map(e=>"".concat(e,"=true")).join("&"),i="skipSharing=".concat(r,"&download=true&").concat(s),m="".concat(o).concat("metadata",".").concat(c,"?").concat(i);$(m)})(e);return l.a.createElement(vt,{title:lo,desc:ro,icon:oo,dataTest:"page-export-metadata"},l.a.createElement(no,{onSubmit:t,initialValues:co,render:({handleSubmit:e,form:t})=>l.a.createElement("form",{onSubmit:e},l.a.createElement(El,null),l.a.createElement(Vt,{availableFormats:Nt}),l.a.createElement(Xn,null),l.a.createElement(ln,null),l.a.createElement(rl,{label:c.a.t("Export metadata")}))}))},{Form:io}=s.v,mo=c.a.t("Metadata dependency export"),uo=c.a.t("Export metadata dependencies, such as data sets and programs, including related metadata objects, in XML or JSON format."),po=l.a.createElement(v,null),Eo={objectType:bl,object:void 0,format:Pt,compression:Gn,skipSharing:!1},ho=()=>{const{baseUrl:e}=Object(p.b)(),t=(e=>t=>{const{objectType:a,object:n,format:l,compression:r,skipSharing:o}=t,c="".concat(e,"/api/"),s="".concat(a,"/").concat(n,"/metadata"),i=r?"".concat(l,".").concat(r):l,m="skipSharing=".concat(o,"&download=true"),d="".concat(c).concat(s,".").concat(i,"?").concat(m);$(d)})(e);return l.a.createElement(vt,{title:mo,desc:uo,icon:po,dataTest:"page-export-metadata-dependency"},l.a.createElement(io,{onSubmit:t,initialValues:Eo,render:({handleSubmit:e,form:t,values:a})=>l.a.createElement("form",{onSubmit:e},l.a.createElement(gl,null),l.a.createElement(fl,{objectType:a.objectType,form:t}),l.a.createElement(Vt,{availableFormats:Ut}),l.a.createElement(Xn,null),l.a.createElement(ln,null),l.a.createElement(rl,{label:c.a.t("Export metadata dependencies")}))}))};var bo=a(199),vo=a.n(bo);const go=()=>{const{jobOverview:e,updateJobOverview:t}=Object(n.useContext)(d);return l.a.createElement(vt,{title:yo,desc:So,icon:fo,limitWidth:!1,dataTest:"job-overview-page"},l.a.createElement("div",{className:vo.a.container},l.a.createElement(Me,{activeTypes:e.activeTypes,setActiveTypes:e=>{t({activeTypes:e})},selectedJob:e.selectedJob,setSelectedJob:e=>{t({selectedJob:e})}})))},yo=c.a.t("Job overview"),So=c.a.t("An overview of all import jobs started this session."),fo=l.a.createElement(f,null),{Form:To}=s.v,wo=c.a.t("GML import"),ko=c.a.t("Import geographic data for organisation units using the GML format. GML is an XML grammar for expressing geographical features."),Do=l.a.createElement(S,null),Oo=()=>{const{tasks:{gml:e},addTask:t}=Object(n.useContext)(d),a=Object(jt.h)().query,r=(e=>({files:e.files}))(Q(a,e)),[o,c]=Object(n.useState)(0),[s,i]=Object(n.useState)(!1),{baseUrl:m}=Object(p.b)(),E=(({baseUrl:e,setProgress:t,addTask:a,setShowFullSummaryTask:n})=>async l=>{const{dryRun:r,files:o}=l,c="".concat(e,"/api/"),s=["dryRun=".concat(r),"format=json"].join("&"),i="".concat(c).concat("metadata/gml.json","?").concat(s);try{await Z({url:i,file:o[0],format:"gml",type:"GML_IMPORT",setProgress:t,addEntry:(e,t)=>a("gml",e,{...t,jobDetails:l})})}catch(m){return{[Yr]:[m]}}finally{n(!0)}})({baseUrl:m,setProgress:c,addTask:t,setShowFullSummaryTask:i});return l.a.createElement(vt,{title:wo,desc:ko,icon:Do,loading:o,dataTest:"page-import-gml",summaryTask:u(e),showFullSummaryTask:s},l.a.createElement(To,{onSubmit:E,initialValues:r,render:({handleSubmit:e,form:t,submitError:a})=>l.a.createElement("form",{onSubmit:e},l.a.createElement(At,null),l.a.createElement(Ct,{form:t}),l.a.createElement(Mt,{alerts:a}))}))},jo=c.a.t("Event import"),xo=c.a.t("Import events for programs, stages and tracked entities using the DXF 2 format."),_o=l.a.createElement(y,null),{Form:Io}=s.v,Ao=()=>{const{tasks:{event:e},addTask:t}=Object(n.useContext)(d),a=Object(jt.h)().query,r=(e=>({files:e.files,format:e.format||Pt,dataElementIdScheme:e.dataElementIdScheme||wl,orgUnitIdScheme:e.orgUnitIdScheme||Ul,eventIdScheme:e.eventIdScheme||jl,idScheme:e.idScheme||Al}))(Q(a,e)),[o,s]=Object(n.useState)(0),[i,m]=Object(n.useState)(!1),{baseUrl:E}=Object(p.b)(),h=(({baseUrl:e,setProgress:t,addTask:a,setShowFullSummaryTask:n})=>async l=>{const{dryRun:r,files:o,format:c,dataElementIdScheme:s,orgUnitIdScheme:i,eventIdScheme:m,idScheme:d}=l,u="".concat(e,"/api/"),p=["skipFirst=true","async=true","dryRun=".concat(r),"dataElementIdScheme=".concat(s),"orgUnitIdScheme=".concat(i),"eventIdScheme=".concat(m),"idScheme=".concat(d),"payloadFormat=".concat(c)].join("&"),E="".concat(u).concat("events.json","?").concat(p);try{await Z({url:E,file:o[0],format:c,type:"EVENT_IMPORT",setProgress:t,addEntry:(e,t)=>a("event",e,{...t,jobDetails:l})})}catch(h){return{[Yr]:[h]}}finally{n(!0)}})({baseUrl:E,setProgress:s,addTask:t,setShowFullSummaryTask:m});return l.a.createElement(vt,{title:jo,desc:xo,icon:_o,loading:o,dataTest:"page-import-event",summaryTask:u(e),showFullSummaryTask:i},l.a.createElement(Io,{onSubmit:h,initialValues:r,subscription:{values:!0,submitError:!0},render:({handleSubmit:e,form:t,submitError:a})=>l.a.createElement("form",{onSubmit:e},l.a.createElement(rs,null,l.a.createElement(At,{helpText:c.a.t("Supported file types: JSON, CSV, and XML.",{nsSeparator:">"})}),l.a.createElement(Vt,{availableFormats:Nt,type:"import"})),l.a.createElement(rt,null,l.a.createElement(ss,null,l.a.createElement(_l,null),l.a.createElement(Dl,null),l.a.createElement(Rl,null),l.a.createElement(Ml,null))),l.a.createElement(Ct,{form:t}),l.a.createElement(Mt,{alerts:a}))}))},Co=e=>({startDate:se(e.startDate,e.endDate),endDate:ie(e.endDate,e.startDate)}),{Form:Mo}=s.v,No=c.a.t("Event export"),Uo=c.a.t("Export event data for programs, stages and tracked entities in DXF 2 format."),Fo=l.a.createElement(y,null),Ro=new Date,Po={selectedOrgUnits:[],selectedPrograms:"",programStage:void 0,format:Pt,compression:Gn,startDate:new Date(Ro.getFullYear(),Ro.getMonth()-3,Ro.getDate()),endDate:Ro,includeDeleted:!1,dataElementIdScheme:wl,orgUnitIdScheme:Ul,idScheme:Al,inclusion:Yn},Lo=()=>{const{baseUrl:e}=Object(p.b)(),t=(e=>t=>{const{selectedOrgUnits:a,selectedPrograms:n,programStage:l,format:r,compression:o,startDate:c,endDate:s,includeDeleted:i,dataElementIdScheme:m,orgUnitIdScheme:d,idScheme:u,inclusion:p}=t,E="".concat(e,"/api/"),h=o?"".concat(r,".").concat(o):r,b="".concat("events",".").concat(h),v=["links=false","skipPaging=true","orgUnit=".concat(z(a[0])),"program=".concat(n),"includeDeleted=".concat(i),"dataElementIdScheme=".concat(m),"orgUnitIdScheme=".concat(d),"idScheme=".concat(u),"attachment=".concat(b),"startDate=".concat(V(c)),"endDate=".concat(V(s)),"ouMode=".concat(p),"format=".concat(r),"ALL"!=l?"programStage=".concat(l):""].filter(e=>""!=e).join("&"),g="".concat(E).concat("events",".").concat(h,"?").concat(v);$(g)})(e);return l.a.createElement(vt,{title:No,desc:Uo,icon:Fo,dataTest:"page-export-data"},l.a.createElement(Mo,{onSubmit:t,initialValues:Po,validate:Co,subscription:{values:!0},render:({handleSubmit:e,form:t,values:a})=>l.a.createElement("form",{onSubmit:e},l.a.createElement(rs,null,l.a.createElement(bn,{multiSelect:!1}),l.a.createElement($n,null),l.a.createElement(Fn,{autoSelectFirst:!0}),l.a.createElement(sl,{selectedProgram:a.selectedPrograms,form:t}),l.a.createElement(Wr,{label:c.a.t("Date range to export data for")},l.a.createElement(tl,null),l.a.createElement(ll,null)),l.a.createElement(Vt,{availableFormats:Nt}),l.a.createElement(Xn,null)),l.a.createElement(rt,null,l.a.createElement(Bn,null),l.a.createElement(ss,null,l.a.createElement(Dl,null),l.a.createElement(Rl,null),l.a.createElement(Ml,null))),l.a.createElement(rl,{label:c.a.t("Export events")}))}))},{Form:Jo}=s.v,zo=c.a.t("Data import"),Vo=c.a.t("Import data values from ADX XML, DXF 2 XML, JSON, CSV or PDF files."),qo=l.a.createElement(g,null),Bo=()=>{const{tasks:{data:e},addTask:t}=Object(n.useContext)(d),a=Object(jt.h)().query,r=(e=>({files:e.files,format:e.format||Pt,strategy:e.strategy||Zt,firstRowIsHeader:!!e.firstRowIsHeader,preheatCache:!!e.preheatCache,skipAudit:!!e.skipAudit,dataElementIdScheme:e.dataElementIdScheme||wl,orgUnitIdScheme:e.orgUnitIdScheme||Ul,idScheme:e.idScheme||Al,skipExistingCheck:!!e.skipExistingCheck}))(Q(a,e)),[o,s]=Object(n.useState)(0),[i,m]=Object(n.useState)(!1),{baseUrl:E}=Object(p.b)(),h=(({baseUrl:e,setProgress:t,addTask:a,setShowFullSummaryTask:n})=>async l=>{const{dryRun:r,files:o,strategy:c,preheatCache:s,skipAudit:i,dataElementIdScheme:m,orgUnitIdScheme:d,idScheme:u,skipExistingCheck:p,format:E,firstRowIsHeader:h}=l,b="".concat(e,"/api/"),v=["async=true","dryRun=".concat(r),"strategy=".concat(c),"preheatCache=".concat(s),"skipAudit=".concat(i),"dataElementIdScheme=".concat(m),"orgUnitIdScheme=".concat(d),"idScheme=".concat(u),"skipExistingCheck=".concat(p),"format=".concat(E),"csv"==E?"firstRowIsHeader=".concat(h):""].filter(e=>""!=e).join("&"),g="".concat(b).concat("dataValueSets.json","?").concat(v);try{await Z({url:g,file:o[0],format:E,type:"DATAVALUE_IMPORT",setProgress:t,addEntry:(e,t)=>a("data",e,{...t,jobDetails:l})})}catch(y){return{[Yr]:[y]}}finally{n(!0)}})({baseUrl:E,setProgress:s,addTask:t,setShowFullSummaryTask:m});return l.a.createElement(vt,{title:zo,desc:Vo,icon:qo,loading:o,dataTest:"page-import-data",summaryTask:u(e),showFullSummaryTask:i},l.a.createElement(Jo,{onSubmit:h,initialValues:r,subscription:{values:!0,submitError:!0},render:({handleSubmit:e,form:t,values:a,submitError:n})=>l.a.createElement("form",{onSubmit:e},l.a.createElement(rs,null,l.a.createElement(At,{helpText:c.a.t("Supported file types: JSON, CSV, XML, ADX and PDF.",{nsSeparator:">"})}),l.a.createElement(Vt,{availableFormats:Ft,type:"import"}),l.a.createElement(Kt,{show:"csv"==a.format}),l.a.createElement(Qt,null),l.a.createElement(la,null),l.a.createElement(Bc,{pred:Pl},l.a.createElement(ia,null))),l.a.createElement(rt,null,l.a.createElement(ss,null,l.a.createElement(Dl,null),l.a.createElement(Rl,null),l.a.createElement(Ml,null)),l.a.createElement(Ea,null)),l.a.createElement(Ct,{form:t}),l.a.createElement(Mt,{alerts:n}))}))},Ho=e=>async t=>{const{format:a,compression:n}=t,l="".concat(e,"/api/"),r=(({selectedOrgUnits:e,includeChildren:t,selectedDataSets:a,format:n,compression:l,startDate:r,endDate:o,includeDeleted:c,dataElementIdScheme:s,orgUnitIdScheme:i,idScheme:m})=>["dataElementIdScheme=".concat(s),"orgUnitIdScheme=".concat(i),"idScheme=".concat(m),"includeDeleted=".concat(c),"children=".concat(t),"startDate=".concat(V(r)),"endDate=".concat(V(o)),"orgUnit=".concat(e.map(e=>z(e))),"dataSet=".concat(a),"format=".concat(n),"compression=".concat(B(l))].join("&"))(t),o="".concat(l).concat("dataValueSets","?").concat(r);if(n)$(o);else try{const e=await fetch(o,{Accept:R(a)}),t=await e.text(),n="data.".concat(a),l=G(t,a);K(l,n)}catch(s){const e=[{id:"http-".concat((new Date).getTime()),critical:!0,message:"".concat(c.a.t("HTTP error when fetching data"),". ").concat(s.message)}];return console.error("DataExport onExport error: ",s),{[Yr]:e}}},Go=e=>({startDate:se(e.startDate,e.endDate),endDate:ie(e.endDate,e.startDate)}),{Form:Ko}=s.v,Xo=c.a.t("Data export"),Wo=c.a.t("Export metadata, such as data elements and organisation units, in DXF 2 format."),Yo=l.a.createElement(g,null),Zo=new Date,$o={selectedOrgUnits:[],includeChildren:!0,selectedDataSets:[],format:Pt,compression:Gn,startDate:new Date(Zo.getFullYear(),Zo.getMonth()-3,Zo.getDate()),endDate:Zo,includeDeleted:!1,dataElementIdScheme:wl,orgUnitIdScheme:Ul,idScheme:Al},Qo=()=>{const{baseUrl:e}=Object(p.b)(),t=Ho(e);return l.a.createElement(vt,{title:Xo,desc:Wo,icon:Yo,dataTest:"page-export-data"},l.a.createElement(Ko,{onSubmit:t,initialValues:$o,validate:Go,subscription:{values:!0,submitError:!0},render:({handleSubmit:e,form:t,submitError:a})=>l.a.createElement("form",{onSubmit:e},l.a.createElement(rs,null,l.a.createElement(bn,null),l.a.createElement(Jn,null),l.a.createElement(xn,null),l.a.createElement(Wr,{label:c.a.t("Date range to export data for")},l.a.createElement(tl,null),l.a.createElement(ll,null)),l.a.createElement(Vt,{availableFormats:Nt}),l.a.createElement(Xn,null)),l.a.createElement(rt,null,l.a.createElement(Bn,null),l.a.createElement(ss,null,l.a.createElement(Dl,null),l.a.createElement(Rl,null),l.a.createElement(Ml,null))),l.a.createElement(rl,{label:c.a.t("Export data")}),l.a.createElement(Mt,{alerts:a}))}))},ec=e=>async t=>{const{format:a,compression:n}=t,l="".concat(e,"/api/"),r=(({selectedOrgUnits:e,selectedUsers:t,selectedPrograms:a,selectedTETypes:n,ouMode:l,format:r,compression:o,includeDeleted:c,includeAllAttributes:s,dataElementIdScheme:i,eventIdScheme:m,orgUnitIdScheme:d,idScheme:u,assignedUserMode:p,teiTypeFilter:E,programStatus:h,followUpStatus:b,programStartDate:v,programEndDate:g,lastUpdatedFilter:y,lastUpdatedStartDate:S,lastUpdatedEndDate:f,lastUpdatedDuration:T})=>{const w={ou:e.map(e=>z(e)).join(";"),ouMode:l,format:r,includeDeleted:c.toString(),includeAllAttributes:s.toString(),dataElementIdScheme:i,eventIdScheme:m,orgUnitIdScheme:d,idScheme:u,assignedUserMode:p};return o&&(w.compression=B(o)),"PROVIDED"==p&&(w.assignedUser=t.join(";")),"PROGRAM"==E&&(w.program=a,w.programStatus&&(w.programStatus=h),w.followUpStatus=b,v&&(w.programStartDate=V(v)),g&&(w.programEndDate=V(g))),"TE"==E&&(w.trackedEntity=n),"DATE"==y&&(S&&(w.lastUpdatedStartDate=V(S)),f&&(w.lastUpdatedEndDate=V(f))),"DURATION"==y&&(w.lastUpdatedDuration=T),Object.keys(w).map(e=>"".concat(e,"=").concat(w[e])).join("&")})(t),o="".concat(l).concat("trackedEntityInstances","?").concat(r);if(n)$(o);else try{const e=await fetch(o,{Accept:R(a)}),t=await e.text(),n="trackedEntityInstances.".concat(a),l=G(t,a);K(l,n)}catch(s){const e=[{id:"http-".concat((new Date).getTime()),critical:!0,message:"".concat(c.a.t("HTTP error when fetching tracked entity instances"),". ").concat(s.message)}];return console.error("TEIExport onExport error: ",s),{[Yr]:e}}},tc=e=>{const t={};return"PROGRAM"==e.teiTypeFilter&&e.programStartDate&&e.programEndDate&&(t.programStartDate=se(e.programStartDate,e.programEndDate),t.programEndDate=ie(e.programEndDate,e.programStartDate)),"DATE"==e.lastUpdatedFilter&&e.lastUpdatedStartDate&&e.lastUpdatedEndDate&&(t.lastUpdatedStartDate=se(e.lastUpdatedStartDate,e.lastUpdatedEndDate),t.lastUpdatedEndDate=ie(e.lastUpdatedEndDate,e.lastUpdatedStartDate)),"DATE"!=e.lastUpdatedFilter||e.lastUpdatedStartDate||e.lastUpdatedEndDate||(t.lastUpdatedEndDate=c.a.t("At least one of the 'last updated' date fields must be specified")),t},{Form:ac}=s.v,nc=c.a.t("Tracked entity instances export"),lc=c.a.t("Export tracked entity instances in XML, JSON, JSONP or CSV format."),rc=l.a.createElement(T,null),oc={selectedOrgUnits:[],selectedPrograms:[],selectedTETypes:[],selectedUsers:[],format:Pt,ouMode:Jl,teiTypeFilter:Bl,programStatus:Xl,followUpStatus:$l,programStartDate:"",programEndDate:"",compression:Gn,lastUpdatedFilter:br,lastUpdatedStartDate:"",lastUpdatedEndDate:"",lastUpdatedDuration:"",assignedUserMode:Nr,includeDeleted:!1,includeAllAttributes:!1,dataElementIdScheme:wl,eventIdScheme:jl,orgUnitIdScheme:Ul,idScheme:Al},cc=()=>{const{baseUrl:e}=Object(p.b)(),t=ec(e);return l.a.createElement(vt,{title:nc,desc:lc,icon:rc,dataTest:"page-export-tei"},l.a.createElement(ac,{onSubmit:t,initialValues:oc,validate:tc,subscription:{values:!0,submitError:!0},render:({handleSubmit:e,form:t,values:a,submitError:n})=>{const r="PROGRAM"==a.teiTypeFilter,o="TE"==a.teiTypeFilter,s="DATE"==a.lastUpdatedFilter,i="DURATION"==a.lastUpdatedFilter,m="PROVIDED"==a.assignedUserMode;return l.a.createElement("form",{onSubmit:e},l.a.createElement(rs,null,l.a.createElement(bn,null),l.a.createElement(Vl,null),l.a.createElement(Gl,null),l.a.createElement(Fn,{label:c.a.t("Program to export from"),show:r}),l.a.createElement(Yl,{show:r}),l.a.createElement(er,{show:r}),l.a.createElement(Wr,{label:c.a.t("Enrollment date range"),show:r},l.a.createElement(nr,{show:r}),l.a.createElement(or,{show:r})),l.a.createElement(Er,{show:o}),l.a.createElement(Vt,{availableFormats:Rt}),l.a.createElement(Xn,null)),l.a.createElement(rt,null,l.a.createElement(gr,null),l.a.createElement(Wr,{show:s},l.a.createElement(fr,{show:s}),l.a.createElement(kr,{show:s})),l.a.createElement(Cr,{show:i}),l.a.createElement(Fr,null),l.a.createElement(Br,{show:m}),l.a.createElement(Bn,null),l.a.createElement(Xr,null),l.a.createElement(ss,null,l.a.createElement(Dl,null),l.a.createElement(_l,null),l.a.createElement(Rl,null),l.a.createElement(Ml,null))),l.a.createElement(rl,{label:c.a.t("Export tracked entity instances")}),l.a.createElement(Mt,{alerts:n}))}}))},sc=()=>({}),{Form:ic}=s.v,mc=c.a.t("Tracked entity instances import"),dc=c.a.t("Import tracked entity instances from JSON or XML files."),uc=l.a.createElement(T,null),pc=()=>{const{tasks:{tei:e},addTask:t}=Object(n.useContext)(d),a=Object(jt.h)().query,r=(e=>({files:e.files,format:e.format||Pt,identifier:e.identifier||ba,importReportMode:e.importReportMode||fa,preheatMode:e.preheatMode||Oa,importStrategy:e.importStrategy||Aa,atomicMode:e.atomicMode||Ua,mergeMode:e.mergeMode||Ja,flushMode:e.flushMode||Ha,inclusionStrategy:e.inclusionStrategy||Ya,skipSharing:!!e.skipSharing,skipValidation:!!e.skipValidation,isAsync:!e.isAsync,dataElementIdScheme:e.dataElementIdScheme||wl,orgUnitIdScheme:e.orgUnitIdScheme||Ul,eventIdScheme:e.eventIdScheme||jl,idScheme:e.idScheme||Al}))(Q(a,e)),[o,s]=Object(n.useState)(0),[i,m]=Object(n.useState)(!1),{baseUrl:E}=Object(p.b)(),h=(({baseUrl:e,setProgress:t,addTask:a,setShowFullSummaryTask:n})=>async l=>{const{dryRun:r,files:o,format:c,identifier:s,importReportMode:i,preheatMode:m,importStrategy:d,atomicMode:u,mergeMode:p,flushMode:E,skipSharing:h,skipValidation:b,inclusionStrategy:v,isAsync:g,dataElementIdScheme:y,orgUnitIdScheme:S,eventIdScheme:f,idScheme:T}=l,w="".concat(e,"/api/"),k=["importMode=".concat(r?"VALIDATE":"COMMIT"),"identifier=".concat(s),"importReportMode=".concat(i),"preheatMode=".concat(m),"importStrategy=".concat(d),"atomicMode=".concat(u),"mergeMode=".concat(p),"flushMode=".concat(E),"skipSharing=".concat(h),"skipValidation=".concat(b),"inclusionStrategy=".concat(v),"async=".concat(g),"format=".concat(c),"dataElementIdScheme=".concat(y),"orgUnitIdScheme=".concat(S),"eventIdScheme=".concat(f),"idScheme=".concat(T)].filter(e=>""!=e).join("&"),D="".concat(w).concat("trackedEntityInstances.json","?").concat(k);try{await Z({url:D,file:o[0],format:c,type:"TEI_IMPORT",setProgress:t,addEntry:(e,t)=>a("tei",e,{...t,jobDetails:l})})}catch(O){const e=sc(l);return{[Yr]:[O],...e}}finally{n(!0)}})({baseUrl:E,setProgress:s,addTask:t,setShowFullSummaryTask:m});return l.a.createElement(vt,{title:mc,desc:dc,icon:uc,loading:o,dataTest:"page-import-tei",summaryTask:u(e),showFullSummaryTask:i},l.a.createElement(ic,{onSubmit:h,initialValues:r,subscription:{values:!0,submitError:!0},render:({handleSubmit:e,form:t,submitError:a})=>l.a.createElement("form",{onSubmit:e},l.a.createElement(rs,null,l.a.createElement(At,{helpText:c.a.t("Supported file types: JSON and XML.",{nsSeparator:">"})}),l.a.createElement(Vt,{availableFormats:Ut,type:"import"}),l.a.createElement(ya,null),l.a.createElement(ka,null),l.a.createElement(_a,null),l.a.createElement(Ma,null),l.a.createElement(Pa,null),l.a.createElement(qa,null)),l.a.createElement(rt,null,l.a.createElement(Xa,null),l.a.createElement(ln,null),l.a.createElement(sn,null),l.a.createElement(En,null),l.a.createElement(Qa,null),l.a.createElement(ss,null,l.a.createElement(Dl,null),l.a.createElement(_l,null),l.a.createElement(Rl,null),l.a.createElement(Ml,null))),l.a.createElement(Ct,{form:t}),l.a.createElement(Mt,{alerts:a}))}))},Ec=()=>l.a.createElement(xt,null,l.a.createElement(jt.d,null,l.a.createElement(jt.b,{path:"/import/data",component:Bo}),l.a.createElement(jt.b,{path:"/import/event",component:Ao}),l.a.createElement(jt.b,{path:"/import/gml",component:Oo}),l.a.createElement(jt.b,{path:"/import/metadata",component:ao}),l.a.createElement(jt.b,{path:"/import/tei",component:pc}),l.a.createElement(jt.b,{path:"/export/data",component:Qo}),l.a.createElement(jt.b,{path:"/export/event",component:Lo}),l.a.createElement(jt.b,{path:"/export/metadata-dependency",component:ho}),l.a.createElement(jt.b,{path:"/export/metadata",component:so}),l.a.createElement(jt.b,{path:"/export/tei",component:cc}),l.a.createElement(jt.b,{path:"/utils/job-overview",component:go}),l.a.createElement(jt.a,{from:"*",to:"/import/data"})));function hc(e,t){return t.reduce((t,{name:a,displayName:n})=>t||((t=>e===t.toLowerCase())(a)?n:t),"")}function bc(e,t){return t.reduce((t,{name:a})=>{if(t)return t;return(t=>t.includes(e)&&0===t.indexOf(e))(a.toLowerCase())?(n=a.substr(0,e.length).replace(/([A-Z]+)/g," $1"))[0].toUpperCase()+n.substr(1):t;var n},"")}const vc=e=>(e=>Object.keys(e).reduce((t,a)=>{const n=e[a];return 1===n.length?{...t,other:[...t.other,n[0]]}:{...t,[a]:n}},{other:[]}))((e=>e.reduce((e,t)=>{const{group:a}=t;return{...e,[a]:e[a]?[...e[a],t]:[t]}},{}))(e)),gc=e=>Object.entries(e).reduce((e,[t,a])=>{const n=function(e,t){const a=e.toLowerCase();return"oauth2"===a||"other"===a?e:hc(a,t)||bc(a,t)||e[0].toUpperCase()+e.substr(1)}(t,a);return{...e,[t]:n}},{}),yc=e=>{const t=e.split(".");return t.pop(),e.includes(".dhis")||t.pop(),t[t.length-1].replace(/(.)([A-Z])/g,"$1 $2")};var Sc=a(179),fc=a.n(Sc);const Tc=({label:e,schemas:t,toggleSchema:a,dataTest:n})=>l.a.createElement("div",{className:fc.a.group,"data-test":n},l.a.createElement("span",{className:fc.a.formLabel},e),l.a.createElement("div",{className:fc.a.schema},t.map((e,t)=>l.a.createElement("div",{key:e.name},l.a.createElement(s.e,{label:e.label,name:"schemas.".concat(e.name),value:"schemas.".concat(e.name),checked:e.checked,onChange:()=>a(t)}))))),wc={schemas:{resource:"schemas",params:{fields:["metadata","collectionName","displayName","klass"]}}},kc=({excludeSchemas:e,setCheckedSchemas:t,meta:a,checkedByDefault:r,dataTest:o})=>{const[i,m]=Object(n.useState)(void 0),[d,u]=Object(n.useState)(void 0),[E,h]=Object(n.useState)(void 0),{error:b,loading:v}=Object(p.d)(wc,{onComplete:t=>{const a=t.schemas.schemas,n=((e,t)=>e.map(e=>({checked:t,label:e.displayName,name:e.collectionName,group:yc(e.klass)})))(((e,t)=>t.filter(t=>t.metadata&&!e.has(t.collectionName)))(e,a),r),l=vc(n);m(l),h((e=>{const t=Object.keys(e);return t.sort(),t})(l)),u(gc(l)),g(l)},onError:e=>{console.error("Schemas error: ",e)}}),g=e=>{t(Object.keys(e).reduce((t,a)=>[...t,...e[a].filter(e=>e.checked).map(e=>e.name)],[]))},y=e=>()=>{const t=Object.keys(i).reduce((t,a)=>({...t,[a]:i[a].reduce((t,a)=>[...t,{...a,checked:e}],[])}),{});m(t),g(t)},S=!v&&!b;return l.a.createElement("div",{className:fc.a.container,"data-test":o},v&&l.a.createElement(s.h,{dataTest:"".concat(o,"-loading")}),b&&l.a.createElement("div",{"data-test":"".concat(o,"-error")},l.a.createElement("p",null,c.a.t("Something went wrong when loading the schemas!")),l.a.createElement("p",null,b.message)),S&&l.a.createElement(l.a.Fragment,null,l.a.createElement(s.c,null,l.a.createElement(s.b,{onClick:y(!0),dataTest:"".concat(o,"-select-all")},c.a.t("Select All")),l.a.createElement(s.b,{onClick:y(!1),dataTest:"".concat(o,"-select-none")},c.a.t("Select None"))),l.a.createElement("div",{className:fc.a.formControl},E.map(e=>{const t=d[e];return l.a.createElement(Tc,{key:t,label:t,schemas:i[e],toggleSchema:(a=e,e=>{const t=[...i[a]];t[e]={...t[e],checked:!t[e].checked};const n={...i,[a]:t};m(n),g(n)})});var a})),(a.touched||!a.pristine)&&a.error&&l.a.createElement(s.n,{error:!0},a.error)))};a(200);const{Field:Dc}=s.v;var Oc=a(201),jc=a.n(Oc);const xc={name:c.a.t("Data import"),code:"data-import",icon:l.a.createElement(g,null),path:"/import/data"},_c={name:c.a.t("Event import"),code:"event-import",icon:l.a.createElement(y,null),path:"/import/event"},Ic={name:c.a.t("GML import"),code:"gml-import",icon:l.a.createElement(S,null),path:"/import/gml"},Ac={name:c.a.t("Metadata import"),code:"metadata-import",path:"/import/metadata",icon:l.a.createElement(h,null)},Cc={name:c.a.t("TEI import"),code:"tei-import",path:"/import/tei",icon:l.a.createElement(T,null)},Mc={name:c.a.t("Data export"),code:"data-export",path:"/export/data",icon:l.a.createElement(g,null)},Nc={name:c.a.t("Event export"),code:"event-export",path:"/export/event",icon:l.a.createElement(y,null)},Uc={name:c.a.t("Metadata dependency export"),code:"metadata-dependency-export",path:"/export/metadata-dependency",icon:l.a.createElement(v,null)},Fc={name:c.a.t("Metadata export"),code:"metadata-export",path:"/export/metadata",icon:l.a.createElement(b,null)},Rc={name:c.a.t("TEI export"),code:"tei-export",path:"/export/tei",icon:l.a.createElement(T,null)},Pc=[xc,_c,Ic,Ac,Cc],Lc=[Mc,Nc,Uc,Fc,Rc],Jc={name:c.a.t("Job overview"),code:"job-overview",path:"/utils/job-overview",icon:l.a.createElement(f,null)},zc=({name:e,path:t,code:a,active:n,className:r})=>{const o=Object(jt.g)();return l.a.createElement(s.r,{active:n,onClick:()=>o.push(t),label:e,className:tt()(r,{[jc.a.sidebarItem]:!n,[jc.a.sidebarItemActive]:n}),dataTest:"sidebar-link-".concat(a)})},Vc=()=>{const e=Object(jt.h)().pathname;return l.a.createElement(s.q,{className:jc.a.Menu},l.a.createElement(s.s,{className:jc.a.sectionTitle,label:c.a.t("Import"),noDivider:!0}),Pc.map(({icon:t,name:a,code:n,path:r})=>{const o=e==r;return l.a.createElement(zc,{name:a,path:r,code:n,icon:t,active:o,key:r})}),l.a.createElement(s.s,{className:jc.a.sectionTitle,label:c.a.t("Export")}),Lc.map(({icon:t,name:a,code:n,path:r})=>{const o=e==r;return l.a.createElement(zc,{name:a,path:r,code:n,icon:t,active:o,key:r})}),l.a.createElement(s.l,null),l.a.createElement(zc,{name:Jc.name,path:Jc.path,code:Jc.code,icon:Jc.icon,active:e==Jc.path,className:e==Jc.path?"":jc.a.jobOverview,key:Jc.path}))},{Field:qc}=s.v,Bc=({pred:e,children:t})=>{const a=Object(n.useContext)(m);return a&&e(a.authorities)?t:null};var Hc=a(202),Gc=a.n(Hc);const Kc={dataSets:{resource:"dataSets",params:{fields:"id,displayName",paging:"false"}}},Xc={programs:{resource:"programs",params:{fields:"id,displayName",paging:"false"}}},Wc={trackedEntityTypes:{resource:"trackedEntityTypes",params:{fields:"id,displayName",paging:"false"}}},Yc={users:{resource:"users",params:{fields:"id,displayName",paging:"false"}}},{Field:Zc}=s.v,$c=({label:e,resourceType:t,selected:a,setSelected:r,meta:o,multiSelect:c,withFilter:i,autoSelectFirst:m,dataTest:d,listName:u,filterLabel:E,selectedLabel:h,errorMessage:b})=>{const[v,g]=Object(n.useState)([]),[y,S]=Object(n.useState)(void 0),{error:f,resourceName:T,query:w}=(e=>e==vn?{resourceName:"dataSets",query:Kc}:e==gn?{resourceName:"programs",query:Xc}:e==yn?{resourceName:"trackedEntityTypes",query:Wc}:e==Sn?{resourceName:"users",query:Yc}:{error:"Unkown resource type: ".concat(e)})(t);if(f)return console.error("ResourcePicker: ".concat(f)),null;const{loading:k}=Object(p.d)(w,{onComplete:e=>{const t=e[T][T].map(({id:e,displayName:t})=>({value:e,label:t}));g(t),m&&t.length&&r({selected:c?[t[0].value]:t[0].value})},onError:e=>{S(e),console.error("ResourcePicker(".concat(T,") error: "),e)}}),D=!k&&!y;return l.a.createElement(Se,{label:e,dataTest:d},k&&l.a.createElement(s.h,{dataTest:"".concat(d,"-loading")}),y&&l.a.createElement(s.n,{error:!0,"data-test":"".concat(d,"-error")},l.a.createElement("p",null,b),l.a.createElement("p",null,y.message)),D&&(c?l.a.createElement(s.I,{name:u,label:E,selected:a,onChange:r,options:v,filterable:i,filterPlaceholder:E,rightHeader:l.a.createElement("p",{className:Gc.a.selectedLabel},h),dataTest:"".concat(d,"-list"),loading:k}):l.a.createElement(Zc,{component:s.x,name:u,options:v,filterable:i,dataTest:"".concat(d,"-select"),loading:k})),(o.touched||!o.pristine)&&o.error&&l.a.createElement(s.n,{error:!0},o.error))};$c.defaultProps={multiSelect:!0,withFilter:!0};const{Field:Qc}=s.v,es=({input:{value:e,onChange:t},meta:a,...n})=>l.a.createElement($c,Object.assign({meta:a,selected:e,setSelected:({selected:e})=>t(e)},n)),ts=({name:e,validator:t,...a})=>l.a.createElement(Qc,Object.assign({component:es,name:e,validate:t},a));var as=a(203),ns=a.n(as);const ls=c.a.t("Basic options"),rs=({children:e})=>l.a.createElement("section",{className:ns.a.container},l.a.createElement("header",{className:ns.a.header},l.a.createElement("h2",{className:ns.a.label},ls),l.a.createElement(s.l,null)),e);var os=a(204),cs=a.n(os);const ss=({children:e})=>l.a.createElement("div",{className:cs.a.container},e);var is=a(205),ms=a.n(is);const{Field:ds}=s.v,us=e=>l.a.createElement("div",{className:ms.a.container},l.a.createElement(ds,e));t.default=()=>{const{tasks:e,addTask:t,jobOverview:a,updateJobOverview:n}=_(),{loading:o,error:u,user:E}=(()=>{const{loading:e,error:t,data:a}=Object(p.d)(I);return t&&console.log("useUser error: ",t),{loading:e,error:t,user:a&&a.user}})(),h=!o&&!u;return l.a.createElement(l.a.Fragment,null,l.a.createElement(s.j,null),l.a.createElement(s.k,{spacers:!0,colors:!0}),o&&l.a.createElement(i.o,{dataTest:"app-screen-cover"},l.a.createElement(s.h,{dataTest:"app-loader"})),u&&l.a.createElement("div",{"data-test":"app-error"},l.a.createElement("p",null,c.a.t("Something went wrong when loading the current user!")),l.a.createElement("p",null,u.message)),h&&l.a.createElement(r.a,null,l.a.createElement(m.Provider,{value:E},l.a.createElement(d.Provider,{value:{tasks:e,addTask:t,jobOverview:a,updateJobOverview:n}},l.a.createElement("div",{className:U.a.container},l.a.createElement("div",{className:U.a.sidebar},l.a.createElement(Vc,null)),l.a.createElement("main",{className:U.a.content},l.a.createElement(Ec,null)))))))}}}]);
//# sourceMappingURL=app.136e03bc.chunk.js.map